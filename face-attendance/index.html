<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #eef2f7;
      --card: rgba(255,255,255,.85);
      --card-solid: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: rgba(148,163,184,.35);
      --shadow: 0 18px 45px rgba(2, 6, 23, .12);
      --shadow-soft: 0 10px 28px rgba(2, 6, 23, .08);
      --primary: #2563eb;
      --primary-soft: rgba(37,99,235,.12);
      --good: #16a34a;
      --bad: #ef4444;
      --warn: #f59e0b;
      --radius-xl: 26px;
      --radius-lg: 20px;
      --radius-md: 14px;

      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
      --safe-right: env(safe-area-inset-right);
    }

    @media (prefers-color-scheme: dark){
      :root{
        --bg: #0b1220;
        --card: rgba(17, 24, 39, .65);
        --card-solid: #0f172a;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --border: rgba(148,163,184,.18);
        --shadow: 0 18px 45px rgba(0,0,0,.35);
        --shadow-soft: 0 10px 28px rgba(0,0,0,.22);
        --primary-soft: rgba(59,130,246,.18);
      }
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: "Prompt", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 500px at 15% 10%, rgba(37,99,235,.18), transparent 60%),
        radial-gradient(900px 400px at 90% 20%, rgba(34,197,94,.14), transparent 55%),
        radial-gradient(900px 500px at 55% 100%, rgba(245,158,11,.10), transparent 55%),
        var(--bg);
      padding: calc(14px + var(--safe-top)) calc(14px + var(--safe-right)) calc(90px + var(--safe-bottom)) calc(14px + var(--safe-left));
    }

    /* Mobile App Shell */
    .app{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      flex-direction: column;
      gap: 14px;
    }

    .topbar{
      position: sticky;
      top: calc(0px + var(--safe-top));
      z-index: 30;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.35));
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      overflow:hidden;
    }
    @media (prefers-color-scheme: dark){
      .topbar{
        background: linear-gradient(180deg, rgba(15,23,42,.70), rgba(15,23,42,.40));
      }
    }

    .topbar-inner{
      padding: 16px 16px 14px;
      position: relative;
    }

    .title-row{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
    }

    .title{
      display:flex;
      flex-direction: column;
      gap: 4px;
    }
    .title h1{
      margin:0;
      font-size: 20px;
      line-height: 1.2;
      letter-spacing: .2px;
    }
    .subtitle{
      margin:0;
      color: var(--muted);
      font-size: 13px;
    }

    /* Hamburger: show on mobile, hide on desktop (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á) */
    .hamburger{
      width: 44px;
      height: 44px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.55);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 8px 18px rgba(2,6,23,.10);
    }
    @media (prefers-color-scheme: dark){
      .hamburger{ background: rgba(15,23,42,.55); }
    }

    .hamburger svg{ opacity:.9; }

    .api-line{
      margin-top: 10px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      color: var(--muted);
      font-size: 12.5px;
    }
    .api-pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border: 1px dashed var(--border);
      border-radius: 999px;
      background: rgba(255,255,255,.45);
      max-width: 100%;
    }
    @media (prefers-color-scheme: dark){
      .api-pill{ background: rgba(15,23,42,.45); }
    }
    .api-url{
      color: var(--text);
      font-weight: 500;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: min(700px, 72vw);
    }

    .actions{
      margin-top: 12px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.6);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      cursor:pointer;
      font-size: 13px;
      font-weight: 600;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      box-shadow: 0 10px 20px rgba(2,6,23,.10);
      user-select:none;
      transition: transform .08s ease, filter .2s ease;
    }
    @media (prefers-color-scheme: dark){
      .btn{ background: rgba(15,23,42,.55); }
    }
    .btn:active{ transform: scale(.98); }
    .btn-primary{
      background: linear-gradient(180deg, rgba(37,99,235,.95), rgba(37,99,235,.85));
      color: #fff;
      border-color: rgba(37,99,235,.6);
    }
    .btn-danger{
      background: linear-gradient(180deg, rgba(239,68,68,.95), rgba(239,68,68,.85));
      color:#fff;
      border-color: rgba(239,68,68,.55);
    }
    .btn-warm{
      background: linear-gradient(180deg, rgba(245,158,11,.95), rgba(245,158,11,.85));
      color:#111827;
      border-color: rgba(245,158,11,.55);
    }

    /* Connection badge (PC ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏±‡∏ß‡∏ö‡∏ô) */
    .conn-badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.55);
      font-weight: 700;
      font-size: 12.5px;
      box-shadow: 0 10px 20px rgba(2,6,23,.10);
      user-select:none;
    }
    @media (prefers-color-scheme: dark){
      .conn-badge{ background: rgba(15,23,42,.55); }
    }
    .dot{
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: var(--warn);
      box-shadow: 0 0 0 4px rgba(245,158,11,.15);
    }
    .conn-badge.connected .dot{
      background: var(--good);
      box-shadow: 0 0 0 4px rgba(22,163,74,.18);
    }
    .conn-badge.disconnected .dot{
      background: var(--bad);
      box-shadow: 0 0 0 4px rgba(239,68,68,.16);
    }

    /* Desktop layout */
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      align-items:start;
    }

    .card{
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .card-header{
      padding: 14px 16px 10px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(148,163,184,.18);
    }
    .card-title{
      margin:0;
      font-size: 15px;
      font-weight: 800;
      letter-spacing: .2px;
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .card-sub{
      margin: 0;
      padding: 0 16px 14px;
      color: var(--muted);
      font-size: 13px;
    }
    .card-body{ padding: 14px 16px 16px; }

    .pill{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.45);
      border-radius: 999px;
      padding: 8px 10px;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      font-size: 12.5px;
      color: var(--muted);
    }
    @media (prefers-color-scheme: dark){
      .pill{ background: rgba(15,23,42,.45); }
    }

    .camera-box{
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 22px;
      border: 1px dashed rgba(148,163,184,.45);
      background:
        linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,.18));
      display:grid;
      place-items:center;
      text-align:center;
      padding: 16px;
      overflow:hidden;
      position: relative;
    }
    @media (prefers-color-scheme: dark){
      .camera-box{
        background: linear-gradient(180deg, rgba(15,23,42,.55), rgba(15,23,42,.25));
      }
    }
    .camera-icon{
      font-size: 34px;
      margin-bottom: 10px;
    }
    .camera-text{
      margin:0;
      font-weight: 800;
      font-size: 14.5px;
    }
    .camera-hint{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.45;
    }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .input{
      width: 100%;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.55);
      padding: 12px 12px;
      font-size: 14px;
      outline:none;
      color: var(--text);
    }
    @media (prefers-color-scheme: dark){
      .input{ background: rgba(15,23,42,.55); }
    }

    .split{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .mini{
      border: 1px solid var(--border);
      border-radius: 20px;
      background: rgba(255,255,255,.48);
      padding: 12px 12px;
    }
    @media (prefers-color-scheme: dark){
      .mini{ background: rgba(15,23,42,.48); }
    }
    .mini h3{
      margin:0 0 8px;
      font-size: 13.5px;
      font-weight: 900;
    }
    .mini ul{
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
      font-size: 12.8px;
      line-height: 1.6;
    }

    /* Bottom bar (mobile app feel) */
    .bottombar{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px calc(14px + var(--safe-right)) calc(10px + var(--safe-bottom)) calc(14px + var(--safe-left));
      background: linear-gradient(180deg, transparent, rgba(0,0,0,.06));
      pointer-events: none; /* allow scroll */
      z-index: 50;
    }
    @media (prefers-color-scheme: dark){
      .bottombar{
        background: linear-gradient(180deg, transparent, rgba(0,0,0,.28));
      }
    }
    .bottombar-inner{
      pointer-events: auto;
      border: 1px solid var(--border);
      border-radius: 24px;
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      display:flex;
      justify-content: space-around;
      gap: 10px;
      padding: 10px;
    }
    @media (prefers-color-scheme: dark){
      .bottombar-inner{ background: rgba(15,23,42,.70); }
    }
    .tab{
      flex: 1;
      border-radius: 18px;
      padding: 10px 10px;
      border: 1px solid transparent;
      background: transparent;
      cursor:pointer;
      text-align:center;
      color: var(--text);
      font-weight: 800;
      font-size: 12.5px;
      user-select:none;
    }
    .tab:hover{ filter: brightness(1.02); }
    .tab.primary{
      background: var(--primary-soft);
      border-color: rgba(37,99,235,.25);
    }

    /* MODAL */
    .modal{
      position: fixed;
      inset: 0;
      display:none;
      place-items:center;
      padding: 18px;
      z-index: 999;
      background: rgba(2,6,23,.55);
    }
    .modal.show{ display:grid; }
    .modal-card{
      width: min(620px, 96vw);
      border-radius: 26px;
      border: 1px solid rgba(148,163,184,.25);
      background: var(--card-solid);
      box-shadow: 0 30px 90px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .modal-head{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(148,163,184,.18);
    }
    .modal-head h2{
      margin:0;
      font-size: 16px;
      font-weight: 900;
    }
    .close{
      width: 42px;
      height: 42px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.8);
      cursor:pointer;
      display:grid;
      place-items:center;
    }
    @media (prefers-color-scheme: dark){
      .close{ background: rgba(15,23,42,.85); }
    }
    .modal-body{ padding: 14px 16px 16px; }

    .note{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 12.8px;
      line-height: 1.5;
    }

    /* RESPONSIVE: Desktop split + PC badge positioning */
    @media (min-width: 980px){
      body{ padding-bottom: 22px; } /* no need huge bottom */
      .bottombar{ display:none; } /* bottom bar only mobile */

      .grid{
        grid-template-columns: 1.35fr .85fr;
      }
      .split{
        grid-template-columns: 1.1fr .9fr;
      }

      /* hide hamburger on PC ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á */
      .hamburger{ display:none; }

      /* ‡∏ß‡∏≤‡∏á badge ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏õ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á topbar ‡∏Å‡∏≤‡∏£‡πå‡∏î */
      .topbar-inner{
        padding-bottom: 22px;
      }
      .conn-desktop-anchor{
        position: absolute;
        right: 16px;
        bottom: 14px;
      }
      /* ‡∏ö‡∏ô PC ‡πÉ‡∏´‡πâ API pill ‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô */
      .api-url{ max-width: 760px; }
    }

    /* Small screens polish */
    @media (max-width: 420px){
      .title h1{ font-size: 18px; }
      .btn{ width: 100%; justify-content: center; }
      .api-url{ max-width: 78vw; }
    }
  </style>
</head>

<body>
  <div class="app">

    <!-- TOP BAR (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ) -->
    <section class="topbar" aria-label="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏£‡∏∞‡∏ö‡∏ö">
      <div class="topbar-inner">
        <div class="title-row">
          <div class="title">
            <h1>üïí ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h1>
            <p class="subtitle">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ 4 ‡∏ä‡πà‡∏ß‡∏á + ‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤)</p>
          </div>

          <!-- 3 ‡∏Ç‡∏µ‡∏î: ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (PC ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏° media query) -->
          <button class="hamburger" id="menuBtn" type="button" aria-label="‡πÄ‡∏°‡∏ô‡∏π">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>

        <div class="api-line">
          <div class="api-pill">
            <span>üîå API:</span>
            <span class="api-url" id="apiUrlText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL</span>
          </div>

          <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô inline / PC ‡∏à‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î -->
          <div class="conn-badge disconnected" id="connBadge" title="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠">
            <span class="dot"></span>
            <span id="connText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
          </div>
        </div>

        <!-- anchor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢ badge ‡πÑ‡∏õ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏ô PC -->
        <div class="conn-desktop-anchor" aria-hidden="true">
          <!-- ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á‡∏î‡πâ‡∏ß‡∏¢ JS ‡∏ï‡∏≠‡∏ô desktop -->
        </div>

        <div class="actions">
          <button class="btn btn-primary" id="btnOpenUrl" type="button">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL</button>
          <button class="btn btn-danger" id="btnResetUrl" type="button">üßπ Reset URL</button>
          <button class="btn btn-warm" id="btnRegisterFace" type="button">üßë‚Äçüíº ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR)</button>
          <button class="btn" id="btnAdmin" type="button">üóÇÔ∏è ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà / HR</button>
          <button class="btn" id="btnTestConn" type="button">‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
        </div>
      </div>
    </section>

    <!-- MAIN -->
    <div class="grid">

      <!-- LEFT: Scan / Manual -->
      <section class="card" aria-label="‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤">
        <div class="card-header">
          <h2 class="card-title">üì∑ ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h2>
          <span class="pill" id="scanStatusPill">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô ‚úÖ</span>
        </div>
        <p class="card-sub">‡∏ñ‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏•‡πâ‡∏≠‡∏á/HTTPS ‡πÅ‡∏•‡∏∞‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÇ‡∏°‡πÄ‡∏î‡∏•</p>

        <div class="card-body">
          <div class="camera-box" id="cameraBox">
            <div>
              <div class="camera-icon">üì∏</div>
              <p class="camera-text">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà</p>
              <p class="camera-hint">‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á<br>‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ ‚Äú‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‚Äù ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
            </div>
          </div>

          <div class="row">
            <button class="btn btn-primary" id="btnStartScan" type="button">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô</button>
            <button class="btn" id="btnStopScan" type="button">‚èπÔ∏è ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
            <button class="btn" id="btnManual" type="button">‚úçÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</button>
            <button class="btn" id="btnToday" type="button">üßæ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
          </div>

          <div style="margin-top:12px;">
            <input class="input" id="empCode" placeholder="ü™™ ‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏∑‡∏≠)" autocomplete="off" />
            <p class="note" id="hintText">Tip: ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° API ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
          </div>

          <div class="split" style="margin-top:12px;">
            <div class="mini">
              <h3>üß† ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
              <div id="latestResult" style="color:var(--muted); font-size:13px; line-height:1.6;">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
              </div>
            </div>
            <div class="mini">
              <h3>üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
              <div id="todaySummary" style="color:var(--muted); font-size:13px; line-height:1.6;">
                ‡∏Å‡∏î ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Help / Checklist (‡πÅ‡∏ó‡∏ô contact card ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö) -->
      <aside class="card" aria-label="‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô">
        <div class="card-header">
          <h2 class="card-title">üß© ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô</h2>
          <span class="pill">‡πÅ‡∏Å‡πâ‡πÑ‡∏ß ‚úÖ</span>
        </div>
        <div class="card-body">
          <ul style="margin:0; padding-left:18px; color:var(--muted); font-size:13px; line-height:1.7;">
            <li>‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô <b>HTTPS</b> (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á)</li>
            <li>‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï <b>‡∏Å‡∏•‡πâ‡∏≠‡∏á</b> + <b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</b> (Location)</li>
            <li>‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå <b>models/</b> ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå</li>
            <li>‡∏ñ‡πâ‡∏≤ API ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ <b>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</b> ‡πÅ‡∏ó‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</li>
          </ul>

          <div style="margin-top:14px;" class="mini">
            <h3>üß∑ ‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (‡∏ü‡∏µ‡∏•‡πÅ‡∏≠‡∏õ)</h3>
            <ul>
              <li>‡∏°‡∏µ Bottom Bar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏î‡πÄ‡∏£‡πá‡∏ß</li>
              <li>‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÇ‡∏Ñ‡πâ‡∏á + ‡πÄ‡∏á‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô iOS/Android</li>
              <li>‡πÉ‡∏™‡πà emoji ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</li>
            </ul>
          </div>
        </div>
      </aside>

    </div>
  </div>

  <!-- BOTTOM BAR (mobile only) -->
  <div class="bottombar" aria-label="‡πÅ‡∏ñ‡∏ö‡∏•‡πà‡∏≤‡∏á">
    <div class="bottombar-inner">
      <button class="tab primary" id="tabScan" type="button">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô</button>
      <button class="tab" id="tabManual" type="button">‚úçÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏∑‡∏≠</button>
      <button class="tab" id="tabToday" type="button">üßæ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
    </div>
  </div>

  <!-- MODAL: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL -->
  <div class="modal" id="urlModal" role="dialog" aria-modal="true" aria-label="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL">
    <div class="modal-card">
      <div class="modal-head">
        <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL (Apps Script Web App)</h2>
        <button class="close" id="closeUrlModal" type="button" aria-label="‡∏õ‡∏¥‡∏î">‚úñ</button>
      </div>
      <div class="modal-body">
        <input class="input" id="apiUrlInput" placeholder="‡∏ß‡∏≤‡∏á URL ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ /exec" />
        <p class="note">
          ‚Ä¢ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: https://script.google.com/macros/s/xxxxx/exec<br>
          ‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô localStorage ‡∏ä‡∏∑‡πà‡∏≠ <b>attendance_api_url_v2</b>
        </p>
        <div class="row">
          <button class="btn btn-primary" id="saveUrlBtn" type="button">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button class="btn" id="cancelUrlBtn" type="button">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠ (UI ‡∏û‡∏£‡πâ‡∏≠‡∏° ‡πÅ‡∏ï‡πà logic ‡∏ï‡πà‡∏≠ API ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ) -->
  <div class="modal" id="manualModal" role="dialog" aria-modal="true" aria-label="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠">
    <div class="modal-card">
      <div class="modal-head">
        <h2>‚úçÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</h2>
        <button class="close" id="closeManualModal" type="button" aria-label="‡∏õ‡∏¥‡∏î">‚úñ</button>
      </div>
      <div class="modal-body">
        <input class="input" id="manualEmpCode" placeholder="ü™™ ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" autocomplete="off" />
        <input class="input" id="manualNote" placeholder="üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" autocomplete="off" style="margin-top:10px;" />

        <div class="row" style="margin-top:12px;">
          <button class="btn btn-primary" id="saveManualBtn" type="button">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button class="btn" id="cancelManualBtn" type="button">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>

        <p class="note" id="manualHint">
          ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô UI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚Äî ‡∏ù‡∏±‡πà‡∏á API/GS ‡∏Ñ‡πà‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö (‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤ error)
        </p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      const LS_KEY = "attendance_api_url_v2";

      // Elements
      const apiUrlText = document.getElementById("apiUrlText");
      const connBadge = document.getElementById("connBadge");
      const connText  = document.getElementById("connText");
      const connAnchor = document.querySelector(".conn-desktop-anchor");

      const urlModal = document.getElementById("urlModal");
      const apiUrlInput = document.getElementById("apiUrlInput");

      const manualModal = document.getElementById("manualModal");
      const manualEmpCode = document.getElementById("manualEmpCode");

      const latestResult = document.getElementById("latestResult");
      const todaySummary = document.getElementById("todaySummary");
      const empCode = document.getElementById("empCode");

      const scanStatusPill = document.getElementById("scanStatusPill");
      const cameraBox = document.getElementById("cameraBox");

      // Buttons
      const btnOpenUrl = document.getElementById("btnOpenUrl");
      const btnResetUrl = document.getElementById("btnResetUrl");
      const btnRegisterFace = document.getElementById("btnRegisterFace");
      const btnAdmin = document.getElementById("btnAdmin");
      const btnTestConn = document.getElementById("btnTestConn");

      const btnStartScan = document.getElementById("btnStartScan");
      const btnStopScan = document.getElementById("btnStopScan");
      const btnManual = document.getElementById("btnManual");
      const btnToday = document.getElementById("btnToday");

      // bottom tabs
      const tabScan = document.getElementById("tabScan");
      const tabManual = document.getElementById("tabManual");
      const tabToday = document.getElementById("tabToday");

      // modal buttons
      const closeUrlModal = document.getElementById("closeUrlModal");
      const saveUrlBtn = document.getElementById("saveUrlBtn");
      const cancelUrlBtn = document.getElementById("cancelUrlBtn");

      const closeManualModal = document.getElementById("closeManualModal");
      const saveManualBtn = document.getElementById("saveManualBtn");
      const cancelManualBtn = document.getElementById("cancelManualBtn");

      function isDesktop(){
        return window.matchMedia("(min-width: 980px)").matches;
      }

      function normalizeUrl(u){
        if(!u) return "";
        u = String(u).trim();
        // remove spaces
        u = u.replace(/\s+/g,"");
        return u;
      }

      function setConn(state, text){
        connBadge.classList.remove("connected","disconnected");
        connBadge.classList.add(state);
        connText.textContent = text;
      }

      function getApiUrl(){
        try{
          return normalizeUrl(localStorage.getItem(LS_KEY) || "");
        }catch(e){
          return "";
        }
      }

      function setApiUrl(u){
        try{
          localStorage.setItem(LS_KEY, normalizeUrl(u));
        }catch(e){}
      }

      function renderApi(){
        const url = getApiUrl();
        apiUrlText.textContent = url ? url : "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL";
        apiUrlText.title = url || "";
      }

      // Move connection badge to bottom-right on desktop (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á)
      function placeConnBadge(){
        try{
          if(isDesktop() && connAnchor && connBadge){
            connAnchor.innerHTML = "";
            connAnchor.appendChild(connBadge);
          }else{
            // place back inline in api-line if not desktop
            const apiLine = document.querySelector(".api-line");
            if(apiLine && connBadge && connBadge.parentElement !== apiLine){
              apiLine.appendChild(connBadge);
            }
          }
        }catch(e){}
      }

      function openModal(el){
        if(!el) return;
        el.classList.add("show");
      }
      function closeModal(el){
        if(!el) return;
        el.classList.remove("show");
      }

      function toastResult(msg){
        latestResult.innerHTML = "‚Ä¢ " + escapeHtml(msg) + "<br><span style='color:var(--muted)'>(" + new Date().toLocaleString("th-TH") + ")</span>";
      }

      function escapeHtml(s){
        return String(s)
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }

      async function testConnection(){
        const url = getApiUrl();
        if(!url){
          setConn("disconnected","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
          toastResult("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL");
          return;
        }
        setConn("disconnected","‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...");
        try{
          const ctrl = new AbortController();
          const t = setTimeout(()=>ctrl.abort(), 6000);

          // ‡∏¢‡∏¥‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢: ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏Å‡πá‡∏î‡∏µ ‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡πá‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏±‡∏á
          const pingUrl = url + (url.includes("?") ? "&" : "?") + "ping=1&t=" + Date.now();
          const res = await fetch(pingUrl, { method:"GET", signal: ctrl.signal, cache:"no-store" });

          clearTimeout(t);

          if(res && res.ok){
            setConn("connected","‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            toastResult("‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
          }else{
            setConn("disconnected","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
            toastResult("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (HTTP " + (res ? res.status : "?") + ")");
          }
        }catch(err){
          setConn("disconnected","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
          toastResult("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏≠‡∏≤‡∏à‡∏ï‡∏¥‡∏î CORS/URL ‡∏ú‡∏¥‡∏î/‡πÄ‡∏ô‡πá‡∏ï) ‚ùå");
        }
      }

      // ---- UI actions (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å logic ‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏Ñ) ----
      function startScanMock(){
        scanStatusPill.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô... üü¢";
        cameraBox.innerHTML = `
          <div>
            <div class="camera-icon">üü¢</div>
            <p class="camera-text">‡πÇ‡∏´‡∏°‡∏î‡∏™‡πÅ‡∏Å‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</p>
            <p class="camera-hint">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô UI Demo ‚Äî ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á/face-api ‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ</p>
          </div>
        `;
        toastResult("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô (UI) ‡πÅ‡∏•‡πâ‡∏ß");
      }
      function stopScanMock(){
        scanStatusPill.textContent = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô ‚úÖ";
        cameraBox.innerHTML = `
          <div>
            <div class="camera-icon">üì∏</div>
            <p class="camera-text">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà</p>
            <p class="camera-hint">‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á<br>‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ ‚Äú‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‚Äù ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
          </div>
        `;
        toastResult("‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á (UI) ‡πÅ‡∏•‡πâ‡∏ß");
      }

      function openManual(){
        manualEmpCode.value = empCode.value || "";
        openModal(manualModal);
        setTimeout(()=>manualEmpCode.focus(), 30);
      }

      function fakeToday(){
        const code = (empCode.value || "").trim();
        todaySummary.innerHTML = code
          ? "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠ API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™: <b>" + escapeHtml(code) + "</b><br><span style='color:var(--muted)'>‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤ UI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß</span>"
          : "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö";
        toastResult("‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (UI)");
      }

      function saveManualMock(){
        const code = (manualEmpCode.value || "").trim();
        if(!code){
          toastResult("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
          return;
        }
        closeModal(manualModal);
        empCode.value = code;
        toastResult("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠ (UI) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + code);
      }

      // ---- EVENTS ----
      btnOpenUrl.addEventListener("click", ()=>{
        apiUrlInput.value = getApiUrl();
        openModal(urlModal);
        setTimeout(()=>apiUrlInput.focus(), 30);
      });

      btnResetUrl.addEventListener("click", ()=>{
        try{ localStorage.removeItem(LS_KEY); }catch(e){}
        renderApi();
        setConn("disconnected","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
        toastResult("‡∏•‡πâ‡∏≤‡∏á URL ‡πÅ‡∏•‡πâ‡∏ß");
      });

      saveUrlBtn.addEventListener("click", ()=>{
        const u = normalizeUrl(apiUrlInput.value);
        setApiUrl(u);
        renderApi();
        closeModal(urlModal);
        toastResult("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å URL ‡πÅ‡∏•‡πâ‡∏ß");
      });

      cancelUrlBtn.addEventListener("click", ()=>closeModal(urlModal));
      closeUrlModal.addEventListener("click", ()=>closeModal(urlModal));
      urlModal.addEventListener("click", (e)=>{ if(e.target === urlModal) closeModal(urlModal); });

      btnTestConn.addEventListener("click", testConnection);

      btnRegisterFace.addEventListener("click", ()=>{
        toastResult("‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR) ‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ");
      });

      btnAdmin.addEventListener("click", ()=>{
        toastResult("‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà/HR ‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ");
      });

      btnStartScan.addEventListener("click", startScanMock);
      btnStopScan.addEventListener("click", stopScanMock);
      btnManual.addEventListener("click", openManual);
      btnToday.addEventListener("click", fakeToday);

      tabScan.addEventListener("click", ()=>{ window.scrollTo({ top: 0, behavior: "smooth" }); });
      tabManual.addEventListener("click", openManual);
      tabToday.addEventListener("click", fakeToday);

      closeManualModal.addEventListener("click", ()=>closeModal(manualModal));
      cancelManualBtn.addEventListener("click", ()=>closeModal(manualModal));
      manualModal.addEventListener("click", (e)=>{ if(e.target === manualModal) closeModal(manualModal); });
      saveManualBtn.addEventListener("click", saveManualMock);

      // Escape to close modals
      window.addEventListener("keydown", (e)=>{
        if(e.key === "Escape"){
          closeModal(urlModal);
          closeModal(manualModal);
        }
      });

      // Initial render
      renderApi();
      placeConnBadge();
      window.addEventListener("resize", placeConnBadge);

      // Optional: auto-test if URL exists
      if(getApiUrl()){
        // ‡πÑ‡∏°‡πà auto-test ‡πÅ‡∏£‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏±‡∏ô‡∏£‡∏≥‡∏Ñ‡∏≤‡∏ç/‡∏Å‡∏±‡∏ô CORS error spam
        setConn("disconnected","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
      }else{
        setConn("disconnected","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
      }

    })();
  </script>
</body>
</html>
