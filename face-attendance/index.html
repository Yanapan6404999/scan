<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‚Ä¢ Face/Manual Attendance</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;

      --blue:#2563eb;
      --blue2:#1d4ed8;
      --green:#16a34a;
      --green2:#15803d;
      --warn:#f59e0b;
      --red:#ef4444;

      --shadow: 0 18px 50px rgba(15,23,42,.10);
      --shadow2: 0 12px 30px rgba(15,23,42,.08);
      --radius: 20px;
      --radius2: 16px;

      --safeT: env(safe-area-inset-top);
      --safeB: env(safe-area-inset-bottom);

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Prompt",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1000px 520px at 15% 0%, rgba(37,99,235,.14) 0%, transparent 60%),
        radial-gradient(900px 520px at 90% 10%, rgba(22,163,74,.12) 0%, transparent 62%),
        var(--bg);
    }
    a{color:var(--blue);text-decoration:none}
    button,input,select,textarea{font-family:inherit}

    /* ====== helpers ====== */
    .wrap{max-width:1180px;margin:0 auto;padding:16px 14px 20px}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .tiny{font-size:11px}
    .bold{font-weight:900}
    .mt8{margin-top:8px}
    .mt10{margin-top:10px}
    .mt12{margin-top:12px}
    .mt14{margin-top:14px}
    .mt16{margin-top:16px}
    .mt18{margin-top:18px}
    .mt20{margin-top:20px}
    .hide{display:none!important}
    .hr{height:1px;background:rgba(229,231,235,.95);margin:14px 0}

    /* ====== responsive visibility ====== */
    .mOnly{display:block}
    .dOnly{display:none}
    @media(min-width: 980px){
      .mOnly{display:none}
      .dOnly{display:block}
    }

    /* ====== top (PC) ====== */
    .topbar{
      position:sticky;top:0;z-index:50;
      background: rgba(246,248,251,.84);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(229,231,235,.85);
    }
    .topbarIn{
      max-width:1180px;margin:0 auto;
      padding: 10px 14px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;
    }
    .logo{
      width:42px;height:42px;border-radius:16px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(22,163,74,.10);
      border: 1px solid rgba(22,163,74,.20);
      box-shadow: var(--shadow2);
      font-size:18px;
    }
    .brandTitle{
      font-weight:950;
      font-size:16px;
      letter-spacing:.2px;
      margin:0;
    }
    .brandSub{
      margin:2px 0 0;
      font-size:12px;
      color:var(--muted);
    }

    .topActions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;align-items:center}

    /* ====== mobile app header ====== */
    .mHeader{
      position: sticky; top: 0; z-index: 60;
      padding-top: var(--safeT);
      padding-bottom: 10px;
      background: linear-gradient(to bottom, rgba(246,248,251,.96), rgba(246,248,251,.86), rgba(246,248,251,0));
      backdrop-filter: blur(10px);
    }
    .mHeaderCard{
      margin: 12px 14px 0;
      padding: 12px 12px;
      border-radius: 20px;
      background: rgba(255,255,255,.94);
      border:1px solid rgba(229,231,235,.85);
      box-shadow: var(--shadow);
      display:flex;gap:10px;align-items:center;justify-content:space-between;
    }
    .mLeft{display:flex;gap:10px;align-items:flex-start}
    .mLogo{
      width:44px;height:44px;border-radius:18px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(37,99,235,.10);
      border: 1px solid rgba(37,99,235,.18);
      box-shadow: var(--shadow2);
      font-size:18px;
    }
    .mTitle{font-weight:950;font-size:16px;margin:0}
    .mSub{font-size:12px;color:var(--muted);margin-top:2px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    .mMenuBtn{
      border:1px solid rgba(229,231,235,.95);
      background: rgba(255,255,255,.92);
      border-radius: 18px;
      padding: 10px 12px;
      display:flex;align-items:center;gap:8px;
      box-shadow: var(--shadow2);
      cursor:pointer;
      font-weight:950;
    }
    .mHamb{font-size:18px;line-height:1}
    .mMenuTxt{font-size:14px}

    /* ====== cards ====== */
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      align-items:start;
    }
    @media(min-width: 980px){
      .grid{grid-template-columns: 1.25fr .75fr; gap: 14px}
    }

    .card{
      background: var(--card);
      border: 1px solid rgba(229,231,235,.95);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position: relative;
    }
    .cardH{
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(229,231,235,.85);
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
      background: linear-gradient(to bottom, rgba(255,255,255,.98), rgba(255,255,255,.86));
    }
    .cardTitle{
      margin:0;
      font-weight:950;
      font-size:15px;
      letter-spacing:.2px;
      display:flex;align-items:center;gap:8px;
    }
    .cardB{padding:14px}

    /* ====== hero (PC) ====== */
    .hero{
      border-radius: 22px;
      overflow:hidden;
      background:
        radial-gradient(1100px 520px at 25% 0%, rgba(37,99,235,.18) 0%, transparent 60%),
        radial-gradient(900px 520px at 95% 10%, rgba(22,163,74,.16) 0%, transparent 62%),
        #fff;
      border:1px solid rgba(229,231,235,.95);
      box-shadow: var(--shadow);
      padding: 18px;
      position: relative;
    }
    .heroTop{display:flex;gap:14px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
    .heroTitle{font-weight:980;font-size:22px;margin:0}
    .heroSub{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.6}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid rgba(229,231,235,.95);
      background: rgba(255,255,255,.88);
      box-shadow: var(--shadow2);
      font-size:12px;
      color: var(--muted);
      font-weight:900;
    }

    .pillStatus{
      position:absolute;
      right: 16px; bottom: 16px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(229,231,235,.95);
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow);
      display:flex;align-items:center;gap:10px;
      font-weight:950;color:var(--muted);
    }

    /* ====== dot status ====== */
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: var(--red);
      box-shadow: 0 0 0 4px rgba(239,68,68,.15);
      display:inline-block;
    }
    .dot.ok{background:var(--green); box-shadow: 0 0 0 4px rgba(22,163,74,.15)}
    .dot.warn{background:var(--warn); box-shadow: 0 0 0 4px rgba(245,158,11,.18)}
    .dot.bad{background:var(--red); box-shadow: 0 0 0 4px rgba(239,68,68,.15)}

    /* ====== form ====== */
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .col{flex:1;min-width:180px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select,textarea{
      width:100%;
      border:1px solid rgba(229,231,235,.98);
      background:#fff;
      padding: 11px 12px;
      border-radius: 14px;
      outline:none;
      font-size: 14px;
    }
    textarea{min-height:92px;resize:vertical}

    /* ====== buttons ====== */
    .btnbar{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      cursor:pointer;
      border:1px solid rgba(229,231,235,.98);
      background: rgba(255,255,255,.96);
      padding: 11px 12px;
      border-radius: 14px;
      font-weight:950;
      font-size: 14px;
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      box-shadow: var(--shadow2);
      transition:.15s ease;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn.primary{
      background: linear-gradient(180deg, rgba(37,99,235,.98), rgba(29,78,216,.98));
      border-color: rgba(29,78,216,.45);
      color:#fff;
      box-shadow: 0 16px 34px rgba(37,99,235,.22);
    }
    .btn.good{
      background: linear-gradient(180deg, rgba(22,163,74,.98), rgba(21,128,61,.98));
      border-color: rgba(21,128,61,.45);
      color:#fff;
      box-shadow: 0 16px 34px rgba(22,163,74,.18);
    }
    .btn.warn{
      background: linear-gradient(180deg, rgba(245,158,11,.98), rgba(217,119,6,.98));
      border-color: rgba(217,119,6,.45);
      color:#fff;
      box-shadow: 0 16px 34px rgba(245,158,11,.16);
    }
    .btn.danger{
      background: linear-gradient(180deg, rgba(239,68,68,.98), rgba(220,38,38,.98));
      border-color: rgba(220,38,38,.45);
      color:#fff;
      box-shadow: 0 16px 34px rgba(239,68,68,.14);
    }
    .btn.ghost{background: rgba(255,255,255,.88)}
    .btn[disabled]{opacity:.6;cursor:not-allowed;transform:none}

    /* ====== tabs (PC) ====== */
    .tabs{
      display:flex;gap:8px;flex-wrap:wrap;
      padding: 10px 0 2px;
      margin-bottom: 10px;
    }
    .tab{
      border:1px solid rgba(229,231,235,.95);
      background: rgba(255,255,255,.96);
      padding: 9px 12px;
      border-radius: 999px;
      cursor:pointer;
      font-weight:950;
      font-size: 12px;
      color: var(--muted);
      box-shadow: var(--shadow2);
      transition:.15s ease;
    }
    .tab.active{
      border-color: rgba(37,99,235,.30);
      background: rgba(37,99,235,.10);
      color: var(--blue2);
    }

    /* ====== sections ====== */
    .section{display:none}
    .section.active{display:block}

    .sectionHead.mOnly{
      border:1px solid rgba(229,231,235,.90);
      border-radius: 18px;
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow2);
      padding: 10px 10px;
      display:flex;gap:10px;align-items:flex-start;
      margin-bottom: 12px;
    }
    .secIcon{
      width:42px;height:42px;border-radius:16px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(37,99,235,.10);
      border:1px solid rgba(37,99,235,.16);
      font-size:18px;
      box-shadow: var(--shadow2);
    }
    .secTitle{font-weight:980}
    .secHint{font-size:12px;color:var(--muted);margin-top:2px;line-height:1.5}

    /* ====== camera block ====== */
    .cam{
      border: 1px dashed rgba(148,163,184,.60);
      border-radius: 18px;
      background: linear-gradient(180deg, #f8fafc, #ffffff);
      padding: 12px;
    }
    .camBox{
      position:relative;
      width:100%;
      aspect-ratio: 16 / 9;
      border-radius: 16px;
      overflow:hidden;
      background:#0b1220;
      border:1px solid rgba(226,232,240,.95);
      display:flex;align-items:center;justify-content:center;
    }
    video{width:100%;height:100%;object-fit:cover;display:none}
    .camHint{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      text-align:center;
      padding:18px;
      color: rgba(255,255,255,.82);
      font-size: 13px;
      line-height: 1.55;
    }
    .previewRow{
      display:none;
      margin-top:10px;
      gap:10px;
      align-items:center;
    }
    .thumb{
      width: 110px; height: 82px;
      border-radius: 14px;
      object-fit:cover;
      border:1px solid rgba(229,231,235,.98);
      background:#fff;
    }

    /* ====== info boxes ====== */
    .info{
      border:1px solid rgba(229,231,235,.90);
      border-radius: 18px;
      padding: 12px;
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow2);
    }
    .kpi{
      display:flex;gap:10px;flex-wrap:wrap;
    }
    .kpiItem{
      flex:1;min-width:140px;
      border:1px solid rgba(229,231,235,.95);
      border-radius: 18px;
      padding: 12px;
      background:#fff;
      box-shadow: var(--shadow2);
    }
    .kpiLabel{font-size:12px;color:var(--muted)}
    .kpiValue{font-weight:980;font-size:18px;margin-top:4px}

    /* ====== tables ====== */
    .tableWrap{
      border:1px solid rgba(229,231,235,.95);
      border-radius: 18px;
      overflow:hidden;
      background:#fff;
      box-shadow: var(--shadow2);
    }
    table{width:100%;border-collapse:collapse}
    th,td{
      padding: 10px 10px;
      border-bottom:1px solid rgba(229,231,235,.70);
      font-size: 13px;
      text-align:left;
      vertical-align:top;
    }
    th{
      background: linear-gradient(to bottom, rgba(255,255,255,.98), rgba(255,255,255,.86));
      font-weight:980;
      color: #0f172a;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    tr:hover td{background: rgba(37,99,235,.04)}
    .statusChip{
      display:inline-flex;align-items:center;gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(229,231,235,.95);
      background: rgba(255,255,255,.92);
      font-weight:950;
      font-size:12px;
      color: var(--muted);
      white-space:nowrap;
    }
    .statusChip.ok{border-color: rgba(22,163,74,.22); background: rgba(22,163,74,.08); color: var(--green2)}
    .statusChip.bad{border-color: rgba(239,68,68,.22); background: rgba(239,68,68,.08); color: #b91c1c}
    .statusChip.warn{border-color: rgba(245,158,11,.22); background: rgba(245,158,11,.10); color: #a16207}

    /* ====== code/pre box ====== */
    .preBox{
      margin-top:10px;
      border-radius: 18px;
      padding: 12px;
      background:#0b1220;
      color:#e5e7eb;
      border:1px solid rgba(255,255,255,.10);
      font-family: var(--mono);
      font-size: 12px;
      line-height: 1.55;
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 340px;
      overflow:auto;
    }

    /* ====== bottom nav (Mobile) ====== */
    .bottomNav{
      position: fixed;
      left:0; right:0; bottom:0;
      z-index: 70;
      padding: 10px 12px calc(10px + var(--safeB));
      background: rgba(246,248,251,.92);
      backdrop-filter: blur(10px);
      border-top:1px solid rgba(229,231,235,.90);
      display:flex;gap:10px;justify-content:space-between;
    }
    .bnBtn{
      flex:1;
      border-radius: 18px;
      border:1px solid rgba(229,231,235,.95);
      background: rgba(255,255,255,.92);
      padding: 10px 8px;
      cursor:pointer;
      box-shadow: var(--shadow2);
      display:flex;flex-direction:column;align-items:center;gap:3px;
      font-weight:980;
      color: var(--muted);
    }
    .bnBtn.active{
      color: var(--blue2);
      border-color: rgba(37,99,235,.28);
      background: rgba(37,99,235,.10);
    }
    .bnIcon{font-size:16px;line-height:1}
    .bnText{font-size:11px}

    @media(max-width: 979px){
      .wrap{padding-bottom: calc(96px + var(--safeB))}
    }

    /* ====== drawer ====== */
    .backdrop{
      position: fixed; inset:0;
      background: rgba(15,23,42,.38);
      z-index: 80;
      display:none;
    }
    .drawer{
      position: fixed;
      top:0; right:0;
      width: min(420px, 92vw);
      height:100%;
      background:#fff;
      border-left: 1px solid rgba(229,231,235,.95);
      box-shadow: -22px 0 60px rgba(15,23,42,.22);
      z-index: 81;
      transform: translateX(110%);
      transition: .18s ease;
      display:flex;flex-direction:column;
    }
    .drawer.open{transform: translateX(0)}
    .drawerH{
      padding: 14px;
      border-bottom: 1px solid rgba(229,231,235,.95);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .drawerTitle{font-weight:980}
    .drawerB{padding:14px;overflow:auto}
    .block{
      border:1px solid rgba(229,231,235,.95);
      border-radius: 18px;
      background:#fff;
      box-shadow: var(--shadow2);
      padding: 12px;
    }
    .blockTitle{font-weight:980;margin-bottom:10px}

    /* ====== toast ====== */
    .toast{
      position: fixed;
      left: 14px; right: 14px;
      bottom: calc(14px + 74px + var(--safeB));
      z-index: 90;
      display:none;
    }
    @media(min-width:980px){
      .toast{
        left:50%;
        transform: translateX(-50%);
        width: 560px;
        bottom: 18px;
      }
    }
    .toastIn{
      background: rgba(15,23,42,.94);
      color:#fff;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      box-shadow: 0 18px 44px rgba(15,23,42,.26);
      padding: 12px 14px;
      display:flex;gap:10px;align-items:flex-start;justify-content:space-between;
    }
    .toastMsg{font-size:13px;line-height:1.45}
    .toastClose{
      background:transparent;border:none;color:rgba(255,255,255,.85);
      cursor:pointer;font-size:16px;padding:2px 6px;
    }

    /* ====== footer ====== */
    .footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      text-align:center;
      padding: 8px 0 2px;
    }
  </style>
</head>

<body>

  <!-- ===== Mobile Header ===== -->
  <div class="mHeader mOnly">
    <div class="mHeaderCard">
      <div class="mLeft">
        <div class="mLogo">üïí</div>
        <div>
          <div class="mTitle">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
          <div class="mSub">
            <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ API:</span>
            <span class="statusChip" id="mApiChip">
              <span class="dot warn" id="mDot"></span>
              <span id="mApiText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL</span>
            </span>
          </div>
        </div>
      </div>

      <button class="mMenuBtn" id="btnOpenDrawerMobile" type="button">
        <span class="mHamb">‚â°</span>
        <span>‚öôÔ∏èüß©</span>
        <span class="mMenuTxt">‡πÄ‡∏°‡∏ô‡∏π</span>
      </button>
    </div>
  </div>

  <!-- ===== PC Topbar ===== -->
  <div class="topbar dOnly">
    <div class="topbarIn">
      <div class="brand">
        <div class="logo">üïí</div>
        <div>
          <div class="brandTitle">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
          <div class="brandSub">‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏£‡∏π (PC) ‚Ä¢ ‡πÇ‡∏ó‡∏ô‡∏Ç‡∏≤‡∏ß/‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‚Ä¢ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏° GS</div>
        </div>
      </div>

      <div class="topActions">
        <button class="btn ghost" id="btnOpenDrawerPC" type="button">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL</button>
        <button class="btn" id="btnPing" type="button">üì° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API</button>
        <button class="btn" id="btnLoadInit" type="button">üì• ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
      </div>
    </div>
  </div>

  <div class="wrap">

    <!-- ===== Hero (PC) ===== -->
    <div class="hero dOnly">
      <div class="heroTop">
        <div>
          <h1 class="heroTitle">‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‚Ä¢ Luxury UI ‚úÖ</h1>
          <div class="heroSub">
            ‚úÖ ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠/‡∏Ñ‡∏≠‡∏° ‚Ä¢ ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ (‡πÄ‡∏°‡∏ô‡∏π 3 ‡∏Ç‡∏µ‡∏î + ‡πÅ‡∏ñ‡∏ö‡∏•‡πà‡∏≤‡∏á) ‚Ä¢ PC ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏£‡∏π ‚Ä¢ ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Apps Script ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤
          </div>
          <div class="chips">
            <span class="chip">üïò ‡πÄ‡∏ß‡∏•‡∏≤: <span id="pcNow">‚Äî</span></span>
            <span class="chip">üñ•Ô∏è ‡πÇ‡∏´‡∏°‡∏î: Desktop</span>
            <span class="chip">üîó API: <span id="pcApiShort">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span></span>
            <span class="chip">üìç GPS: <span id="pcGpsText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</span></span>
          </div>
        </div>

        <div class="btnbar">
          <button class="btn primary" id="btnAskGpsPC" type="button">üìç ‡∏Ç‡∏≠ GPS</button>
          <button class="btn good" id="btnGoScanPC" type="button">üì∑ ‡πÑ‡∏õ‡∏™‡πÅ‡∏Å‡∏ô</button>
          <button class="btn" id="btnGoSummaryPC" type="button">üìä ‡πÑ‡∏õ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
        </div>
      </div>

      <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á -->
      <div class="pillStatus" id="pcPill">
        <span class="dot warn" id="pcDot"></span>
        <span id="pcApiText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL</span>
      </div>
    </div>

    <div class="grid mt12">

      <!-- ===== MAIN ===== -->
      <div class="card">
        <div class="cardH">
          <div>
            <div class="cardTitle" id="mainTitle">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å (‡πÉ‡∏ä‡πâ GS: saveManualLog)</div>
            <div class="small muted" id="mainHint">
              ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: GS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‚Äú‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö GPS‚Äù ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ã‡∏ü (lat/lng ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤) ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏Ç‡∏≠ Location ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            </div>
          </div>

          <div class="chip">
            ‚è±Ô∏è <span id="nowBadge">‚Äî</span>
          </div>
        </div>

        <div class="cardB">

          <!-- Tabs (PC) -->
          <div class="tabs dOnly" id="tabs">
            <button class="tab active" data-sec="secScan" type="button">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô</button>
            <button class="tab" data-sec="secManual" type="button">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏∑‡∏≠</button>
            <button class="tab" data-sec="secCheck" type="button">üîé ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
            <button class="tab" data-sec="secSummary" type="button">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
            <button class="tab" data-sec="secHR" type="button">üß© HR</button>
            <button class="tab" data-sec="secHelp" type="button">üìò ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ</button>
          </div>

          <!-- ===== SECTION: SCAN ===== -->
          <section class="section active" id="secScan">
            <div class="sectionHead mOnly">
              <div class="secIcon">üì∑</div>
              <div>
                <div class="secTitle">‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å</div>
                <div class="secHint">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô + ‡∏Ç‡∏≠ GPS + ‡∏™‡πà‡∏á‡πÑ‡∏õ Apps Script (saveManualLog)</div>
              </div>
            </div>

            <div class="cam">
              <div class="camBox">
                <video id="video" playsinline muted></video>
                <div class="camHint" id="camHint">
                  ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î<br>
                  ‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á‚Äù ‚Üí ‚Äú‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‚Äù ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‚úÖ
                </div>
              </div>

              <div class="row mt12">
                <div class="col">
                  <label>üé• ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á</label>
                  <select id="cameraSelect">
                    <option value="">‚Äî</option>
                  </select>
                </div>
                <div class="col">
                  <label>üîÅ ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤/‡∏´‡∏•‡∏±‡∏á</label>
                  <select id="facingMode">
                    <option value="user">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤ (user)</option>
                    <option value="environment">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á (environment)</option>
                  </select>
                </div>
              </div>

              <div class="btnbar mt12">
                <button class="btn primary" id="btnStartCam" type="button">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
                <button class="btn danger" id="btnStopCam" type="button">‚èπÔ∏è ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
                <button class="btn" id="btnCapture" type="button">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button>
                <button class="btn" id="btnAskGps" type="button">üìç ‡∏Ç‡∏≠ GPS</button>
              </div>

              <div class="previewRow" id="previewRow">
                <img id="thumb" class="thumb" alt="preview">
                <div>
                  <div class="bold">‚úÖ ‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á</div>
                  <div class="small muted" id="previewInfo">‚Äî</div>
                </div>
              </div>

              <div class="info mt12">
                <div class="bold">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ GPS</div>
                <div class="small muted" id="gpsLine">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Location</div>
                <div class="small muted mt8">‡∏ñ‡πâ‡∏≤ GPS ‡πÑ‡∏°‡πà‡∏°‡∏≤ ‚Üí GS ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)</div>
              </div>
            </div>

            <div class="row mt14">
              <div class="col">
                <label>üÜî ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (code)</label>
                <input id="scanCode" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1001" list="dlCodes">
                <datalist id="dlCodes"></datalist>
              </div>
              <div class="col">
                <label>üßæ ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                <input id="scanEvidenceFile" type="file" accept="image/*">
              </div>
            </div>

            <div class="row mt12">
              <div class="col">
                <label>üß† ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (manualType ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ GS)</label>
                <select id="scanManualType">
                  <option value="SCAN" selected>SCAN (‡∏™‡πÅ‡∏Å‡∏ô/‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ)</option>
                  <option value="AUTO">AUTO</option>
                  <option value="FACE">FACE</option>
                </select>
              </div>
              <div class="col">
                <label>üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</label>
                <input id="scanNote" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô/‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô/‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô (GS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö note ‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)">
              </div>
            </div>

            <div class="btnbar mt14">
              <button class="btn good" id="btnSubmitScan" type="button">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô</button>
              <button class="btn" id="btnGoCheckFromScan" type="button">üîé ‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
              <button class="btn" id="btnGoSummaryFromScan" type="button">üìä ‡πÑ‡∏õ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
            </div>

            <div class="info mt14">
              <div class="bold">‚úÖ ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ GS ‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?</div>
              <div class="small muted mt8">
                ‡∏™‡πà‡∏á‡πÑ‡∏õ action=<b>saveManualLog</b> ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå:
                <b>code, lat, lng, evidenceBase64, evidenceName, manualType</b>
              </div>
            </div>
          </section>

          <!-- ===== SECTION: MANUAL ===== -->
          <section class="section" id="secManual">
            <div class="sectionHead mOnly">
              <div class="secIcon">üìù</div>
              <div>
                <div class="secTitle">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</div>
                <div class="secHint">‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ ‚Äú‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô / ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‚Äù (GS ‡πÉ‡∏ä‡πâ saveManualLog ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô)</div>
              </div>
            </div>

            <div class="info">
              <div class="bold">‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</div>
              <div class="small muted mt8">
                ‡πÇ‡∏Ñ‡πâ‡∏î GS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‚Äú‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö GPS‚Äù ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (lat/lng ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤) ‚Äî ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î ‚Äú‡∏Ç‡∏≠ GPS‚Äù ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‚úÖ
              </div>
            </div>

            <div class="row mt14">
              <div class="col">
                <label>üÜî ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (code)</label>
                <input id="mCode" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1001" list="dlCodes">
              </div>
              <div class="col">
                <label>üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ GPS</label>
                <input id="mGpsView" readonly placeholder="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Location">
              </div>
            </div>

            <div class="row mt12">
              <div class="col">
                <label>üß† manualType (‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á Logs.method ‡πÉ‡∏ô GS)</label>
                <select id="mType">
                  <option value="MANUAL" selected>MANUAL</option>
                  <option value="MANUAL:FORGOT">MANUAL:FORGOT</option>
                  <option value="MANUAL:SYSTEM">MANUAL:SYSTEM</option>
                </select>
              </div>
              <div class="col">
                <label>üßæ ‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                <input id="mEvidenceFile" type="file" accept="image/*">
              </div>
            </div>

            <div class="row mt12">
              <div class="col">
                <label>üìù ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                <textarea id="mReason" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ / ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πà‡∏° / ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß"></textarea>
                <div class="small muted mt8">
                  ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: GS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ note ‡πÄ‡∏Å‡πá‡∏ö ‚Äú‡πÇ‡∏ã‡∏ô GPS (IN/OUT/UNKNOWN)‚Äù ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á note ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                  ‚Äî ‡∏ú‡∏°‡∏à‡∏∞‡∏ú‡∏π‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ô <b>manualType</b> ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (MANUAL:‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•...) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢ ‚úÖ
                </div>
              </div>
            </div>

            <div class="btnbar mt14">
              <button class="btn" id="btnAskGps2" type="button">üìç ‡∏Ç‡∏≠ GPS</button>
              <button class="btn good" id="btnSubmitManual" type="button">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</button>
              <button class="btn" id="btnGoCheckFromManual" type="button">üîé ‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
            </div>
          </section>

          <!-- ===== SECTION: CHECK ===== -->
          <section class="section" id="secCheck">
            <div class="sectionHead mOnly">
              <div class="secIcon">üîé</div>
              <div>
                <div class="secTitle">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div class="secHint">‡πÉ‡∏ä‡πâ action: getTodayByCode (‡πÉ‡∏ô GS ‡∏ä‡∏∑‡πà‡∏≠ checkTodayByCode/getTodayByCode ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà)</div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                <label>üÜî ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (code)</label>
                <input id="cCode" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1001" list="dlCodes">
              </div>
              <div class="col">
                <label>üìå ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (GS ‡∏ô‡∏µ‡πâ‡πÄ‡∏ä‡πá‡∏Ñ ‚Äú‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‚Äù)</label>
                <input id="cDate" readonly>
              </div>
            </div>

            <div class="btnbar mt14">
              <button class="btn primary" id="btnCheck" type="button">üîé ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
              <button class="btn" id="btnToSummary" type="button">üìä ‡πÑ‡∏õ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
            </div>

            <div class="hr"></div>

            <div class="info">
              <div class="bold">üßæ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</div>
              <div class="small muted mt8" id="checkHint">‡∏Å‡∏î ‚Äú‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
              <div class="preBox" id="checkBox" style="display:none"></div>
            </div>
          </section>

          <!-- ===== SECTION: SUMMARY ===== -->
          <section class="section" id="secSummary">
            <div class="sectionHead mOnly">
              <div class="secIcon">üìä</div>
              <div>
                <div class="secTitle">‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div class="secHint">‡πÉ‡∏ä‡πâ action: getTodaySummary ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á + ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
              </div>
            </div>

            <div class="kpi">
              <div class="kpiItem">
                <div class="kpiLabel">üë• ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div class="kpiValue" id="kAll">‚Äî</div>
              </div>
              <div class="kpiItem">
                <div class="kpiLabel">‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥</div>
                <div class="kpiValue" id="kOk">‚Äî</div>
              </div>
              <div class="kpiItem">
                <div class="kpiLabel">‚ö†Ô∏è ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤</div>
                <div class="kpiValue" id="kWarn">‚Äî</div>
              </div>
              <div class="kpiItem">
                <div class="kpiLabel">‚ùå ‡∏Ç‡∏≤‡∏î</div>
                <div class="kpiValue" id="kAbsent">‚Äî</div>
              </div>
            </div>

            <div class="row mt14">
              <div class="col">
                <label>üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏£‡∏´‡∏±‡∏™/‡∏ä‡∏∑‡πà‡∏≠/‡πÅ‡∏ú‡∏ô‡∏Å)</label>
                <input id="sumSearch" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1001 ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÅ‡∏ú‡∏ô‡∏Å">
              </div>
              <div class="col">
                <label>‚ö° ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</label>
                <div class="btnbar">
                  <button class="btn primary" id="btnLoadSummary" type="button">üìä ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                  <button class="btn" id="btnExportCsv" type="button">‚¨áÔ∏è Export CSV</button>
                </div>
              </div>
            </div>

            <div class="tableWrap mt14" style="max-height: 520px; overflow:auto">
              <table>
                <thead>
                  <tr>
                    <th style="width:110px">‡∏£‡∏´‡∏±‡∏™</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                    <th style="width:160px">‡πÅ‡∏ú‡∏ô‡∏Å</th>
                    <th style="width:140px">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                    <th style="width:170px">‡πÄ‡∏ß‡∏•‡∏≤ (t1-t4)</th>
                    <th style="width:210px">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                  </tr>
                </thead>
                <tbody id="sumBody">
                  <tr><td colspan="6" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏´‡∏•‡∏î ‚Äî ‡∏Å‡∏î ‚Äú‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‚Äù</td></tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- ===== SECTION: HR ===== -->
          <section class="section" id="secHR">
            <div class="sectionHead mOnly">
              <div class="secIcon">üß©</div>
              <div>
                <div class="secTitle">HR / ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</div>
                <div class="secHint">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô + ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (uploadEmployeeFace)</div>
              </div>
            </div>

            <div class="info">
              <div class="bold">üîê HR Login</div>
              <div class="small muted mt8">‡πÉ‡∏ä‡πâ action: <b>loginAdmin</b> (username/password)</div>

              <div class="row mt12">
                <div class="col">
                  <label>üë§ Username</label>
                  <input id="hrUser" placeholder="admin">
                </div>
                <div class="col">
                  <label>üîí Password</label>
                  <input id="hrPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
              </div>

              <div class="btnbar mt12">
                <button class="btn primary" id="btnLogin" type="button">üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <span class="statusChip" id="hrState"><span class="dot warn" id="hrDot"></span><span id="hrText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</span></span>
              </div>
            </div>

            <div class="hr"></div>

            <div class="info">
              <div class="bold">üôÇ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR)</div>
              <div class="small muted mt8">
                ‡πÉ‡∏ä‡πâ action: <b>uploadEmployeeFace</b> ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á <b>code, photoBase64, fileName</b><br>
                ‚úÖ ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏õ‡πá‡∏ô Base64 ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏° GS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
              </div>

              <div class="row mt12">
                <div class="col">
                  <label>üÜî ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (code)</label>
                  <input id="faceCode" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1001" list="dlCodes">
                </div>
                <div class="col">
                  <label>üì∑ ‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</label>
                  <input id="faceFile" type="file" accept="image/*">
                </div>
              </div>

              <div class="row mt12">
                <div class="col">
                  <label>üß† faceData (optional / ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏î‡πâ)</label>
                  <textarea id="faceData" placeholder='‡∏ñ‡πâ‡∏≤‡∏°‡∏µ descriptor JSON ‡∏Ñ‡πà‡∏≠‡∏¢‡∏ß‡∏≤‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡πá‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á)'></textarea>
                </div>
              </div>

              <div class="btnbar mt12">
                <button class="btn good" id="btnUploadFace" type="button">‚¨ÜÔ∏è ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</button>
              </div>

              <div class="preBox" id="hrBox" style="display:none"></div>
            </div>
          </section>

          <!-- ===== SECTION: HELP ===== -->
          <section class="section" id="secHelp">
            <div class="sectionHead mOnly">
              <div class="secIcon">üìò</div>
              <div>
                <div class="secTitle">‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô)</div>
                <div class="secHint">‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á ‚Ä¢ ‡∏•‡∏î‡∏ö‡∏±‡∏Ñ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ú‡∏¥‡∏î</div>
              </div>
            </div>

            <div class="info">
              <div class="bold">‚úÖ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ó‡∏≥‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</div>
              <ol class="mt10 small muted" style="line-height:1.7;margin:0;padding-left:18px">
                <li>‡∏Å‡∏î‡πÄ‡∏°‡∏ô‡∏π ‚öôÔ∏è ‚Üí ‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Apps Script ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ <b>/exec</b> ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</li>
                <li>‡∏Å‡∏î üì° ‚Äú‡∏ó‡∏î‡∏™‡∏≠‡∏ö API‚Äù ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô pong = ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</li>
                <li>‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏î üìç ‚Äú‡∏Ç‡∏≠ GPS‚Äù ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô (GS ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö lat/lng ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ã‡∏ü)</li>
              </ol>
            </div>

            <div class="info mt14">
              <div class="bold">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</div>
              <ol class="mt10 small muted" style="line-height:1.7;margin:0;padding-left:18px">
                <li>‡∏Å‡∏î ‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á ‚Üí üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</li>
                <li>‡∏Å‡∏î üìç ‡∏Ç‡∏≠ GPS (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏≤)</li>
                <li>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ ‚Üí ‡∏Å‡∏î ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô</li>
              </ol>
            </div>

            <div class="info mt14">
              <div class="bold">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</div>
              <ol class="mt10 small muted" style="line-height:1.7;margin:0;padding-left:18px">
                <li>‡∏Å‡∏î üìç ‡∏Ç‡∏≠ GPS ‡∏Å‡πà‡∏≠‡∏ô</li>
                <li>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ + ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‚Üí ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</li>
              </ol>
              <div class="small muted mt10">
                ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: GS ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö note ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏ã‡∏ô GPS (IN/OUT/UNKNOWN)
                ‚Äî ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å ‚Äú‡πÅ‡∏ô‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô manualType‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢
              </div>
            </div>

            <div class="info mt14">
              <div class="bold">üß© HR</div>
              <ol class="mt10 small muted" style="line-height:1.7;margin:0;padding-left:18px">
                <li>‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (admin/password ‡∏ï‡∏≤‡∏° GS)</li>
                <li>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ ‚Üí ‚¨ÜÔ∏è ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</li>
              </ol>
            </div>
          </section>

        </div>
      </div>

      <!-- ===== SIDE (PC only) ===== -->
      <aside class="dOnly">
        <div class="card">
          <div class="cardH">
            <div>
              <div class="cardTitle">‚ö° ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (PC)</div>
              <div class="small muted">‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏£‡∏ß‡∏°‡πÑ‡∏ß‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÑ‡∏°‡πà‡∏£‡∏Å</div>
            </div>
            <span class="chip">üñ•Ô∏è Desktop</span>
          </div>

          <div class="cardB">

            <div class="info">
              <div class="bold">üîó ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</div>
              <div class="small muted mt8" id="sideApi">API: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div>
              <div class="small muted mt8" id="sideGps">GPS: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</div>

              <div class="btnbar mt12">
                <button class="btn" id="btnOpenDrawerSide" type="button">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL</button>
                <button class="btn" id="btnAskGpsSide" type="button">üìç ‡∏Ç‡∏≠ GPS</button>
                <button class="btn" id="btnPingSide" type="button">üì° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API</button>
              </div>
            </div>

            <div class="info mt14">
              <div class="bold">üì• ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (optional)</div>
              <div class="small muted mt8">
                ‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å <b>getInitialData</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (Employees) ‡∏°‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å code ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
              </div>
              <div class="btnbar mt12">
                <button class="btn primary" id="btnLoadInitSide" type="button">üì• ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
                <button class="btn" id="btnClearLocal" type="button">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</button>
              </div>
            </div>

            <div class="info mt14">
              <div class="bold">üßæ Log ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
              <div class="small muted mt8" id="lastLine">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ</div>
            </div>

          </div>
        </div>
      </aside>

    </div>

    <div class="footer">
      ¬© ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‚Ä¢ UI: White/Blue/Green ‚Ä¢ Designed for PC+Mobile ‚úÖ
    </div>
  </div>

  <!-- ===== Mobile Bottom Nav ===== -->
  <nav class="bottomNav mOnly">
    <button class="bnBtn active" data-sec="secScan" type="button"><div class="bnIcon">üì∑</div><div class="bnText">‡∏™‡πÅ‡∏Å‡∏ô</div></button>
    <button class="bnBtn" data-sec="secManual" type="button"><div class="bnIcon">üìù</div><div class="bnText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div></button>
    <button class="bnBtn" data-sec="secCheck" type="button"><div class="bnIcon">üîé</div><div class="bnText">‡πÄ‡∏ä‡πá‡∏Ñ</div></button>
    <button class="bnBtn" data-sec="secSummary" type="button"><div class="bnIcon">üìä</div><div class="bnText">‡∏™‡∏£‡∏∏‡∏õ</div></button>
    <button class="bnBtn" data-sec="secHR" type="button"><div class="bnIcon">üß©</div><div class="bnText">HR</div></button>
  </nav>

  <!-- ===== Drawer ===== -->
  <div class="backdrop" id="backdrop"></div>
  <aside class="drawer" id="drawer">
    <div class="drawerH">
      <div class="drawerTitle">‚öôÔ∏è ‡πÄ‡∏°‡∏ô‡∏π / ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div>
      <button class="btn" id="btnCloseDrawer" type="button">‡∏õ‡∏¥‡∏î</button>
    </div>

    <div class="drawerB">

      <div class="block">
        <div class="blockTitle">üîó ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL (Apps Script Web App)</div>
        <label>URL /exec</label>
        <input id="apiUrlInput" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå .../exec">
        <div class="btnbar mt12">
          <button class="btn primary" id="btnSaveUrl" type="button">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å URL</button>
          <button class="btn" id="btnResetUrl" type="button">‚ôªÔ∏è Reset URL</button>
        </div>
        <div class="small muted mt10">
          ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡∏ú‡πà‡∏≤‡∏ô HTTPS (GitHub Pages) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á/GPS ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
        </div>
      </div>

      <div class="hr"></div>

      <div class="block">
        <div class="blockTitle">üì° ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠</div>
        <div class="btnbar">
          <button class="btn" id="btnPingDrawer" type="button">üì° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API</button>
          <button class="btn" id="btnAskGpsDrawer" type="button">üìç ‡∏Ç‡∏≠ GPS</button>
          <button class="btn" id="btnLoadInitDrawer" type="button">üì• ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
        </div>
      </div>

      <div class="hr"></div>

      <div class="block">
        <div class="blockTitle">üìò ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß)</div>
        <ol class="small muted" style="line-height:1.7;margin:0;padding-left:18px">
          <li>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL /exec ‡∏Å‡πà‡∏≠‡∏ô (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</li>
          <li>‡∏Å‡∏î üìç ‡∏Ç‡∏≠ GPS (GS ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö lat/lng ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ã‡∏ü)</li>
          <li>‡πÑ‡∏õ üì∑ ‡∏™‡πÅ‡∏Å‡∏ô ‚Üí ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á ‚Üí ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ ‚Üí ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</li>
          <li>‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô: ‡πÑ‡∏õ üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏∑‡∏≠ ‚Üí ‡πÉ‡∏™‡πà‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</li>
          <li>‡πÄ‡∏ä‡πá‡∏Ñ: ‡πÑ‡∏õ üîé ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠ üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</li>
        </ol>
      </div>

    </div>
  </aside>

  <!-- ===== Toast ===== -->
  <div class="toast" id="toast">
    <div class="toastIn">
      <div class="toastMsg" id="toastMsg">‚Äî</div>
      <button class="toastClose" id="toastClose" type="button">‚úï</button>
    </div>
  </div>

  <script>
    ;(() => {
      "use strict";

      // =========================
      // Storage Keys (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
      // =========================
      const LS_API = "attendance_api_url_v2";
      const LS_LAST = "attendance_last_ui_log_v1";
      const LS_HR = "attendance_hr_token_v1"; // ‡πÄ‡∏Å‡πá‡∏ö token ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠ (‡πÅ‡∏°‡πâ GS ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)

      // =========================
      // DOM helpers
      // =========================
      const $ = (id) => document.getElementById(id);
      const $$ = (sel) => Array.from(document.querySelectorAll(sel));
      const isMobile = () => window.matchMedia("(max-width: 979px)").matches;

      // =========================
      // State
      // =========================
      let stream = null;
      let lastCaptureDataUrl = "";  // evidenceBase64
      let lastCaptureName = "";
      let lastGps = null;          // {lat,lng,acc}
      let busy = false;
      let lastSummary = [];        // cached summary rows
      let employeesCache = [];     // from getInitialData

      // =========================
      // Time helpers
      // =========================
      const pad2 = (n) => String(n).padStart(2, "0");
      function nowTH() {
        const d = new Date();
        const y = d.getFullYear() + 543;
        return `${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${y} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
      }
      function todayISO() {
        const d = new Date();
        return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
      }

      // =========================
      // Toast
      // =========================
      function toast(msg) {
        const el = $("toast");
        const msgEl = $("toastMsg");
        if (!el || !msgEl) return alert(msg);
        msgEl.textContent = msg;
        el.style.display = "block";
        clearTimeout(window.__t);
        window.__t = setTimeout(() => el.style.display = "none", 3200);
      }
      $("toastClose")?.addEventListener("click", () => ($("toast").style.display = "none"));

      // =========================
      // Busy lock
      // =========================
      function setBusy(v) {
        busy = v;
        const ids = [
          "btnStartCam","btnStopCam","btnCapture",
          "btnAskGps","btnAskGps2","btnAskGpsPC","btnAskGpsSide","btnAskGpsDrawer",
          "btnSubmitScan","btnSubmitManual",
          "btnCheck","btnLoadSummary",
          "btnPing","btnPingSide","btnPingDrawer",
          "btnSaveUrl","btnResetUrl",
          "btnLoadInit","btnLoadInitSide","btnLoadInitDrawer",
          "btnLogin","btnUploadFace",
          "btnExportCsv"
        ];
        ids.forEach(id => {
          const b = $(id);
          if (b && b.tagName === "BUTTON") b.disabled = !!v;
        });
      }

      // =========================
      // API URL
      // =========================
      function getApiUrl() {
        return (localStorage.getItem(LS_API) || "").trim();
      }
      function setApiUrl(url) {
        localStorage.setItem(LS_API, (url || "").trim());
        refreshApiUI();
      }
      function resetApiUrl() {
        localStorage.removeItem(LS_API);
        refreshApiUI();
      }
      function shortUrl(url) {
        if (!url) return "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤";
        try {
          const u = new URL(url);
          return u.hostname + u.pathname;
        } catch {
          return url.length > 44 ? url.slice(0,44)+"‚Ä¶" : url;
        }
      }
      function setApiState(state, text) {
        // state: ok | warn | bad
        const mDot = $("mDot"), pcDot = $("pcDot");
        const mTxt = $("mApiText"), pcTxt = $("pcApiText");
        const sideApi = $("sideApi");
        const pcApiShort = $("pcApiShort");

        if (pcApiShort) pcApiShort.textContent = shortUrl(getApiUrl());

        function apply(dot, txt) {
          if (!dot || !txt) return;
          dot.classList.remove("ok","warn","bad");
          dot.classList.add(state === "ok" ? "ok" : state === "bad" ? "bad" : "warn");
          txt.textContent = text;
        }

        apply(mDot, mTxt);
        apply(pcDot, pcTxt);

        if (sideApi) sideApi.textContent = "API: " + (text || "");
      }

      function refreshApiUI() {
        const url = getApiUrl();
        $("apiUrlInput") && ($("apiUrlInput").value = url);

        if (!url) {
          setApiState("warn", "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL");
          $("pcApiShort") && ($("pcApiShort").textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤");
          return;
        }
        setApiState("ok", "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö)");
      }

      // =========================
      // Drawer
      // =========================
      function openDrawer() {
        $("backdrop").style.display = "block";
        $("drawer").classList.add("open");
        $("apiUrlInput").value = getApiUrl();
      }
      function closeDrawer() {
        $("backdrop").style.display = "none";
        $("drawer").classList.remove("open");
      }

      $("btnOpenDrawerMobile")?.addEventListener("click", openDrawer);
      $("btnOpenDrawerPC")?.addEventListener("click", openDrawer);
      $("btnOpenDrawerSide")?.addEventListener("click", openDrawer);
      $("backdrop")?.addEventListener("click", closeDrawer);
      $("btnCloseDrawer")?.addEventListener("click", closeDrawer);

      $("btnSaveUrl")?.addEventListener("click", () => {
        const url = ($("apiUrlInput").value || "").trim();
        if (!url || !url.includes("/exec")) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á URL ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ /exec");
        setApiUrl(url);
        toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å URL ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
        closeDrawer();
      });
      $("btnResetUrl")?.addEventListener("click", () => {
        resetApiUrl();
        toast("Reset URL ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
      });

      // =========================
      // Navigation: sections
      // =========================
      const titleMap = {
        secScan: "üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å (‡πÉ‡∏ä‡πâ GS: saveManualLog)",
        secManual: "üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠ (saveManualLog)",
        secCheck: "üîé ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (getTodayByCode)",
        secSummary: "üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (getTodaySummary)",
        secHR: "üß© HR (loginAdmin + uploadEmployeeFace)",
        secHelp: "üìò ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
      };

      function showSection(id) {
        ["secScan","secManual","secCheck","secSummary","secHR","secHelp"].forEach(s => {
          $(s)?.classList.toggle("active", s === id);
        });

        // PC tabs
        $$("#tabs .tab").forEach(t => t.classList.toggle("active", t.dataset.sec === id));

        // Mobile bottom nav
        $$(".bottomNav .bnBtn").forEach(b => b.classList.toggle("active", b.dataset.sec === id));

        $("mainTitle").textContent = titleMap[id] || "‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô";
      }

      $$("#tabs .tab").forEach(t => t.addEventListener("click", () => showSection(t.dataset.sec)));
      $$(".bottomNav .bnBtn").forEach(b => b.addEventListener("click", () => showSection(b.dataset.sec)));

      // quick nav buttons
      $("btnGoScanPC")?.addEventListener("click", () => showSection("secScan"));
      $("btnGoSummaryPC")?.addEventListener("click", () => showSection("secSummary"));
      $("btnGoCheckFromScan")?.addEventListener("click", () => showSection("secCheck"));
      $("btnGoSummaryFromScan")?.addEventListener("click", () => showSection("secSummary"));
      $("btnGoCheckFromManual")?.addEventListener("click", () => showSection("secCheck"));
      $("btnToSummary")?.addEventListener("click", () => showSection("secSummary"));

      // =========================
      // API calls (GS ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö e.parameter ‚Üí ‡πÉ‡∏ä‡πâ x-www-form-urlencoded)
      // =========================
      async function postAction(action, params = {}) {
        const url = getApiUrl();
        if (!url) throw new Error("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL /exec");

        const body = new URLSearchParams();
        body.set("action", action);
        Object.entries(params).forEach(([k,v]) => {
          if (v === undefined || v === null) return;
          body.set(k, String(v));
        });

        const res = await fetch(url, {
          method: "POST",
          body
        });

        const text = await res.text();
        let json;
        try { json = JSON.parse(text); } catch { json = { ok:false, raw:text }; }

        if (!res.ok) throw new Error("HTTP " + res.status);
        if (!json || json.ok !== true) {
          throw new Error((json && json.error) ? json.error : "‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        }
        return json.result;
      }

      function buildGetPingUrl() {
        const base = getApiUrl();
        if (!base) return "";
        return base.includes("?") ? (base + "&action=ping") : (base + "?action=ping");
      }

      async function pingApi() {
        const url = buildGetPingUrl();
        if (!url) return toast("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL");
        try {
          setBusy(true);
          const res = await fetch(url, { method:"GET" });
          const text = await res.text();
          let json;
          try { json = JSON.parse(text); } catch { json = null; }

          if (res.ok && json && json.ok) {
            setApiState("ok","‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚úÖ (pong)");
            toast("API ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‚úÖ");
          } else {
            setApiState("bad","‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚ùå");
            toast("‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô: " + (json?.error || text || "unknown"));
          }
        } catch (e) {
          setApiState("bad","‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚ùå");
          toast("‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô: " + e.message);
        } finally {
          setBusy(false);
        }
      }

      $("btnPing")?.addEventListener("click", pingApi);
      $("btnPingSide")?.addEventListener("click", pingApi);
      $("btnPingDrawer")?.addEventListener("click", pingApi);

      // =========================
      // GPS (GS ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö lat/lng ‡∏ï‡∏≠‡∏ô saveManualLog)
      // =========================
      function setGpsUI(gps) {
        if (!gps) {
          $("gpsLine").textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Location";
          $("mGpsView").value = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Location";
          $("pcGpsText") && ($("pcGpsText").textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå");
          $("sideGps") && ($("sideGps").textContent = "GPS: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå");
          return;
        }
        const s = `lat=${gps.lat.toFixed(6)}, lng=${gps.lng.toFixed(6)} (¬±${Math.round(gps.acc)}m)`;
        $("gpsLine").textContent = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚úÖ " + s;
        $("mGpsView").value = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚úÖ " + s;
        $("pcGpsText") && ($("pcGpsText").textContent = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚úÖ");
        $("sideGps") && ($("sideGps").textContent = "GPS: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚úÖ");
      }

      function getGPS() {
        return new Promise((resolve) => {
          if (!navigator.geolocation) return resolve(null);
          navigator.geolocation.getCurrentPosition(
            (pos) => resolve({ lat: pos.coords.latitude, lng: pos.coords.longitude, acc: pos.coords.accuracy }),
            () => resolve(null),
            { enableHighAccuracy:true, timeout: 9000, maximumAge: 0 }
          );
        });
      }

      async function askGps() {
        try {
          setBusy(true);
          const gps = await getGPS();
          if (!gps) {
            lastGps = null;
            setGpsUI(null);
            toast("‡∏Ç‡∏≠ GPS ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Location");
            return;
          }
          lastGps = gps;
          setGpsUI(gps);
          toast("‡πÑ‡∏î‡πâ GPS ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
        } finally {
          setBusy(false);
        }
      }

      $("btnAskGps")?.addEventListener("click", askGps);
      $("btnAskGps2")?.addEventListener("click", askGps);
      $("btnAskGpsPC")?.addEventListener("click", askGps);
      $("btnAskGpsSide")?.addEventListener("click", askGps);
      $("btnAskGpsDrawer")?.addEventListener("click", askGps);

      // =========================
      // Camera
      // =========================
      async function loadCameras() {
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();
          const cams = devices.filter(d => d.kind === "videoinput");
          const sel = $("cameraSelect");
          if (!sel) return;
          sel.innerHTML = cams.map((c,i) =>
            `<option value="${c.deviceId}">${(c.label || ("Camera " + (i+1))).replaceAll("<","&lt;")}</option>`
          ).join("");
          if (cams.length && !sel.value) sel.value = cams[0].deviceId;
        } catch {}
      }

      function stopCam() {
        const v = $("video");
        if (stream) {
          stream.getTracks().forEach(t => t.stop());
          stream = null;
        }
        if (v) {
          v.pause();
          v.srcObject = null;
          v.style.display = "none";
        }
        $("camHint").style.display = "flex";
      }

      async function startCam() {
        stopCam();
        try {
          setBusy(true);

          const deviceId = $("cameraSelect").value || null;
          const facing = $("facingMode").value || "user";

          stream = await navigator.mediaDevices.getUserMedia({
            video: deviceId ? { deviceId:{ exact: deviceId } } : { facingMode: facing },
            audio:false
          });

          const v = $("video");
          v.srcObject = stream;
          await v.play();

          v.style.display = "block";
          $("camHint").style.display = "none";
          toast("‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
        } catch (e) {
          stopCam();
          toast("‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + (e.message || "unknown"));
        } finally {
          setBusy(false);
        }
      }

      function capture() {
        const v = $("video");
        if (!stream || !v || v.readyState < 2) return toast("‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°");
        const canvas = document.createElement("canvas");
        const w = v.videoWidth || 1280;
        const h = v.videoHeight || 720;
        canvas.width = w; canvas.height = h;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(v, 0, 0, w, h);

        // JPEG ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î
        const dataUrl = canvas.toDataURL("image/jpeg", 0.86);
        lastCaptureDataUrl = dataUrl;
        lastCaptureName = `evidence-capture-${Date.now()}.jpg`;

        $("thumb").src = dataUrl;
        $("previewInfo").textContent = `‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‚úÖ ${w}√ó${h}`;
        $("previewRow").style.display = "flex";
        toast("‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
      }

      $("btnStartCam")?.addEventListener("click", startCam);
      $("btnStopCam")?.addEventListener("click", () => { stopCam(); toast("‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß"); });
      $("btnCapture")?.addEventListener("click", capture);

      // =========================
      // File ‚Üí Base64 (DataURL)
      // =========================
      function fileToDataURL(file) {
        return new Promise((resolve, reject) => {
          const fr = new FileReader();
          fr.onload = () => resolve(fr.result);
          fr.onerror = () => reject(new Error("‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"));
          fr.readAsDataURL(file);
        });
      }

      // =========================
      // Save Scan (saveManualLog)
      // =========================
      async function submitScan() {
        if (busy) return;

        const code = ($("scanCode").value || "").trim();
        if (!code) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");

        // GPS required by GS
        if (!lastGps) {
          toast("‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ GPS ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (GS ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) ‚Äî ‡∏Å‡∏î ‚Äú‡∏Ç‡∏≠ GPS‚Äù");
          return;
        }

        setBusy(true);
        try {
          // evidenceBase64: priority file input > captured
          let evidenceBase64 = "";
          let evidenceName = "";

          const file = $("scanEvidenceFile").files?.[0] || null;
          if (file) {
            evidenceBase64 = await fileToDataURL(file);
            evidenceName = file.name || `evidence-${code}-${Date.now()}.jpg`;
          } else if (lastCaptureDataUrl) {
            evidenceBase64 = lastCaptureDataUrl;
            evidenceName = lastCaptureName || `evidence-${code}-${Date.now()}.jpg`;
          } else {
            // allowed (GS evidence optional) ‡πÅ‡∏ï‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏µ
            evidenceBase64 = "";
            evidenceName = "";
          }

          const manualType = ($("scanManualType").value || "SCAN").trim();

          const result = await postAction("saveManualLog", {
            code,
            lat: lastGps.lat,
            lng: lastGps.lng,
            evidenceBase64,
            evidenceName,
            manualType
          });

          // UI log
          localStorage.setItem(LS_LAST, JSON.stringify({
            at: nowTH(),
            title: `‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (SCAN) ‚Ä¢ ‡∏£‡∏´‡∏±‡∏™ ${code}`,
            detail: result?.status ? ("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + result.status) : "‚Äî"
          }));
          renderLast();

          toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
          showSection("secCheck");
          $("cCode").value = code;
          await checkToday();
        } catch (e) {
          toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
        } finally {
          setBusy(false);
        }
      }

      $("btnSubmitScan")?.addEventListener("click", submitScan);

      // =========================
      // Save Manual (saveManualLog)
      // - GS note ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô zone -> ‡πÄ‡∏£‡∏≤‡πÅ‡∏ô‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÑ‡∏õ‡∏Å‡∏±‡∏ö manualType ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢
      // =========================
      async function submitManual() {
        if (busy) return;

        const code = ($("mCode").value || "").trim();
        const reason = ($("mReason").value || "").trim();
        if (!code) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");
        if (!reason) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•");

        if (!lastGps) {
          toast("‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ GPS ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (GS ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) ‚Äî ‡∏Å‡∏î ‚Äú‡∏Ç‡∏≠ GPS‚Äù");
          return;
        }

        setBusy(true);
        try {
          // evidence optional
          let evidenceBase64 = "";
          let evidenceName = "";
          const file = $("mEvidenceFile").files?.[0] || null;
          if (file) {
            evidenceBase64 = await fileToDataURL(file);
            evidenceName = file.name || `manual-${code}-${Date.now()}.jpg`;
          }

          // manualType store reason to avoid loss
          const baseType = ($("mType").value || "MANUAL").trim();
          const safeReason = reason.replace(/\s+/g," ").slice(0, 80);
          const manualType = `${baseType}:${safeReason}`;

          const result = await postAction("saveManualLog", {
            code,
            lat: lastGps.lat,
            lng: lastGps.lng,
            evidenceBase64,
            evidenceName,
            manualType
          });

          localStorage.setItem(LS_LAST, JSON.stringify({
            at: nowTH(),
            title: `üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Ä¢ ‡∏£‡∏´‡∏±‡∏™ ${code}`,
            detail: safeReason
          }));
          renderLast();

          toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
          showSection("secCheck");
          $("cCode").value = code;
          await checkToday();
        } catch (e) {
          toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
        } finally {
          setBusy(false);
        }
      }

      $("btnSubmitManual")?.addEventListener("click", submitManual);

      // =========================
      // Check Today (getTodayByCode)
      // =========================
      async function checkToday() {
        const code = ($("cCode").value || "").trim();
        if (!code) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");

        setBusy(true);
        try {
          // GS ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö action getTodayByCode/checkTodayByCode
          const result = await postAction("getTodayByCode", { code });

          $("checkBox").style.display = "block";
          $("checkHint").textContent = "‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‚úÖ";
          $("checkBox").textContent = JSON.stringify(result, null, 2);

          toast("‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
        } catch (e) {
          $("checkBox").style.display = "block";
          $("checkHint").textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‚ùå";
          $("checkBox").textContent = e.message;
          toast("‡πÄ‡∏ä‡πá‡∏Ñ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
        } finally {
          setBusy(false);
        }
      }
      $("btnCheck")?.addEventListener("click", checkToday);

      // =========================
      // Summary Today (getTodaySummary)
      // =========================
      function classifyStatus(st) {
        const s = String(st || "");
        if (s === "‡∏Ç‡∏≤‡∏î") return "bad";
        if (!s || s === "‡∏õ‡∏Å‡∏ï‡∏¥") return "ok";
        return "warn";
      }

      function renderSummary(rows, filterText="") {
        const q = String(filterText || "").trim().toLowerCase();
        const body = $("sumBody");

        const filtered = rows.filter(r => {
          if (!q) return true;
          const t = `${r.code} ${r.fullName} ${r.branch} ${r.level} ${r.status}`.toLowerCase();
          return t.includes(q);
        });

        // KPI
        const all = filtered.length;
        let ok=0, bad=0, warn=0;
        filtered.forEach(r => {
          const k = classifyStatus(r.status);
          if (k==="ok") ok++;
          else if (k==="bad") bad++;
          else warn++;
        });
        $("kAll").textContent = all;
        $("kOk").textContent = ok;
        $("kAbsent").textContent = bad;
        $("kWarn").textContent = warn;

        if (!filtered.length) {
          body.innerHTML = `<tr><td colspan="6" class="muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô</td></tr>`;
          return;
        }

        body.innerHTML = filtered.map(r => {
          const t = [r.t1,r.t2,r.t3,r.t4].filter(Boolean).join(" ‚Ä¢ ") || "-";
          const cls = classifyStatus(r.status);
          const chipClass = cls==="ok" ? "ok" : cls==="bad" ? "bad" : "warn";
          return `
            <tr>
              <td class="bold">${escapeHtml(r.code)}</td>
              <td>${escapeHtml(r.fullName || "")}</td>
              <td>${escapeHtml(r.branch || "")}</td>
              <td>${escapeHtml(r.level || "")}</td>
              <td>${escapeHtml(t)}</td>
              <td><span class="statusChip ${chipClass}">${escapeHtml(r.status || "-")}</span></td>
            </tr>
          `;
        }).join("");
      }

      function escapeHtml(s){
        return String(s ?? "")
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }

      async function loadSummary() {
        setBusy(true);
        try {
          const rows = await postAction("getTodaySummary", {});
          // rows is array (GS returns array)
          lastSummary = Array.isArray(rows) ? rows : (rows.rows || []);
          renderSummary(lastSummary, $("sumSearch").value);
          toast("‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
        } catch (e) {
          toast("‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
        } finally {
          setBusy(false);
        }
      }

      $("btnLoadSummary")?.addEventListener("click", loadSummary);
      $("sumSearch")?.addEventListener("input", () => renderSummary(lastSummary, $("sumSearch").value));

      // Export CSV
      function toCSV(rows){
        const headers = ["date","code","fullName","branch","level","t1","t2","t3","t4","tExtra1","tExtra2","status","evidenceUrl","locationText","lat","lng"];
        const esc = (v) => {
          const s = String(v ?? "");
          const needs = /[",\n]/.test(s);
          const q = s.replaceAll('"','""');
          return needs ? `"${q}"` : q;
        };
        const lines = [];
        lines.push(headers.join(","));
        rows.forEach(r => {
          lines.push(headers.map(h => esc(r[h])).join(","));
        });
        return lines.join("\n");
      }
      function download(name, text){
        const blob = new Blob([text], { type:"text/csv;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = name;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }
      $("btnExportCsv")?.addEventListener("click", () => {
        if (!lastSummary.length) return toast("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Äî ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡πà‡∏≠‡∏ô");
        const csv = toCSV(lastSummary);
        download(`today_summary_${todayISO()}.csv`, csv);
      });

      // =========================
      // HR Login + Upload Face
      // =========================
      function setHrState(ok, msg){
        const dot = $("hrDot");
        const txt = $("hrText");
        dot.classList.remove("ok","warn","bad");
        dot.classList.add(ok ? "ok" : "warn");
        txt.textContent = msg;
      }
      setHrState(false, "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô");

      async function loginHR(){
        const username = ($("hrUser").value || "").trim();
        const password = ($("hrPass").value || "").trim();
        if (!username || !password) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Username/Password");

        setBusy(true);
        try{
          const res = await postAction("loginAdmin", { username, password });
          const token = res?.token || "";
          localStorage.setItem(LS_HR, token);
          setHrState(true, "‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
          toast("‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
        }catch(e){
          setHrState(false, "‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô");
          toast("‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
        }finally{
          setBusy(false);
        }
      }
      $("btnLogin")?.addEventListener("click", loginHR);

      async function uploadFace(){
        const code = ($("faceCode").value || "").trim();
        const file = $("faceFile").files?.[0] || null;
        const faceData = ($("faceData").value || "").trim();

        if (!code) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");
        if (!file) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤");

        setBusy(true);
        try{
          const photoBase64 = await fileToDataURL(file);
          const fileName = file.name || `face-${code}-${Date.now()}.jpg`;

          const res = await postAction("uploadEmployeeFace", {
            code,
            photoBase64,
            fileName,
            faceData
          });

          $("hrBox").style.display = "block";
          $("hrBox").textContent = JSON.stringify(res, null, 2);

          localStorage.setItem(LS_LAST, JSON.stringify({
            at: nowTH(),
            title: `üôÇ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ ‚Ä¢ ‡∏£‡∏´‡∏±‡∏™ ${code}`,
            detail: fileName
          }));
          renderLast();

          toast("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
        }catch(e){
          $("hrBox").style.display = "block";
          $("hrBox").textContent = e.message;
          toast("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
        }finally{
          setBusy(false);
        }
      }
      $("btnUploadFace")?.addEventListener("click", uploadFace);

      // =========================
      // getInitialData -> ‡πÄ‡∏ï‡∏¥‡∏° datalist code
      // =========================
      function fillCodes(emps){
        const dl = $("dlCodes");
        if (!dl) return;
        const list = (emps || [])
          .map(e => ({
            code: String(e.code || "").trim(),
            name: String(e.fullName || e.fullname || "").trim()
          }))
          .filter(x => x.code);

        dl.innerHTML = list.map(x => `<option value="${escapeHtml(x.code)}">${escapeHtml(x.name)}</option>`).join("");
      }

      async function loadInitial(){
        setBusy(true);
        try{
          const res = await postAction("getInitialData", {});
          employeesCache = res?.employees || [];
          fillCodes(employeesCache);
          toast("‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
        }catch(e){
          toast("‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
        }finally{
          setBusy(false);
        }
      }
      $("btnLoadInit")?.addEventListener("click", loadInitial);
      $("btnLoadInitSide")?.addEventListener("click", loadInitial);
      $("btnLoadInitDrawer")?.addEventListener("click", loadInitial);

      // =========================
      // UI last log
      // =========================
      function renderLast(){
        const raw = localStorage.getItem(LS_LAST);
        const el = $("lastLine");
        if (!el) return;
        if (!raw) { el.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ"; return; }
        try{
          const o = JSON.parse(raw);
          el.textContent = `${o.at} ‚Ä¢ ${o.title}`;
        }catch{
          el.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ";
        }
      }
      $("btnClearLocal")?.addEventListener("click", () => {
        localStorage.removeItem(LS_LAST);
        toast("‡∏•‡πâ‡∏≤‡∏á log ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
        renderLast();
      });

      // =========================
      // Init
      // =========================
      function initDateUI(){
        $("nowBadge").textContent = nowTH();
        $("pcNow") && ($("pcNow").textContent = nowTH());
        $("cDate").value = todayISO();

        setInterval(() => {
          $("nowBadge").textContent = nowTH();
          $("pcNow") && ($("pcNow").textContent = nowTH());
        }, 10000);
      }

      async function initCameraList(){
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return;

        // ‡∏Ç‡∏≠ permission ‡πÄ‡∏ö‡∏≤‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ label ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÇ‡∏ä‡∏ß‡πå
        try{
          const tmp = await navigator.mediaDevices.getUserMedia({ video:true, audio:false });
          tmp.getTracks().forEach(t => t.stop());
        }catch{}

        await loadCameras();
      }

      function init(){
        initDateUI();
        refreshApiUI();
        setGpsUI(null);
        renderLast();
        showSection("secScan");
        initCameraList();
      }

      init();
    })();
  </script>

</body>
</html>
