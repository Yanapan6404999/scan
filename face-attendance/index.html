<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ระบบเช็คอินพนักงาน • Attendance</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./app.css" />
</head>

<body>
  <!-- ===== Mobile App Header (เหมือนแอป) ===== -->
  <div class="mHeader mOnly" id="mobileHeader">
    <div class="mHeaderCard">
      <div class="mHeaderLeft">
        <div class="mTitleRow">
          <div class="mLogo">🕒</div>
          <div>
            <div class="mTitle">ระบบเช็คอินพนักงาน</div>
            <div class="mSub">
              <span>สถานะ API:</span>
              <span class="statusChip" id="mStatusChip">
                <span class="dot warn" id="mApiDot"></span>
                <span class="chipText" id="mApiText">ยังไม่ได้ตั้งค่า URL</span>
              </span>
            </div>
          </div>
        </div>
      </div>

      <button class="mMenuBtn" id="btnMobileMenu" type="button" aria-label="menu">
        <span class="mHamburger">≡</span>
        <span class="mMenuIcons">⚙️ 🧩</span>
        <span class="mMenuText">เมนู</span>
      </button>
    </div>
  </div>

  <!-- ===== Desktop Top Hero (เว็บหรู) ===== -->
  <div class="wrap dOnly">
    <div class="heroCard" id="pcHero">
      <div class="heroTop">
        <div>
          <div class="heroTitle">ระบบเช็คอินพนักงาน</div>
          <div class="heroSub">
            📌 โหมดเว็บ (PC) • ฟีเจอร์ครบ • โทนขาว-น้ำเงิน-เขียว • ใช้สำหรับ HR/หัวหน้า/พนักงานได้
          </div>
          <div class="heroMeta" id="pcMetaLine">
            <span class="metaItem">🕘 เวลา: <span id="pcNowText">—</span></span>
            <span class="metaSep">•</span>
            <span class="metaItem">🖥️ อุปกรณ์: <span id="pcDeviceText">Desktop</span></span>
            <span class="metaSep">•</span>
            <span class="metaItem">🔗 API: <span id="pcApiUrlShort">ยังไม่ได้ตั้งค่า</span></span>
          </div>
        </div>

        <div class="heroActions">
          <button class="btn ghost" type="button" id="btnOpenDrawerPC">⚙️ ตั้งค่า URL</button>
          <button class="btn" type="button" id="btnPingPC">📡 ทดสอบ API</button>
          <button class="btn" type="button" id="btnClearPC">🧹 ล้างค่าเครื่องนี้</button>
        </div>
      </div>

      <!-- ✅ สถานะเชื่อมต่อ/ยังไม่เชื่อมต่อ (ชิดขวาล่างของการ์ด PC ตามที่สั่ง) -->
      <div class="pcConnPill" id="pcConnPill">
        <span class="dot warn" id="pcApiDot"></span>
        <span id="pcApiText">ยังไม่ได้ตั้งค่า URL</span>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <!-- ===== MAIN CARD ===== -->
      <div class="card">
        <div class="card-h">
          <div>
            <p class="title" id="mainTitle">📷 โหมดสแกน / บันทึก / ตรวจสอบ</p>
            <div class="smallmuted" id="mainSub">มือถือจะเหมือนแอป (มีเมนู 3 ขีด + แถบล่าง) • PC จะเป็นเว็บหรู (ไม่มี 3 ขีด)</div>
          </div>
          <div class="badge" id="nowBadge">—</div>
        </div>

        <div class="card-b">
          <!-- Desktop Tabs -->
          <div class="tabs dOnly" id="desktopTabs">
            <button class="tab active" data-target="secScan" type="button">📷 สแกนเข้า-ออก</button>
            <button class="tab" data-target="secManual" type="button">📝 บันทึกด้วยมือ</button>
            <button class="tab" data-target="secCheck" type="button">🔎 ตรวจสอบวันนี้</button>
            <button class="tab" data-target="secHR" type="button">🧰 HR / แอดมิน</button>
          </div>

          <!-- SECTION: SCAN -->
          <section class="section active" id="secScan">
            <div class="sectionHead mOnly">
              <div class="sectionEmoji">📷</div>
              <div>
                <div class="sectionTitle">สแกนเข้า-ออก</div>
                <div class="sectionHint">ถ่ายรูปเป็นหลักฐาน + (ถ้ามี) GPS + ส่งไป Apps Script</div>
              </div>
            </div>

            <div class="cam">
              <div class="cambox">
                <video id="video" playsinline muted></video>
                <div class="camhint" id="camHint">
                  กล้องปิดอยู่<br>
                  กด “เริ่มกล้อง” → “ถ่ายรูป” ก่อนบันทึก (แนะนำ)
                </div>
              </div>

              <div class="row mt12">
                <div class="col">
                  <label>🎥 เลือกกล้อง</label>
                  <select id="cameraSelect">
                    <option value="">—</option>
                  </select>
                </div>
                <div class="col">
                  <label>🔁 ประเภท</label>
                  <select id="scanType">
                    <option value="IN">เข้า</option>
                    <option value="OUT">ออก</option>
                  </select>
                </div>
              </div>

              <div class="btnbar mt10">
                <button class="btn primary" id="btnStartCam" type="button">▶️ เริ่มกล้อง</button>
                <button class="btn danger" id="btnStopCam" type="button">⏹️ ปิดกล้อง</button>
                <button class="btn" id="btnCapture" type="button">📸 ถ่ายรูป</button>
              </div>

              <div class="preview" id="previewRow">
                <img id="thumb" class="thumb" alt="preview">
                <div>
                  <div class="strong">✅ มีรูปพร้อมส่งแล้ว</div>
                  <div class="smallmuted" id="previewInfo">—</div>
                </div>
              </div>

              <div class="help">
                ✅ แนะนำ: ถ่ายรูปทุกครั้งก่อน “บันทึกการสแกน” เพื่อเป็นหลักฐานชัดเจน
              </div>
            </div>

            <div class="row mt14">
              <div class="col">
                <label>🆔 รหัสพนักงาน</label>
                <input id="scanCode" inputmode="numeric" placeholder="เช่น 1001" />
              </div>
              <div class="col">
                <label>🗒️ หมายเหตุ (ถ้ามี)</label>
                <input id="scanNote" placeholder="เช่น ลืมบัตร / เข้ากะเช้า" />
              </div>
            </div>

            <div class="row mt12">
              <div class="col">
                <label>📍 ใช้ GPS (แนะนำบนมือถือ)</label>
                <select id="useGps">
                  <option value="1" selected>เปิด</option>
                  <option value="0">ปิด</option>
                </select>
              </div>
              <div class="col">
                <label>🧾 แนบหลักฐานเพิ่ม (ถ้ามี)</label>
                <input id="scanEvidence" type="file" accept="image/*" />
              </div>
            </div>

            <div class="btnbar mt14">
              <button class="btn good" id="btnSubmitScan" type="button">✅ บันทึกการสแกน</button>
              <button class="btn ghost" id="btnQuickCheck" type="button">🔎 ไปหน้าเช็ควันนี้</button>
            </div>
          </section>

          <!-- SECTION: MANUAL -->
          <section class="section" id="secManual">
            <div class="sectionHead mOnly">
              <div class="sectionEmoji">📝</div>
              <div>
                <div class="sectionTitle">บันทึกด้วยมือ</div>
                <div class="sectionHint">ใช้เมื่อ “ลืมสแกน/ระบบมีปัญหา” (HR/หัวหน้าแนะนำ)</div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                <label>🆔 รหัสพนักงาน</label>
                <input id="mCode" inputmode="numeric" placeholder="เช่น 1001" />
              </div>
              <div class="col">
                <label>🔁 ประเภท</label>
                <select id="mType">
                  <option value="IN">เข้า</option>
                  <option value="OUT">ออก</option>
                </select>
              </div>
            </div>

            <div class="row mt12">
              <div class="col">
                <label>🗒️ เหตุผล/หมายเหตุ</label>
                <textarea id="mReason" placeholder="เช่น ลืมสแกนตอนเช้า / ระบบล่ม / ขออนุมัติหัวหน้าแล้ว"></textarea>
              </div>
            </div>

            <div class="row mt12">
              <div class="col">
                <label>📍 ใช้ GPS</label>
                <select id="mUseGps">
                  <option value="1" selected>เปิด</option>
                  <option value="0">ปิด</option>
                </select>
              </div>
              <div class="col">
                <label>🧾 แนบหลักฐาน (ถ้ามี)</label>
                <input id="mEvidence" type="file" accept="image/*" />
              </div>
            </div>

            <div class="btnbar mt14">
              <button class="btn good" id="btnSubmitManual" type="button">✅ บันทึกด้วยมือ</button>
            </div>
          </section>

          <!-- SECTION: CHECK -->
          <section class="section" id="secCheck">
            <div class="sectionHead mOnly">
              <div class="sectionEmoji">🔎</div>
              <div>
                <div class="sectionTitle">ตรวจสอบวันนี้</div>
                <div class="sectionHint">เช็คข้อมูลของรหัสพนักงาน หรือดูภาพรวมวันนี้</div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                <label>🆔 รหัสพนักงาน</label>
                <input id="cCode" inputmode="numeric" placeholder="เช่น 1001" />
              </div>
              <div class="col">
                <label>📅 วันที่</label>
                <input id="cDate" type="date" />
              </div>
            </div>

            <div class="btnbar mt14">
              <button class="btn primary" id="btnCheckByCode" type="button">🔎 เช็คของวันนี้</button>
              <button class="btn" id="btnTodaySummary" type="button">📊 ภาพรวมวันนี้</button>
            </div>

            <div class="innerCard mt14">
              <div class="innerHead">
                <div class="innerTitle">🧾 ผลลัพธ์</div>
                <div class="badge" id="resultBadge">—</div>
              </div>
              <div class="innerBody" id="resultBox">
                <div class="smallmuted">ยังไม่มีข้อมูล — แนะนำให้กด “เช็คของวันนี้”</div>
              </div>
            </div>
          </section>

          <!-- SECTION: HR -->
          <section class="section" id="secHR">
            <div class="sectionHead mOnly">
              <div class="sectionEmoji">🧰</div>
              <div>
                <div class="sectionTitle">HR / แอดมิน</div>
                <div class="sectionHint">ล็อกอิน + อัปโหลดใบหน้า + ปุ่มไปหน้า admin.html (ถ้ามี)</div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                <label>👤 Username</label>
                <input id="hrUser" placeholder="admin" />
              </div>
              <div class="col">
                <label>🔒 Password</label>
                <input id="hrPass" type="password" placeholder="••••••••" />
              </div>
            </div>

            <div class="btnbar mt14">
              <button class="btn primary" id="btnLogin" type="button">🔐 เข้าสู่ระบบ</button>
              <a class="btn" id="btnGoAdmin" href="./admin.html" target="_blank" rel="noopener"
                 style="pointer-events:none; opacity:.55">🧩 ไปหน้า admin.html</a>
            </div>

            <div class="divider"></div>

            <div class="row">
              <div class="col">
                <label>🆔 ลงทะเบียนใบหน้า (HR) – รหัสพนักงาน</label>
                <input id="regCode" inputmode="numeric" placeholder="เช่น 1001" />
              </div>
              <div class="col">
                <label>🙂 อัปโหลดรูปใบหน้า (ถ่าย/เลือกไฟล์)</label>
                <input id="regFace" type="file" accept="image/*" />
              </div>
            </div>

            <div class="btnbar mt14">
              <button class="btn good" id="btnUploadFace" type="button">⬆️ อัปโหลดใบหน้า</button>
            </div>

            <div class="help">
              ✅ ใช้ action: <b>uploadEmployeeFace</b> (ไฟล์ field ชื่อ <b>face</b>)<br>
              ถ้าอัปโหลดไม่เข้า ให้เช็ค Apps Script ว่ารับไฟล์ได้ + permission Drive/Folder ครบ
            </div>
          </section>
        </div>
      </div>

      <!-- ===== SIDE CARD (PC เท่านั้น / Mobile ซ่อนเพื่อไม่รก) ===== -->
      <aside class="side dOnly">
        <div class="card">
          <div class="card-h">
            <div>
              <p class="title">📌 สถานะล่าสุด</p>
              <div class="smallmuted">โซนนี้สำหรับ PC เพื่อดูเร็ว ๆ ไม่รก</div>
            </div>
            <div class="badge" id="deviceBadge">Desktop</div>
          </div>
          <div class="card-b">
            <div class="innerCard">
              <div class="innerHead">
                <div class="innerTitle">✅ บันทึกล่าสุด</div>
                <div class="badge" id="lastBadge">—</div>
              </div>
              <div class="innerBody" id="lastBox">
                <div class="smallmuted">ยังไม่มีรายการ</div>
              </div>
            </div>

            <div class="innerCard mt12">
              <div class="innerHead">
                <div class="innerTitle">⚡ ปุ่มลัด</div>
                <div class="badge">ไม่รก</div>
              </div>
              <div class="innerBody">
                <div class="btnbar">
                  <button class="btn" type="button" id="btnOpenDrawerSide">⚙️ ตั้งค่า URL</button>
                  <button class="btn" type="button" id="btnPingSide">📡 ทดสอบ API</button>
                  <button class="btn" type="button" id="btnClearSide">🧹 ล้างค่า</button>
                </div>
                <div class="help">
                  📌 หมายเหตุ: ระบบนี้ “ตัดการ์ดที่อยู่/ติดต่อร้าน” ออกเรียบร้อยแล้ว (ตามที่สั่ง)
                </div>
              </div>
            </div>

            <div class="innerCard mt12">
              <div class="innerHead">
                <div class="innerTitle">📘 วิธีใช้งานสั้นๆ</div>
                <div class="badge">พนักงานอ่าน</div>
              </div>
              <div class="innerBody">
                <ol class="miniList">
                  <li>กด ⚙️ ตั้งค่า URL → วางลิงก์ <b>.../exec</b> → บันทึก</li>
                  <li>ไปแท็บ 📷 สแกน → กด ▶️ เริ่มกล้อง → 📸 ถ่ายรูป</li>
                  <li>กรอกรหัส → ✅ บันทึกการสแกน</li>
                  <li>เช็คย้อนหลัง: ไป 🔎 ตรวจสอบวันนี้</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- ===== Mobile Bottom Nav (เหมือนแอป) ===== -->
  <nav class="bottomNav mOnly" id="bottomNav">
    <button class="bnBtn active" data-target="secScan" type="button">
      <div class="bnIco">📷</div><div class="bnTxt">สแกน</div>
    </button>
    <button class="bnBtn" data-target="secManual" type="button">
      <div class="bnIco">📝</div><div class="bnTxt">บันทึก</div>
    </button>
    <button class="bnBtn" data-target="secCheck" type="button">
      <div class="bnIco">🔎</div><div class="bnTxt">เช็ค</div>
    </button>
    <button class="bnBtn" data-target="secHR" type="button">
      <div class="bnIco">🧰</div><div class="bnTxt">HR</div>
    </button>
  </nav>

  <!-- ===== Drawer (Mobile/PC ใช้ได้ แต่เปิดจากปุ่ม ไม่ใช่ 3 ขีดบน PC) ===== -->
  <div class="drawerBackdrop" id="drawerBackdrop"></div>
  <aside class="drawer" id="drawer">
    <div class="drawerHead">
      <div class="drawerTitle">⚙️ เมนู / ตั้งค่า</div>
      <button class="btn" type="button" id="btnCloseDrawer">ปิด</button>
    </div>

    <div class="drawerBody">
      <div class="drawerBlock">
        <div class="drawerBlockTitle">🔗 ตั้งค่า URL (Apps Script Web App)</div>
        <label>URL /exec</label>
        <input id="apiUrlInput" placeholder="วางลิงก์ .../exec" />
        <div class="btnbar mt12">
          <button class="btn primary" id="btnSaveUrl" type="button">💾 บันทึก URL</button>
          <button class="btn" id="btnResetUrl" type="button">♻️ Reset URL</button>
        </div>
        <div class="help">
          ถ้ากล้อง/GPS ใช้ไม่ได้: ต้องเปิดผ่าน <b>HTTPS</b> และอนุญาต Permission
        </div>
      </div>

      <div class="divider"></div>

      <div class="drawerBlock">
        <div class="drawerBlockTitle">🧠 คู่มือพนักงาน (อ่านเร็ว)</div>
        <ol class="miniList">
          <li>เปิดเมนู → ตั้งค่า URL ให้เรียบร้อย (ทำครั้งแรกครั้งเดียว)</li>
          <li>แท็บ 📷 สแกน → เริ่มกล้อง → ถ่ายรูป → กรอกรหัส → บันทึก</li>
          <li>แท็บ 📝 บันทึก → ใช้กรณีลืมสแกน (ต้องใส่เหตุผล)</li>
          <li>แท็บ 🔎 เช็ค → เช็คของวันนี้/ดูภาพรวม</li>
          <li>แท็บ 🧰 HR → ล็อกอิน + อัปโหลดใบหน้า (ถ้าระบบเปิดใช้งาน)</li>
        </ol>
      </div>

      <div class="divider"></div>

      <div class="drawerBlock">
        <div class="drawerBlockTitle">⚡ เครื่องมือ</div>
        <div class="btnbar">
          <button class="btn" type="button" id="btnPingDrawer">📡 ทดสอบ API</button>
          <button class="btn" type="button" id="btnClearLocal">🧹 ล้างค่าเครื่องนี้</button>
          <a class="btn" href="./admin.html" target="_blank" rel="noopener">🧩 เปิด admin.html</a>
        </div>
      </div>
    </div>
  </aside>

  <!-- ===== Toast ===== -->
  <div class="toast" id="toast">
    <div class="toastIn">
      <div class="toastMsg" id="toastMsg">—</div>
      <button class="toastClose" id="toastClose" aria-label="close">✕</button>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
