<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;

      --primary:#2563eb;
      --primary-soft:#dbeafe;

      --success:#16a34a;
      --success-soft:#dcfce7;

      --warning:#f59e0b;
      --warning-soft:#fef3c7;

      --danger:#ef4444;
      --danger-soft:#fee2e2;

      --shadow: 0 12px 30px rgba(2,6,23,.10);
      --shadow-soft: 0 10px 25px rgba(2,6,23,.08);

      --radius: 18px;
      --radius-lg: 22px;
      --radius-sm: 14px;

      --maxw: 1120px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Prompt", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 400px at 70% -40%, rgba(37,99,235,.18), transparent 55%),
                  radial-gradient(900px 320px at 20% -30%, rgba(34,197,94,.18), transparent 60%),
                  var(--bg);
      overflow-x:hidden; /* ‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤‡∏•‡πâ‡∏ô‡∏à‡∏≠ */
    }

    a{color:inherit}
    button, input, select{
      font-family:inherit;
    }

    /* ===== Layout ===== */
    .wrap{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 18px 18px 24px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    @media (min-width: 980px){
      .grid{
        grid-template-columns: 1.15fr .85fr;
        gap: 16px;
      }
    }

    /* ===== Header Card ===== */
    .hero{
      border-radius: 26px;
      background: linear-gradient(135deg, #0b1224, #0b1a3a 55%, #061028);
      color:#e5e7eb;
      padding: 18px;
      box-shadow: var(--shadow);
      position: relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(600px 200px at 80% 20%, rgba(37,99,235,.45), transparent 60%),
                  radial-gradient(500px 180px at 20% 80%, rgba(34,197,94,.35), transparent 60%);
      opacity:.65;
      pointer-events:none;
    }
    .hero > *{position:relative; z-index:1}

    .hero-top{
      display:flex;
      gap: 14px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .hero-title{
      font-size: 24px;
      font-weight: 800;
      letter-spacing:.2px;
      margin:0;
    }
    .hero-sub{
      margin: 2px 0 0;
      color: rgba(229,231,235,.80);
      font-size: 13px;
      line-height: 1.35;
    }
    .api-line{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(229,231,235,.85);
      word-break: break-all;
      opacity:.9;
    }

    .hero-actions{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top: 12px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 13px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(2,6,23,.30);
      color:#e5e7eb;
      user-select:none;
      white-space:nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;background:#94a3b8;
      box-shadow: 0 0 0 4px rgba(148,163,184,.18);
    }
    .dot.ok{
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34,197,94,.22);
    }
    .menu-btn{
      width: 46px; height: 46px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(2,6,23,.30);
      color:#e5e7eb;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
    }
    .menu-btn:active{transform: scale(.98)}
    .menu-btn svg{width: 22px; height: 22px}

    /* ===== Cards ===== */
    .card{
      background: var(--card);
      border:1px solid rgba(2,6,23,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      overflow:hidden;
    }
    .card-hd{
      padding: 14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }
    .card-title{
      display:flex; align-items:center; gap:10px;
      margin:0;
      font-size: 16px;
      font-weight: 800;
      letter-spacing:.2px;
    }
    .card-sub{
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.45;
    }
    .card-bd{padding: 0 14px 14px;}

    .badge{
      padding: 6px 10px;
      border-radius:999px;
      font-size: 12px;
      font-weight: 700;
      border:1px solid rgba(2,6,23,.06);
      background:#f8fafc;
      color:#0f172a;
      white-space:nowrap;
    }
    .badge.danger{background: var(--danger-soft); color: #991b1b; border-color: rgba(239,68,68,.18)}
    .badge.ok{background: var(--success-soft); color: #166534; border-color: rgba(34,197,94,.18)}
    .badge.warn{background: var(--warning-soft); color: #92400e; border-color: rgba(245,158,11,.2)}

    /* ===== Buttons ===== */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(2,6,23,.12);
      background:#fff;
      color:#0f172a;
      font-weight: 700;
      font-size: 14px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      user-select:none;
    }
    .btn:active{transform: scale(.99)}
    .btn.primary{background: var(--primary); border-color: rgba(37,99,235,.22); color:#fff}
    .btn.success{background: #22c55e; border-color: rgba(34,197,94,.25); color:#fff}
    .btn.ghost{background: #f8fafc}
    .btn.small{padding: 8px 10px; font-size: 13px; border-radius: 12px}
    .btn.wide{width:100%}

    .btn-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .btn-row .btn{flex: 1 1 auto}
    @media (min-width: 980px){
      .btn-row .btn{flex: 0 0 auto}
    }

    /* ===== Camera Box ===== */
    .cam-top{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom: 10px;
    }
    .cam-box{
      border: 2px dashed rgba(2,6,23,.12);
      border-radius: var(--radius-lg);
      background: linear-gradient(180deg, #f1f5ff, #f8fafc);
      height: 420px; /* PC default */
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }
    .cam-box video{
      width:100%;
      height:100%;
      object-fit:cover;
      display:none;
    }
    .cam-empty{
      text-align:center;
      color: var(--muted);
      font-weight:700;
    }
    .cam-empty .big{
      font-size: 20px;
      color:#334155;
      margin-top: 8px;
    }
    .cam-empty .small{
      margin-top: 6px;
      font-weight: 500;
      font-size: 13px;
      color: var(--muted);
    }
    .cam-fab{
      position:absolute;
      right: 14px;
      bottom: 14px;
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: none;
      background: #fff;
      box-shadow: var(--shadow);
      cursor:pointer;
      display:none;
      align-items:center;
      justify-content:center;
    }
    .cam-fab:active{transform: scale(.98)}
    .cam-fab svg{width: 26px; height: 26px}

    .cam-controls{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .cam-controls .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .select{
      width:100%;
      border:1px solid rgba(2,6,23,.12);
      background:#fff;
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 700;
      color:#0f172a;
      outline:none;
    }
    .note{
      border-radius: 16px;
      border:1px solid rgba(2,6,23,.08);
      background: #f8fafc;
      padding: 12px;
      color:#0f172a;
      font-size: 13px;
      line-height:1.55;
    }
    .note b{font-weight: 800}

    /* ===== Tables ===== */
    table{
      width:100%;
      border-collapse: collapse;
    }
    th,td{
      border-bottom: 1px solid rgba(2,6,23,.08);
      padding: 10px 10px;
      font-size: 13px;
      text-align:left;
      vertical-align:top;
      white-space:nowrap;
    }
    th{
      color:#334155;
      font-weight: 800;
      background: #f8fafc;
    }
    .table-wrap{
      border:1px solid rgba(2,6,23,.08);
      border-radius: 16px;
      overflow:hidden;
      background:#fff;
    }

    /* Mobile summary: allow horizontal scroll inside card */
    .table-scroll{
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
    }
    .table-scroll table{
      min-width: 820px; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡∏ö‡∏µ‡∏ö */
    }

    /* ===== PC-only / Mobile-only ===== */
    .pc-only{display:none}
    .m-only{display:block}
    @media (min-width: 980px){
      .pc-only{display:block}
      .m-only{display:none}
    }

    /* ===== Bottom Nav (Mobile only) ===== */
    .bottom-nav{
      position: fixed;
      left: 0; right: 0;
      bottom: 0;
      padding: 10px 14px calc(10px + env(safe-area-inset-bottom, 0px));
      background: rgba(255,255,255,.88);
      backdrop-filter: blur(14px);
      border-top: 1px solid rgba(2,6,23,.10);
      display:flex;
      justify-content:center;
      z-index: 40;
    }
    .bottom-nav-inner{
      width: min(520px, 100%);
      display:flex;
      gap: 10px;
      background: #eef2ff;
      border:1px solid rgba(2,6,23,.08);
      border-radius: 22px;
      padding: 8px;
      box-shadow: 0 10px 25px rgba(2,6,23,.08);
    }
    .nav-item{
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 6px;
      padding: 10px 6px;
      border-radius: 18px;
      cursor:pointer;
      user-select:none;
      transition: background .12s ease, transform .12s ease;
      color:#334155;
      font-weight: 800;
      font-size: 12px;
    }
    .nav-item:active{transform: scale(.99)}
    .nav-item.active{
      background: #ffffff;
      border:1px solid rgba(2,6,23,.06);
      box-shadow: 0 10px 20px rgba(2,6,23,.08);
    }
    .nav-item .ic{
      width: 34px; height: 34px;
      border-radius: 999px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(255,255,255,.7);
      border:1px solid rgba(2,6,23,.06);
    }

    /* Content padding bottom on mobile so it won't be covered by nav */
    .pad-bottom{
      padding-bottom: 92px;
    }

    /* ===== Dialogs ===== */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(2,6,23,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 80;
      padding: 16px;
    }
    .overlay.show{display:flex}

    .modal{
      width: min(720px, 100%);
      background: #fff;
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      border:1px solid rgba(2,6,23,.10);
      max-height: min(88vh, 760px);
      display:flex;
      flex-direction:column;
    }
    .modal-hd{
      padding: 14px 14px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(2,6,23,.08);
      background:#fff;
    }
    .modal-title{
      margin:0;
      font-size: 16px;
      font-weight: 900;
    }
    .modal-bd{
      padding: 14px;
      overflow:auto;
    }
    .xbtn{
      width: 40px; height: 40px;
      border-radius: 999px;
      border:1px solid rgba(2,6,23,.10);
      background:#fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .field{
      display:grid;
      gap: 8px;
      margin-bottom: 12px;
    }
    .label{
      font-weight: 900;
      font-size: 13px;
      color:#0f172a;
    }
    .input{
      width:100%;
      padding: 11px 12px;
      border-radius: 14px;
      border:1px solid rgba(2,6,23,.14);
      outline:none;
      font-weight: 700;
    }
    .hint{
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.45;
    }

    /* ===== Mobile Bottom Sheet Menu ===== */
    .sheet{
      position:fixed;
      left:0; right:0;
      bottom:-120%;
      background: #fff;
      border-radius: 24px 24px 0 0;
      box-shadow: 0 -18px 45px rgba(2,6,23,.25);
      border-top: 1px solid rgba(2,6,23,.10);
      padding: 10px 14px calc(12px + env(safe-area-inset-bottom, 0px));
      z-index: 90;
      transition: bottom .22s ease;
      max-height: 82vh;
      overflow:auto;
      display:none; /* ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    }
    .sheet.show{bottom:0}
    .sheet .handle{
      width: 44px;
      height: 5px;
      border-radius:999px;
      background: rgba(2,6,23,.18);
      margin: 6px auto 10px;
    }
    .sheet-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
    }
    .sheet-title h3{
      margin:0;
      font-size: 16px;
      font-weight: 950;
    }
    .sheet-list{
      display:grid;
      gap: 10px;
    }
    .sheet-item{
      display:flex;
      gap: 12px;
      align-items:center;
      padding: 12px;
      border-radius: 18px;
      border:1px solid rgba(2,6,23,.08);
      background: #f8fafc;
      cursor:pointer;
      user-select:none;
    }
    .sheet-item:active{transform: scale(.99)}
    .sheet-item .icon{
      width: 44px;height:44px;border-radius: 16px;
      display:flex;align-items:center;justify-content:center;
      background: #eef2ff;
      border:1px solid rgba(2,6,23,.06);
      font-size: 20px;
    }
    .sheet-item .txt .t{
      font-weight: 950;
      margin:0;
      font-size: 14px;
    }
    .sheet-item .txt .d{
      margin:2px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
    }

    /* ===== HR Face Register "Overlay Panel" (Mobile) ===== */
    .hr-panel{
      position: fixed;
      left: 0; right: 0;
      bottom: -120%;
      z-index: 70;
      transition: bottom .22s ease;
      display:none; /* mobile only */
      padding: 0 12px calc(env(safe-area-inset-bottom, 0px) + 10px);
    }
    .hr-panel.show{bottom: 76px;} /* ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ bottom nav */
    .hr-panel .panel{
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(12px);
      border:1px solid rgba(2,6,23,.12);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hr-panel .panel-hd{
      padding: 12px 12px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(2,6,23,.10);
    }
    .hr-panel .panel-hd .ttl{
      font-weight: 950;
      font-size: 15px;
    }
    .hr-panel .panel-bd{
      padding: 12px;
    }

    /* ===== Mobile sizing tweaks ===== */
    @media (max-width: 980px){
      .cam-box{height: 360px;} /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
      .hero-title{font-size: 22px}
      .wrap{padding: 14px 14px 18px}
      .card-hd{padding: 12px 12px 10px}
      .card-bd{padding: 0 12px 12px}
      .sheet{display:block;}
      .hr-panel{display:block;}
    }

    /* ===== Sections anchor for nav ===== */
    .anchor{scroll-margin-top: 14px;}
    .muted{color:var(--muted)}
    .sep{height:10px}
  </style>
</head>

<body>
  <div class="wrap pad-bottom" id="pageWrap">
    <!-- ===== HERO ===== -->
    <section class="hero">
      <div class="hero-top">
        <div>
          <h1 class="hero-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h1>
          <p class="hero-sub">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ 4 ‡∏ä‡πà‡∏ß‡∏á + ‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤) ‚Äî ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á PC ‡πÅ‡∏•‡∏∞ Mobile</p>
          <div class="api-line"><b>API:</b> <span id="apiText" class="muted" style="color:rgba(229,231,235,.85)"></span></div>
        </div>

        <button class="menu-btn" id="btnMenu" title="‡πÄ‡∏°‡∏ô‡∏π">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <div class="hero-actions">
        <div class="pill" id="connPill">
          <span class="dot" id="connDot"></span>
          <span id="connText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‚Ä¶</span>
        </div>

        <button class="btn ghost small" id="btnRefreshAll">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      </div>
    </section>

    <div class="sep"></div>

    <div class="grid">
      <!-- ===== LEFT: SCAN AREA ===== -->
      <section class="card anchor" id="secScan">
        <div class="card-hd">
          <div>
            <h2 class="card-title">üì∑ ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h2>
            <div class="card-sub">‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á ‚Üí ‡∏ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏î ‚Äú‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‚Äù (‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ ‚Äú‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‚Äù ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î)</div>
          </div>
          <span class="badge ok" id="scanReadyBadge">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
        </div>

        <div class="card-bd">
          <div class="cam-top">
            <button class="btn success" id="btnManual">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</button>
            <button class="btn" id="btnCheckByCode">üîé ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
          </div>

          <div class="cam-box" id="camBox">
            <video id="video" playsinline muted></video>
            <div class="cam-empty" id="camEmpty">
              <div style="font-size:46px">üì∏</div>
              <div class="big">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà</div>
              <div class="small">‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</div>
            </div>

            <button class="cam-fab" id="btnSnap" title="‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á">
              <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M7 7h10l1.5 3H21v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V10h2.5L7 7z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                <path d="M12 18a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </div>

          <div class="cam-controls">
            <select class="select" id="cameraSelect">
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤)</option>
            </select>

            <div class="row">
              <button class="btn primary" id="btnStart">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô</button>
              <button class="btn" id="btnStop">‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î</button>
              <button class="btn success" id="btnSaveFromScan">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô</button>
            </div>

            <div class="note">
              <b>‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</b>
              ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ä‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô <b>08:00</b> | ‡∏û‡∏±‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô <b>1 ‡∏ä‡∏°.</b> | ‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á <b>17:00</b><br>
              <span class="muted">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π ‚Äú‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR)‚Äù ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å</span>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== RIGHT: TODAY SUMMARY (PC full) ===== -->
      <section class="card anchor pc-only" id="secTodayPC">
        <div class="card-hd">
          <div>
            <h2 class="card-title">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
            <div class="card-sub">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á 4 ‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
          </div>
          <button class="btn small" id="btnRefreshTodayPC">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
        <div class="card-bd">
          <div class="table-wrap">
            <table id="todayTablePC">
              <thead>
                <tr>
                  <th>‡∏£‡∏´‡∏±‡∏™</th>
                  <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                  <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                  <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                  <th>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ä‡πâ‡∏≤</th>
                  <th>‡∏≠‡∏≠‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</th>
                  <th>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</th>
                  <th>‡∏≠‡∏≠‡∏Å‡πÄ‡∏¢‡πá‡∏ô</th>
                  <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                </tr>
              </thead>
              <tbody id="todayTbodyPC">
                <tr><td colspan="9" class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶</td></tr>
              </tbody>
            </table>
          </div>
          <div class="hint" style="margin-top:10px">
            * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ï Logs ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏ñ‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏Å‡∏î ‚Äú‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Äù
          </div>
        </div>
      </section>

      <!-- ===== RIGHT: HELP (PC) ===== -->
      <section class="card pc-only anchor" id="secHelpPC">
        <div class="card-hd">
          <div>
            <h2 class="card-title">üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)</h2>
            <div class="card-sub">‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô/HR)</div>
          </div>
        </div>
        <div class="card-bd">
          <div class="note" style="background:#fff">
            <b>1) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL API</b><br>
            ‡∏Å‡∏î‡πÄ‡∏°‡∏ô‡∏π (‡∏™‡∏≤‡∏°‡∏Ç‡∏µ‡∏î) ‚Üí ‚Äú‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL‚Äù ‚Üí ‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Web App ‡∏Ç‡∏≠‡∏á Apps Script ‚Üí ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å<br><br>

            <b>2) ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR)</b><br>
            ‡∏Å‡∏î‡πÄ‡∏°‡∏ô‡∏π ‚Üí ‚Äú‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR)‚Äù ‚Üí ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á ‚Üí ‡∏à‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á + ‡πÅ‡∏™‡∏á‡∏û‡∏≠‡∏î‡∏µ ‚Üí ‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤<br><br>

            <b>3) ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</b><br>
            ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏™‡πÅ‡∏Å‡∏ô‚Äù ‚Üí ‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô ‚Üí ‡∏¢‡∏∑‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‚Üí ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô (‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≤‡∏°‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤)<br><br>

            <b>4) ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠ (‡∏Å‡∏£‡∏ì‡∏µ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô)</b><br>
            ‡∏Å‡∏î ‚Äú‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‚Äù ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‚Üí ‡∏î‡∏∂‡∏á GPS ‚Üí ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å<br><br>

            <b>5) ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</b><br>
            ‡∏Å‡∏î ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‚Äù ‚Üí ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 4 ‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô
          </div>

          <div class="sep"></div>

          <div class="note">
            <b>‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô</b><br>
            ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô <b>HTTPS</b> (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) <br>
            ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï <b>Camera</b> ‡πÅ‡∏•‡∏∞ <b>Location</b> <br>
            ‚úÖ ‡∏°‡∏µ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå <b>models/</b> ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ face-api) <br>
            ‚úÖ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
          </div>
        </div>
      </section>
    </div>

    <!-- ===== MOBILE SECTIONS ===== -->
    <div class="m-only">
      <div class="sep"></div>

      <section class="card anchor" id="secTodayM">
        <div class="card-hd">
          <div>
            <h2 class="card-title">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏¢‡πà‡∏≠)</h2>
            <div class="card-sub">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö (‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏û‡∏±‡∏á)</div>
          </div>
          <button class="btn small" id="btnRefreshTodayM">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
        <div class="card-bd">
          <div class="table-wrap table-scroll">
            <table id="todayTableM">
              <thead>
                <tr>
                  <th>‡∏£‡∏´‡∏±‡∏™</th>
                  <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                  <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                  <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                  <th>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ä‡πâ‡∏≤</th>
                  <th>‡∏≠‡∏≠‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</th>
                  <th>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</th>
                  <th>‡∏≠‡∏≠‡∏Å‡πÄ‡∏¢‡πá‡∏ô</th>
                  <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                </tr>
              </thead>
              <tbody id="todayTbodyM">
                <tr><td colspan="9" class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶</td></tr>
              </tbody>
            </table>
          </div>
          <div class="hint" style="margin-top:10px">
            * ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ‡πÉ‡∏´‡πâ‡∏Å‡∏î ‚Äú‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Äù
          </div>
        </div>
      </section>

      <div class="sep"></div>

      <section class="card anchor" id="secLatestM">
        <div class="card-hd">
          <div>
            <h2 class="card-title">üïò ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
            <div class="card-sub">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏ä‡πà‡∏ß‡∏¢‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß)</div>
          </div>
        </div>
        <div class="card-bd">
          <div class="note" id="latestBox">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</div>
        </div>
      </section>

      <div class="sep"></div>

      <section class="card anchor" id="secHelpM">
        <div class="card-hd">
          <div>
            <h2 class="card-title">üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÜ</h2>
            <div class="card-sub">‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
          </div>
        </div>
        <div class="card-bd">
          <div class="note" style="background:#fff">
            ‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL API ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏Å‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)<br>
            ‚Ä¢ ‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‚Äù ‚Üí ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‚Üí ‡∏Å‡∏î ‚Äú‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‚Äù<br>
            ‚Ä¢ ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å: HR ‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‚Äù ‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô<br>
            ‚Ä¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡∏°‡∏µ GPS + ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô)
          </div>
        </div>
      </section>

      <div class="sep"></div>

      <section class="card anchor" id="secTroubleM">
        <div class="card-hd">
          <div>
            <h2 class="card-title">üß© ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô</h2>
            <div class="card-sub">‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô 99% ‡∏´‡∏≤‡∏¢</div>
          </div>
        </div>
        <div class="card-bd">
          <div class="note">
            ‚Ä¢ ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô <b>HTTPS</b> (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)<br>
            ‚Ä¢ ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï <b>‡∏Å‡∏•‡πâ‡∏≠‡∏á</b> + <b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (Location)</b><br>
            ‚Ä¢ ‡∏°‡∏µ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå <b>models/</b> ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ face-api)<br>
            ‚Ä¢ ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
          </div>
        </div>
      </section>
    </div>

  </div><!-- wrap -->

  <!-- ===== MOBILE BOTTOM NAV (mobile only) ===== -->
  <nav class="bottom-nav m-only" id="bottomNav">
    <div class="bottom-nav-inner">
      <div class="nav-item active" data-go="#secScan" id="navScan">
        <div class="ic">üì∑</div>
        <div>‡∏™‡πÅ‡∏Å‡∏ô</div>
      </div>
      <div class="nav-item" data-go="#secTodayM" id="navToday">
        <div class="ic">üìä</div>
        <div>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
      </div>
      <div class="nav-item" data-go="#secLatestM" id="navLatest">
        <div class="ic">üïò</div>
        <div>‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
      </div>
      <div class="nav-item" data-go="#secHelpM" id="navHelp">
        <div class="ic">üí°</div>
        <div>‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
      </div>
    </div>
  </nav>

  <!-- ===== OVERLAY (PC MODALS) ===== -->
  <div class="overlay" id="overlay">
    <div class="modal" id="modal">
      <div class="modal-hd">
        <h3 class="modal-title" id="modalTitle">‡πÄ‡∏°‡∏ô‡∏π</h3>
        <button class="xbtn" id="modalClose" title="‡∏õ‡∏¥‡∏î">‚úï</button>
      </div>
      <div class="modal-bd" id="modalBody"></div>
    </div>
  </div>

  <!-- ===== MOBILE MENU SHEET ===== -->
  <div class="sheet" id="menuSheet" aria-hidden="true">
    <div class="handle"></div>
    <div class="sheet-title">
      <h3>‡πÄ‡∏°‡∏ô‡∏π</h3>
      <button class="xbtn" id="sheetClose" title="‡∏õ‡∏¥‡∏î">‚úï</button>
    </div>

    <div class="sheet-list">
      <div class="sheet-item" data-act="setUrl">
        <div class="icon">üîó</div>
        <div class="txt">
          <p class="t">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL</p>
          <p class="d">‡πÉ‡∏™‡πà URL Web App ‡∏Ç‡∏≠‡∏á Apps Script</p>
        </div>
      </div>

      <div class="sheet-item" data-act="resetUrl">
        <div class="icon">üßπ</div>
        <div class="txt">
          <p class="t">Reset URL</p>
          <p class="d">‡∏•‡πâ‡∏≤‡∏á URL ‡πÄ‡∏Å‡πà‡∏≤ (‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏™‡πà‡∏ú‡∏¥‡∏î / ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå)</p>
        </div>
      </div>

      <div class="sheet-item" data-act="hrRegister">
        <div class="icon">üßëüèª‚Äçüíº</div>
        <div class="txt">
          <p class="t">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR)</p>
          <p class="d">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á ‚Üí ‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</p>
        </div>
      </div>

      <div class="sheet-item" data-act="openAdmin">
        <div class="icon">üõ†Ô∏è</div>
        <div class="txt">
          <p class="t">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà / HR</p>
          <p class="d">‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ admin.html (‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô/‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô)</p>
        </div>
      </div>
    </div>

    <div class="sep"></div>
    <div class="note">
      <b>Tip:</b> ‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÅ‡∏ú‡∏á‡∏•‡πà‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ‡∏à‡∏£‡∏¥‡∏á
    </div>
  </div>

  <!-- ===== HR PANEL (Mobile overlay panel above camera, NOT blocking video) ===== -->
  <div class="hr-panel" id="hrPanel">
    <div class="panel">
      <div class="panel-hd">
        <div class="ttl">üßëüèª‚Äçüíº ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR)</div>
        <button class="xbtn" id="hrPanelClose" title="‡∏õ‡∏¥‡∏î">‚úï</button>
      </div>
      <div class="panel-bd">
        <div class="field">
          <div class="label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (code)</div>
          <input class="input" id="hrCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1011" inputmode="numeric" />
          <div class="hint">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏ï‡∏£‡∏á ‡πÜ‚Äù ‡πÅ‡∏™‡∏á‡∏û‡∏≠‡∏î‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‚Äù</div>
        </div>

        <div class="btn-row">
          <button class="btn" id="btnOpenCamFront">üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤</button>
          <button class="btn success" id="btnCaptureFace">‚úÖ ‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</button>
        </div>

        <div class="hint" id="hrStatus" style="margin-top:10px">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‚Ä¶</div>
      </div>
    </div>
  </div>

  <!-- ===== Scripts ===== -->
  <!-- face-api (optional) -->
  <script defer src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.12/dist/face-api.js"></script>

  <script>
    /*****************************************************************
     *  CONFIG / STORAGE
     *****************************************************************/
    const LS_API_KEY = "attendance_api_url_v2";
    const LS_LATEST_KEY = "attendance_latest_result_v1";

    const el = (id) => document.getElementById(id);
    const isMobile = () => window.matchMedia("(max-width: 980px)").matches;

    const apiText = el("apiText");
    const connDot = el("connDot");
    const connText = el("connText");
    const scanReadyBadge = el("scanReadyBadge");

    function getApiUrl(){
      return (localStorage.getItem(LS_API_KEY) || "").trim();
    }
    function setApiUrl(url){
      localStorage.setItem(LS_API_KEY, (url||"").trim());
      renderApiLine();
    }
    function resetApiUrl(){
      localStorage.removeItem(LS_API_KEY);
      renderApiLine();
    }
    function renderApiLine(){
      const u = getApiUrl();
      apiText.textContent = u ? u : "(‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤) ‚Äî ‡∏Å‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà URL";
    }

    function setConn(ok, msg){
      connDot.classList.toggle("ok", !!ok);
      connText.textContent = msg || (ok ? "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" : "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
    }

    /*****************************************************************
     *  API Helper (POST FormData to Apps Script)
     *****************************************************************/
    async function postAction(action, payload = {}, files = {}){
      const url = getApiUrl();
      if(!url) throw new Error("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL API");

      const fd = new FormData();
      fd.append("action", action);
      Object.entries(payload).forEach(([k,v]) => fd.append(k, v ?? ""));
      Object.entries(files).forEach(([k,file]) => { if(file) fd.append(k, file); });

      const res = await fetch(url, { method:"POST", body: fd });
      const txt = await res.text();
      let json;
      try{ json = JSON.parse(txt); }
      catch(e){ throw new Error("API ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON: " + txt.slice(0,160)); }
      if(!res.ok) throw new Error("HTTP " + res.status);
      if(json && json.ok === false) throw new Error(json.message || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏≤‡∏Å API");
      return json;
    }

    // ‡∏ö‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ action ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô: ‡∏•‡∏≠‡∏á fallback ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á
    async function postActionTry(actions, payload={}, files={}){
      let lastErr;
      for(const a of actions){
        try{
          return await postAction(a, payload, files);
        }catch(err){
          lastErr = err;
        }
      }
      throw lastErr || new Error("‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    }

    /*****************************************************************
     *  Menu UI (PC modal / Mobile sheet)
     *****************************************************************/
    const overlay = el("overlay");
    const modal = el("modal");
    const modalTitle = el("modalTitle");
    const modalBody = el("modalBody");
    const modalClose = el("modalClose");

    const menuSheet = el("menuSheet");
    const sheetClose = el("sheetClose");

    const hrPanel = el("hrPanel");
    const hrPanelClose = el("hrPanelClose");

    function openPCModal(title, html){
      modalTitle.textContent = title;
      modalBody.innerHTML = html;
      overlay.classList.add("show");
    }
    function closePCModal(){
      overlay.classList.remove("show");
      modalBody.innerHTML = "";
    }

    function openMobileSheet(){
      menuSheet.classList.add("show");
      menuSheet.setAttribute("aria-hidden","false");
    }
    function closeMobileSheet(){
      menuSheet.classList.remove("show");
      menuSheet.setAttribute("aria-hidden","true");
    }

    function openHRPanel(){
      hrPanel.classList.add("show");
    }
    function closeHRPanel(){
      hrPanel.classList.remove("show");
    }

    function openMenu(){
      if(isMobile()){
        openMobileSheet();
      }else{
        // PC: modal ‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡∏Ñ ‚Äú‡∏Ñ‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏à‡∏≠‚Äù)
        openPCModal("‡πÄ‡∏°‡∏ô‡∏π", renderMenuHTML_PC());
      }
    }

    function renderMenuHTML_PC(){
      const u = getApiUrl();
      return `
        <div class="note" style="margin-bottom:12px">
          <b>üîó URL API ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</b><br>
          <div style="word-break:break-all; margin-top:6px">${u ? u : "<span class='muted'>(‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤)</span>"}</div>
        </div>

        <div style="display:grid; gap:10px; margin-bottom:12px">
          <button class="btn" onclick="window.__openSetUrl()">üîó ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL</button>
          <button class="btn" onclick="window.__resetUrl()">üßπ Reset URL</button>
          <button class="btn" onclick="window.__openHRRegister_PC()">üßëüèª‚Äçüíº ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR)</button>
          <button class="btn" onclick="window.__goAdmin()">üõ†Ô∏è ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà / HR (‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ admin.html)</button>
        </div>

        <div class="note">
          <b>Tip:</b> ‡∏ö‡∏ô PC ‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô Bottom Sheet ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏ö‡∏±‡∏Ñ‡∏Ñ‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏à‡∏≠
        </div>
      `;
    }

    // expose for onclick inside modal
    window.__goAdmin = () => { window.location.href = "admin.html"; };
    window.__resetUrl = () => { resetApiUrl(); closePCModal(); pingAndLoadAll(); };
    window.__openSetUrl = () => { openSetUrlDialog(); };
    window.__openHRRegister_PC = () => { openHRRegisterDialog_PC(); };

    /*****************************************************************
     *  Set URL dialog (PC) + used by mobile actions
     *****************************************************************/
    function openSetUrlDialog(){
      const current = getApiUrl();
      const html = `
        <div class="field">
          <div class="label">URL Web App ‡∏Ç‡∏≠‡∏á Apps Script</div>
          <input class="input" id="pcApiInput" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå .../exec" value="${current ? current.replaceAll('"','&quot;') : ""}">
          <div class="hint">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: https://script.google.com/macros/s/XXXX/exec</div>
        </div>
        <div class="btn-row">
          <button class="btn primary" onclick="window.__saveUrl()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button class="btn" onclick="window.__closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      `;
      if(isMobile()){
        // ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô PC modal ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞ -> ‡πÉ‡∏ä‡πâ dialog overlay ‡πÅ‡∏ö‡∏ö PC ‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ú‡πà‡∏≤‡∏ô sheet action: ‡∏õ‡∏¥‡∏î sheet ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏™‡∏ß‡∏¢‡πÜ
        closeMobileSheet();
      }
      openPCModal("‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL", html);
      window.__saveUrl = () => {
        const v = (document.getElementById("pcApiInput")?.value || "").trim();
        setApiUrl(v);
        closePCModal();
        pingAndLoadAll();
      };
      window.__closeModal = () => closePCModal();
    }

    /*****************************************************************
     *  HR Register (PC modal) + Mobile panel
     *****************************************************************/
    function openHRRegisterDialog_PC(){
      const html = `
        <div class="note" style="margin-bottom:12px">
          <b>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</b> ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏ï‡∏£‡∏á ‡πÜ‚Äù ‡πÅ‡∏™‡∏á‡∏û‡∏≠‡∏î‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏î‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </div>

        <div class="field">
          <div class="label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (code)</div>
          <input class="input" id="pcHrCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1011" inputmode="numeric">
        </div>

        <div class="btn-row">
          <button class="btn" onclick="window.__openCamFront()">üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤</button>
          <button class="btn success" onclick="window.__captureFace()">‚úÖ ‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</button>
        </div>

        <div class="hint" id="pcHrStatus" style="margin-top:10px">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‚Ä¶</div>
      `;
      openPCModal("‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (HR)", html);
      // bind to same functions as mobile
      window.__openCamFront = () => startCamera({ preferFront:true });
      window.__captureFace = () => captureAndUploadFace("pcHrCode", "pcHrStatus");
    }

    async function captureAndUploadFace(codeInputId, statusId){
      const statusEl = document.getElementById(statusId);
      const code = (document.getElementById(codeInputId)?.value || "").trim();
      if(!code){
        statusEl && (statusEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");
        return;
      }
      if(!videoStream){
        statusEl && (statusEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô");
        return;
      }

      try{
        statusEl && (statusEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‚Ä¶");
        const blob = await captureBlobFromVideo();
        statusEl && (statusEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‚Ä¶");

        // ‡πÉ‡∏ä‡πâ action ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡πÉ‡∏ô Code.gs: uploadEmployeeFace
        const r = await postActionTry(["uploadEmployeeFace"], { code }, { file: blob });

        statusEl && (statusEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      }catch(err){
        statusEl && (statusEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚ùå " + (err.message || err));
      }
    }

    /*****************************************************************
     *  Camera control
     *****************************************************************/
    const video = el("video");
    const camEmpty = el("camEmpty");
    const btnSnap = el("btnSnap");
    let videoStream = null;
    let currentDeviceId = null;

    async function listCameras(){
      const devices = await navigator.mediaDevices.enumerateDevices();
      const cams = devices.filter(d => d.kind === "videoinput");
      const sel = el("cameraSelect");
      sel.innerHTML = `<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤)</option>`;
      cams.forEach((c, idx) => {
        const opt = document.createElement("option");
        opt.value = c.deviceId;
        opt.textContent = c.label || `Camera ${idx+1}`;
        sel.appendChild(opt);
      });
    }

    async function startCamera({ deviceId=null, preferFront=false } = {}){
      try{
        if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia){
          throw new Error("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á");
        }

        // stop old stream
        stopCamera();

        const constraints = {
          audio:false,
          video: deviceId ? { deviceId: { exact: deviceId } } : (preferFront ? { facingMode: "user" } : true)
        };

        videoStream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = videoStream;

        video.style.display = "block";
        camEmpty.style.display = "none";
        btnSnap.style.display = "flex";

        await video.play();

        scanReadyBadge.className = "badge ok";
        scanReadyBadge.textContent = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô ‚úÖ";

        // update device id
        const track = videoStream.getVideoTracks()[0];
        const settings = track.getSettings ? track.getSettings() : {};
        currentDeviceId = settings.deviceId || deviceId || null;

        // refresh camera list labels after permission granted
        await listCameras();

      }catch(err){
        scanReadyBadge.className = "badge danger";
        scanReadyBadge.textContent = "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°";
        alert("‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + (err.message || err));
      }
    }

    function stopCamera(){
      if(videoStream){
        videoStream.getTracks().forEach(t => t.stop());
        videoStream = null;
      }
      video.pause();
      video.srcObject = null;
      video.style.display = "none";
      camEmpty.style.display = "block";
      btnSnap.style.display = "none";
      scanReadyBadge.className = "badge warn";
      scanReadyBadge.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á";
    }

    async function captureBlobFromVideo(){
      const canvas = document.createElement("canvas");
      const w = video.videoWidth || 720;
      const h = video.videoHeight || 540;
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0, w, h);
      return await new Promise(resolve => canvas.toBlob(resolve, "image/jpeg", 0.92));
    }

    /*****************************************************************
     *  Today Summary rendering (PC + Mobile)
     *****************************************************************/
    function normalizeRow(r){
      // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ key ‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö
      return {
        code: r.code ?? r.empCode ?? r.id ?? "-",
        name: r.name ?? r.fullname ?? r.empName ?? "-",
        dept: r.department ?? r.dept ?? "-",
        level: r.level ?? r.role ?? "-",
        t1: r.t1 ?? r.inMorning ?? r.morningIn ?? "-",
        t2: r.t2 ?? r.outNoon ?? r.noonOut ?? "-",
        t3: r.t3 ?? r.inNoon ?? r.noonIn ?? "-",
        t4: r.t4 ?? r.outEvening ?? r.eveningOut ?? "-",
        status: r.status ?? r.state ?? "-"
      };
    }

    function renderTodayTo(tbodyEl, rows){
      tbodyEl.innerHTML = "";
      if(!rows || !rows.length){
        const tr = document.createElement("tr");
        tr.innerHTML = `<td colspan="9" class="muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</td>`;
        tbodyEl.appendChild(tr);
        return;
      }
      rows.forEach(rr => {
        const r = normalizeRow(rr);
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><b>${r.code}</b></td>
          <td>${r.name}</td>
          <td>${r.dept}</td>
          <td>${r.level}</td>
          <td>${r.t1 || "-"}</td>
          <td>${r.t2 || "-"}</td>
          <td>${r.t3 || "-"}</td>
          <td>${r.t4 || "-"}</td>
          <td>${renderStatusBadge(r.status)}</td>
        `;
        tbodyEl.appendChild(tr);
      });
    }

    function renderStatusBadge(status){
      const s = (status || "").toString();
      if(!s || s === "-") return `<span class="badge warn">‡∏£‡∏≠</span>`;
      if(s.includes("‡∏Ç‡∏≤‡∏î") || s.includes("absent")) return `<span class="badge danger">‡∏Ç‡∏≤‡∏î</span>`;
      if(s.includes("‡∏Ñ‡∏£‡∏ö") || s.includes("ok") || s.includes("‡∏°‡∏≤")) return `<span class="badge ok">${escapeHtml(s)}</span>`;
      if(s.includes("‡∏™‡∏≤‡∏¢") || s.includes("late")) return `<span class="badge warn">${escapeHtml(s)}</span>`;
      return `<span class="badge">${escapeHtml(s)}</span>`;
    }

    function escapeHtml(str){
      return (str||"").toString().replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    async function loadToday(){
      const tbPC = el("todayTbodyPC");
      const tbM = el("todayTbodyM");

      const loadingRow = `<tr><td colspan="9" class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶</td></tr>`;
      if(tbPC) tbPC.innerHTML = loadingRow;
      if(tbM) tbM.innerHTML = loadingRow;

      try{
        const data = await postActionTry(["getTodaySummary"], {});
        const rows = data.rows || data.data || data.items || [];
        if(tbPC) renderTodayTo(tbPC, rows);
        if(tbM) renderTodayTo(tbM, rows);
      }catch(err){
        const msg = `‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${(err.message||err)}`;
        if(tbPC) tbPC.innerHTML = `<tr><td colspan="9" class="muted">${escapeHtml(msg)}</td></tr>`;
        if(tbM) tbM.innerHTML = `<tr><td colspan="9" class="muted">${escapeHtml(msg)}</td></tr>`;
      }
    }

    /*****************************************************************
     *  Latest result (mobile)
     *****************************************************************/
    function setLatest(text){
      localStorage.setItem(LS_LATEST_KEY, JSON.stringify({ text, ts: Date.now() }));
      renderLatest();
    }
    function renderLatest(){
      const box = el("latestBox");
      if(!box) return;
      const raw = localStorage.getItem(LS_LATEST_KEY);
      if(!raw){
        box.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ";
        return;
      }
      try{
        const o = JSON.parse(raw);
        const dt = new Date(o.ts);
        box.innerHTML = `<b>${escapeHtml(o.text || "-")}</b><br><span class="muted">${dt.toLocaleString("th-TH")}</span>`;
      }catch(e){
        box.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ";
      }
    }

    /*****************************************************************
     *  Manual log + Check by code (UI as modal)
     *****************************************************************/
    function openManualDialog(){
      const html = `
        <div class="note" style="margin-bottom:12px">
          <b>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</b><br>
          ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏ì‡∏µ‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ / ‡∏•‡∏∑‡∏°‡∏™‡πÅ‡∏Å‡∏ô / ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏° GPS ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ)
        </div>

        <div class="field">
          <div class="label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (code)</div>
          <input class="input" id="mCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1011" inputmode="numeric">
        </div>

        <div class="field">
          <div class="label">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
          <select class="input" id="mSlot">
            <option value="t1">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ä‡πâ‡∏≤</option>
            <option value="t2">‡∏≠‡∏≠‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</option>
            <option value="t3">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</option>
            <option value="t4">‡∏≠‡∏≠‡∏Å‡πÄ‡∏¢‡πá‡∏ô</option>
          </select>
          <div class="hint">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
        </div>

        <div class="field">
          <div class="label">GPS (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)</div>
          <input class="input" id="mGps" placeholder="‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏∂‡∏á GPS ‡∏Å‡πà‡∏≠‡∏ô" readonly>
          <div class="btn-row">
            <button class="btn" onclick="window.__getGps()">üìç ‡∏î‡∏∂‡∏á GPS</button>
          </div>
        </div>

        <div class="field">
          <div class="label">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</div>
          <input class="input" id="mFile" type="file" accept="image/*">
          <div class="hint">‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô / ‡∏£‡∏π‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà / ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</div>
        </div>

        <div class="field">
          <div class="label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</div>
          <input class="input" id="mNote" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏±‡πâ‡∏ô ‡πÜ">
        </div>

        <div class="btn-row">
          <button class="btn success" onclick="window.__saveManual()">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button class="btn" onclick="window.__closeModal()">‡∏õ‡∏¥‡∏î</button>
        </div>

        <div class="hint" id="mStatus" style="margin-top:10px">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‚Ä¶</div>
      `;
      openPCModal("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠", html);

      window.__closeModal = () => closePCModal();
      window.__getGps = () => getGPSInto("mGps","mStatus");
      window.__saveManual = () => saveManualLog();
    }

    async function getGPSInto(inputId, statusId){
      const gpsEl = document.getElementById(inputId);
      const stEl = document.getElementById(statusId);
      if(!navigator.geolocation){
        stEl && (stEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS");
        return;
      }
      stEl && (stEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á GPS‚Ä¶");
      navigator.geolocation.getCurrentPosition(
        (pos)=>{
          const { latitude, longitude, accuracy } = pos.coords;
          gpsEl.value = `${latitude.toFixed(6)},${longitude.toFixed(6)} (¬±${Math.round(accuracy)}m)`;
          stEl && (stEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚úÖ ‡πÑ‡∏î‡πâ GPS ‡πÅ‡∏•‡πâ‡∏ß");
        },
        (err)=>{
          stEl && (stEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚ùå ‡∏î‡∏∂‡∏á GPS ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + err.message);
        },
        { enableHighAccuracy:true, timeout: 12000 }
      );
    }

    async function saveManualLog(){
      const st = document.getElementById("mStatus");
      const code = (document.getElementById("mCode")?.value || "").trim();
      const slot = (document.getElementById("mSlot")?.value || "t1").trim();
      const gps = (document.getElementById("mGps")?.value || "").trim();
      const note = (document.getElementById("mNote")?.value || "").trim();
      const file = document.getElementById("mFile")?.files?.[0] || null;

      if(!code){
        st.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô";
        return;
      }
      try{
        st.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‚Ä¶";
        const r = await postActionTry(["saveManualLog"], { code, slot, gps, note }, file ? { file } : {});
        st.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
        setLatest(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠ (${code}) ‡∏ä‡πà‡∏ß‡∏á ${slot.toUpperCase()} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
        await loadToday();
      }catch(err){
        st.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚ùå " + (err.message || err);
      }
    }

    function openCheckByCodeDialog(){
      const html = `
        <div class="note" style="margin-bottom:12px">
          <b>üîé ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</b><br>
          ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 4 ‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡∏≠‡∏á ‚Äú‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‚Äù
        </div>

        <div class="field">
          <div class="label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (code)</div>
          <input class="input" id="cCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1011" inputmode="numeric">
        </div>

        <div class="btn-row">
          <button class="btn primary" onclick="window.__doCheck()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
          <button class="btn" onclick="window.__closeModal()">‡∏õ‡∏¥‡∏î</button>
        </div>

        <div class="sep"></div>
        <div class="note" id="cResult">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</div>
      `;
      openPCModal("‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ", html);
      window.__closeModal = () => closePCModal();
      window.__doCheck = () => doCheckByCode();
    }

    async function doCheckByCode(){
      const code = (document.getElementById("cCode")?.value || "").trim();
      const box = document.getElementById("cResult");
      if(!code){ box.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô"; return; }

      box.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‚Ä¶";
      try{
        const r = await postActionTry(["checkTodayByCode","getTodayByCode"], { code });
        const d = r.data || r.row || r;
        const nr = normalizeRow(d);
        box.innerHTML = `
          <b>${escapeHtml(nr.code)} - ${escapeHtml(nr.name)}</b><br>
          <span class="muted">${escapeHtml(nr.dept)} ‚Ä¢ ${escapeHtml(nr.level)}</span>
          <hr style="border:none;border-top:1px solid rgba(2,6,23,.10);margin:10px 0">
          ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ä‡πâ‡∏≤: <b>${escapeHtml(nr.t1||"-")}</b><br>
          ‡∏≠‡∏≠‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á: <b>${escapeHtml(nr.t2||"-")}</b><br>
          ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á: <b>${escapeHtml(nr.t3||"-")}</b><br>
          ‡∏≠‡∏≠‡∏Å‡πÄ‡∏¢‡πá‡∏ô: <b>${escapeHtml(nr.t4||"-")}</b><br>
          ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${renderStatusBadge(nr.status)}
        `;
      }catch(err){
        box.textContent = "‚ùå " + (err.message || err);
      }
    }

    /*****************************************************************
     *  Save from scan (placeholder -> keep compatible)
     *  ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ action ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ô Apps Script ‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ action ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ
     *****************************************************************/
    async function saveFromScan(){
      // ‡∏Å‡∏±‡∏ô‡∏û‡∏±‡∏á: ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ action ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô backend ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ï‡∏Å
      try{
        // ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        if(!videoStream) throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô");
        const blob = await captureBlobFromVideo();

        // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ action ‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏ä‡πà‡∏ô "saveScanLog" ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        // ‡πÄ‡∏£‡∏≤‡πÉ‡∏™‡πà fallback: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Ñ‡∏£‡∏ä
        const r = await postActionTry(["saveScanLog","saveLogFromScan"], {}, { file: blob });

        setLatest("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
        await loadToday();
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }catch(err){
        // ‡∏ñ‡πâ‡∏≤ backend ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ action ‡∏ô‡∏µ‡πâ
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Backend (‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ action)\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: " + (err.message || err));
      }
    }

    /*****************************************************************
     *  Ping & initial load
     *****************************************************************/
    async function ping(){
      const u = getApiUrl();
      if(!u){
        setConn(false, "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL API");
        return false;
      }
      try{
        // ‡πÉ‡∏ä‡πâ getInitialData ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ (‡∏à‡∏≤‡∏Å Code.gs ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á)
        await postActionTry(["getInitialData","ping"], {});
        setConn(true, "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        return true;
      }catch(err){
        setConn(false, "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ URL/‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå/Deploy)");
        return false;
      }
    }

    async function pingAndLoadAll(){
      renderApiLine();
      renderLatest();

      const ok = await ping();
      if(ok){
        await loadToday();
      }else{
        // ‡πÅ‡∏™‡∏î‡∏á loading fail ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        const msg = `<tr><td colspan="9" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏Å‡πà‡∏≠‡∏ô)</td></tr>`;
        if(el("todayTbodyPC")) el("todayTbodyPC").innerHTML = msg;
        if(el("todayTbodyM")) el("todayTbodyM").innerHTML = msg;
      }
    }

    /*****************************************************************
     *  Mobile bottom nav behavior
     *****************************************************************/
    function setActiveNav(id){
      ["navScan","navToday","navLatest","navHelp"].forEach(x => {
        const n = el(x);
        if(n) n.classList.toggle("active", x === id);
      });
    }
    function scrollToAnchor(sel){
      const target = document.querySelector(sel);
      if(!target) return;
      target.scrollIntoView({ behavior:"smooth", block:"start" });
    }

    /*****************************************************************
     *  Events
     *****************************************************************/
    el("btnMenu").addEventListener("click", openMenu);
    modalClose.addEventListener("click", closePCModal);
    overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closePCModal(); });

    sheetClose.addEventListener("click", closeMobileSheet);

    // Mobile sheet items
    menuSheet.addEventListener("click", (e)=>{
      const item = e.target.closest(".sheet-item");
      if(!item) return;
      const act = item.getAttribute("data-act");
      if(act === "setUrl") openSetUrlDialog();
      if(act === "resetUrl"){ resetApiUrl(); closeMobileSheet(); pingAndLoadAll(); }
      if(act === "hrRegister"){ closeMobileSheet(); openHRPanel(); }
      if(act === "openAdmin"){ window.location.href = "admin.html"; }
    });

    // HR panel
    hrPanelClose.addEventListener("click", closeHRPanel);
    el("btnOpenCamFront").addEventListener("click", ()=> startCamera({ preferFront:true }));
    el("btnCaptureFace").addEventListener("click", ()=> captureAndUploadFace("hrCode","hrStatus"));

    // Buttons
    el("btnRefreshAll").addEventListener("click", pingAndLoadAll);
    if(el("btnRefreshTodayPC")) el("btnRefreshTodayPC").addEventListener("click", loadToday);
    if(el("btnRefreshTodayM")) el("btnRefreshTodayM").addEventListener("click", loadToday);

    el("btnManual").addEventListener("click", openManualDialog);
    el("btnCheckByCode").addEventListener("click", openCheckByCodeDialog);

    el("btnStart").addEventListener("click", ()=> startCamera({ deviceId: currentDeviceId || el("cameraSelect").value || null }));
    el("btnStop").addEventListener("click", stopCamera);
    el("btnSaveFromScan").addEventListener("click", saveFromScan);

    el("cameraSelect").addEventListener("change", async (e)=>{
      const id = e.target.value || null;
      if(!id) return;
      await startCamera({ deviceId: id });
    });

    btnSnap.addEventListener("click", async ()=>{
      try{
        if(!videoStream) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô");
        const blob = await captureBlobFromVideo();
        setLatest("‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üì∏ (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏£‡∏∞‡∏ö‡∏ö)");
        alert("‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß (‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á)");
      }catch(err){
        alert(err.message || err);
      }
    });

    // Bottom nav (mobile)
    document.querySelectorAll(".nav-item").forEach(n=>{
      n.addEventListener("click", ()=>{
        const go = n.getAttribute("data-go");
        if(go){
          setActiveNav(n.id);
          scrollToAnchor(go);
        }
      });
    });

    // Close sheet when scroll (mobile)
    window.addEventListener("scroll", ()=>{
      if(isMobile() && menuSheet.classList.contains("show")){
        // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á aggressive ‡∏°‡∏≤‡∏Å ‡πÅ‡∏Ñ‡πà‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÑ‡∏ß‡πâ‡∏Å‡πá‡πÑ‡∏î‡πâ
      }
    }, { passive:true });

    // Init
    (async function init(){
      renderApiLine();
      renderLatest();

      // ‡∏Å‡∏±‡∏ô PC ‡∏°‡∏µ bottom nav/panel ‡∏ã‡πâ‡∏≠‡∏ô: ‡πÅ‡∏Ñ‡πà‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏ß‡∏¢ media ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏µ‡∏Å‡∏ä‡∏±‡πâ‡∏ô
      if(!isMobile()){
        el("bottomNav")?.remove();
        closeMobileSheet();
        closeHRPanel();
        el("pageWrap").classList.remove("pad-bottom");
      }

      // camera list
      try{ await listCameras(); }catch(e){}

      await pingAndLoadAll();
    })();
  </script>
</body>
</html>
