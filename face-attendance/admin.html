<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‚Äì Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />

  <style>
    :root{
      --primary:#2563eb;
      --primary2:#1d4ed8;
      --primary-soft:#dbeafe;

      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;

      --success:#16a34a;
      --danger:#ef4444;
      --warning:#f59e0b;

      --sidebar:#020617;
      --sidebar2:#111827;

      --shadow: 0 18px 40px rgba(15,23,42,.08);
      --shadow2: 0 30px 80px rgba(15,23,42,.18);
    }

    *{ box-sizing:border-box; font-family:"Prompt",system-ui,-apple-system,"Segoe UI",sans-serif; }
    html,body{ margin:0; padding:0; width:100%; overflow-x:hidden; }
    body{
      color:var(--text);
      background:
        radial-gradient(circle at 20% 10%, #e0e7ff 0, transparent 55%),
        radial-gradient(circle at 80% 90%, #e5f5ff 0, transparent 55%),
        var(--bg);
    }

    a{ color:var(--primary); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* Buttons */
    .btn{
      border:none; cursor:pointer; border-radius:999px;
      padding:10px 14px; font-size:13px; font-weight:600;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      transition:transform .08s ease, box-shadow .08s ease, background .1s ease, opacity .1s ease;
      white-space:nowrap;
    }
    .btn:active{ transform:translateY(1px) scale(.99); }
    .btn:disabled{ opacity:.55; cursor:default; transform:none; }
    .btn-primary{ background:linear-gradient(135deg,var(--primary),var(--primary2)); color:#fff; box-shadow:0 14px 30px rgba(37,99,235,.25); }
    .btn-secondary{ background:#fff; border:1px solid var(--border); color:#111827; }
    .btn-danger{ background:var(--danger); color:#fff; }
    .btn-ghost{ background:transparent; border:1px solid rgba(148,163,184,.35); color:#cbd5e1; }
    .btn-small{ padding:7px 11px; font-size:12px; }

    /* Layout */
    .page{ display:flex; min-height:100vh; width:100%; overflow-x:hidden; }
    .sidebar{
      width:250px; flex-shrink:0;
      background:radial-gradient(circle at top, var(--sidebar2), var(--sidebar));
      color:#e5e7eb;
      padding:16px 14px;
      display:flex; flex-direction:column;
      box-shadow:10px 0 34px rgba(15,23,42,.45), 0 0 0 1px rgba(15,23,42,.55);
      position:relative; z-index:30;
    }
    .sidebar::after{
      content:""; position:absolute; inset:0;
      background:radial-gradient(circle at bottom, rgba(37,99,235,.18), transparent 62%);
      pointer-events:none;
    }
    .sidebar-header{ padding:6px 6px 16px; border-bottom:1px solid rgba(55,65,81,.9); margin-bottom:10px; position:relative; z-index:1;}
    .sidebar-title{ font-weight:800; font-size:18px; margin-bottom:2px; letter-spacing:.2px;}
    .sidebar-sub{ font-size:11px; color:#94a3b8; }
    .nav{ margin-top:12px; display:flex; flex-direction:column; gap:6px; flex:1; min-height:0; position:relative; z-index:1;}
    .nav-item{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:16px;
      cursor:pointer; border:1px solid transparent;
      color:#e5e7eb; font-size:14px; font-weight:600;
      transition:background .12s ease, transform .08s ease;
    }
    .nav-item .icon{ width:22px; display:inline-flex; justify-content:center; }
    .nav-item:hover{ background:rgba(31,41,55,.85); transform:translateY(-1px); }
    .nav-item.active{
      background:rgba(15,23,42,.98);
      border-color:rgba(59,130,246,.70);
      box-shadow:0 14px 26px rgba(15,23,42,.65);
    }
    .sidebar-footer{
      padding-top:10px; border-top:1px solid rgba(55,65,81,.9);
      font-size:11px; color:#9ca3af;
      position:relative; z-index:1;
    }
    .sidebar-footer .btn{ width:100%; margin-top:8px; }

    .content{ flex:1; display:flex; flex-direction:column; min-width:0; max-width:100%; overflow-x:hidden; }

    header.topbar{
      padding:12px 18px;
      background:rgba(2,6,23,.86);
      color:#e5e7eb;
      border-bottom:1px solid rgba(15,23,42,.45);
      display:flex; align-items:center; justify-content:space-between;
      position:sticky; top:0; z-index:20;
      backdrop-filter:blur(14px);
      gap:10px;
    }
    .topbar-left{ display:flex; flex-direction:column; gap:3px; min-width:0; }
    .topbar-title{ font-size:18px; font-weight:800; letter-spacing:.2px; }
    .topbar-sub{ font-size:12px; color:#94a3b8; display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    #apiUrlDisplay{ cursor:pointer; word-break:break-all; overflow-wrap:anywhere; }
    .topbar-right{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end; }

    main.main{ padding:18px 18px 22px; }
    .main-inner{ max-width:1280px; margin:0 auto; width:100%; }

    /* Cards */
    .card{
      background:rgba(255,255,255,.92);
      border-radius:18px;
      padding:14px 14px 12px;
      box-shadow:var(--shadow), 0 0 0 1px rgba(226,232,240,.92);
      border:1px solid rgba(226,232,240,.92);
      margin-bottom:14px;
      width:100%;
      overflow:hidden;
    }
    .card-header{
      display:flex; justify-content:space-between; align-items:flex-start;
      gap:12px; flex-wrap:wrap; margin-bottom:10px;
    }
    .card-title{
      font-size:15px; font-weight:800;
      display:flex; align-items:center; gap:8px;
    }
    .card-title .icon{
      width:24px; height:24px; border-radius:999px;
      display:inline-flex; align-items:center; justify-content:center;
      font-size:13px;
      background:var(--primary-soft);
      color:var(--primary);
    }
    .card-subtitle{ font-size:12px; color:var(--muted); line-height:1.5; }

    /* Inputs */
    .input{
      width:100%;
      border-radius:14px;
      border:1px solid var(--border);
      padding:11px 12px;
      font-size:14px;
      outline:none;
      background:#fff;
    }
    .input:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(37,99,235,.14);
    }
    select.input{ appearance:none; }

    .helper{ font-size:12px; color:var(--muted); }
    .mt-8{ margin-top:8px; }
    .mt-10{ margin-top:10px; }
    .mt-12{ margin-top:12px; }

    /* Status badges */
    .badge-status{ font-size:11px; padding:4px 10px; border-radius:999px; display:inline-block; font-weight:700; }
    .badge-normal{ background:#dcfce7; color:#166534; }
    .badge-late{ background:#fee2e2; color:#b91c1c; }
    .badge-absent{ background:#ffe4e6; color:#be123c; }
    .badge-other{ background:#fef3c7; color:#92400e; }
    .badge-unknown{ background:#0b1220; color:#e5e7eb; border:1px solid rgba(148,163,184,.35); }
    .pill{ font-size:11px; padding:4px 10px; border-radius:999px; background:#eef2ff; color:#1d4ed8; border:1px solid rgba(37,99,235,.18); font-weight:700; }
    .tag{ font-size:11px; padding:4px 10px; border-radius:999px; background:#f1f5f9; color:#334155; border:1px solid rgba(148,163,184,.30); font-weight:700; }

    .emp-face-badge{
      font-size:11px; padding:4px 10px; border-radius:999px;
      border:1px solid rgba(16,185,129,.22);
      background:rgba(16,185,129,.10);
      color:#047857;
      font-weight:800;
      white-space:nowrap;
    }
    .emp-face-badge.off{
      border-color:rgba(239,68,68,.22);
      background:rgba(239,68,68,.10);
      color:#b91c1c;
    }

    /* Tables */
    table{ width:100%; border-collapse:separate; border-spacing:0; font-size:13px; }
    thead{ background:#f3f4f6; }
    th,td{ padding:10px 10px; border-bottom:1px solid #e5e7eb; text-align:left; white-space:nowrap; vertical-align:top; }
    th{ font-weight:800; color:#334155; font-size:12px; }
    tbody tr:hover{ background:#f8fafc; }
    .scroll-x{ width:100%; overflow:auto; -webkit-overflow-scrolling:touch; }
    .table-wide{ width:max-content; min-width:820px; }
    .text-center{ text-align:center; }
    .text-right{ text-align:right; }

    /* Connection badge */
    .badge-connection{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 12px; border-radius:999px;
      font-size:11px; font-weight:800;
      background:rgba(15,118,110,.14);
      color:#a5f3fc;
      border:1px solid rgba(34,197,94,.75);
    }
    .badge-connection.offline{
      background:rgba(127,29,29,.30);
      color:#fecaca;
      border-color:rgba(248,113,113,.85);
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 10px rgba(34,197,94,.75);
    }
    .badge-connection.offline .dot{
      background:#f97373;
      box-shadow:0 0 10px rgba(248,113,113,.75);
    }

    /* Sections */
    .section{ display:none; }
    .section.active{ display:block; }

    /* Mobile cards */
    .list-mobile{
      display:flex; flex-direction:column; gap:10px;
      padding:6px 2px 2px;
    }
    .item{
      border:1px solid rgba(226,232,240,.95);
      border-radius:18px;
      padding:12px 12px 10px;
      background:#fff;
      box-shadow:0 12px 24px rgba(15,23,42,.06);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .item-top{
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
    }
    .item-title{ font-weight:800; font-size:14px; line-height:1.25; }
    .item-meta{
      font-size:12px; color:var(--muted);
      display:flex; flex-wrap:wrap; gap:6px; align-items:center;
    }
    .code-badge{
      font-size:11px; padding:4px 10px; border-radius:999px;
      background:rgba(37,99,235,.12);
      color:var(--primary);
      border:1px solid rgba(37,99,235,.22);
      font-weight:800;
      white-space:nowrap;
      height:fit-content;
    }
    .kv{
      display:grid;
      grid-template-columns:96px 1fr;
      gap:6px 10px;
      font-size:12px;
      color:#0f172a;
    }
    .kv .k{ color:var(--muted); }
    .kv .v{ font-weight:700; }

    .item-actions{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
    }
    .item-actions .btn{ width:100%; padding:10px 12px; }
    .btn-span-2{ grid-column:1 / -1; }

    /* Desktop vs Mobile toggles */
    .desktop-only{ display:block; }
    .mobile-only{ display:none; }
    @media (max-width:900px){
      .desktop-only{ display:none; }
      .mobile-only{ display:block; }
    }

    /* Bottom nav (mobile) - scroll */
    .bottom-nav{
      display:none;
      position:fixed;
      left:10px; right:10px; bottom:10px;
      z-index:40;
      background:rgba(2,6,23,.92);
      border:1px solid rgba(31,41,55,.85);
      border-radius:18px;
      padding:8px;
      backdrop-filter:blur(12px);
      box-shadow:0 16px 44px rgba(15,23,42,.35);
      overflow:hidden;
    }
    .bottom-nav-inner{
      display:flex;
      gap:6px;
      overflow-x:auto;
      padding-bottom:2px;
      -webkit-overflow-scrolling:touch;
      scrollbar-width:none;
    }
    .bottom-nav-inner::-webkit-scrollbar{ display:none; }
    .bottom-item{
      min-width:82px;
      border:none;
      background:transparent;
      color:#cbd5e1;
      border-radius:14px;
      padding:8px 8px;
      cursor:pointer;
      display:flex; flex-direction:column; align-items:center; gap:2px;
      font-size:10px; font-weight:800;
      border:1px solid transparent;
    }
    .bottom-item .bicon{ font-size:16px; }
    .bottom-item.active{
      background:rgba(37,99,235,.18);
      color:#fff;
      border-color:rgba(59,130,246,.45);
      box-shadow:0 10px 18px rgba(37,99,235,.22);
    }

    @media (max-width:1000px){
      .sidebar{ display:none; }
      .page{ flex-direction:column; }
      main.main{ padding:14px 12px 92px; } /* ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ bottom nav */
      .bottom-nav{ display:block; }
      header.topbar{ padding:10px 12px; }
    }
    @media (max-width:640px){
      header.topbar{ flex-direction:column; align-items:flex-start; }
      .topbar-right{ width:100%; display:flex; justify-content:space-between; }
    }

    /* URL card (floating) */
    #urlCard{
      position:fixed;
      right:16px;
      bottom:92px;
      max-width:420px;
      width:calc(100% - 32px);
      z-index:45;
      display:none;
    }
    @media (min-width:1001px){
      #urlCard{ bottom:16px; }
    }
    @media (max-width:640px){
      #urlCard{ left:12px; right:12px; width:auto; }
    }

    /* Modals */
    .modal-backdrop{
      position:fixed; inset:0;
      background:rgba(2,6,23,.55);
      display:none;
      align-items:center; justify-content:center;
      padding:14px;
      z-index:60;
      backdrop-filter:blur(6px);
    }
    .modal{
      width:100%;
      max-width:560px;
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(226,232,240,.9);
      box-shadow:var(--shadow2);
      overflow:hidden;
    }
    .modal-header{
      padding:12px 14px;
      border-bottom:1px solid #e5e7eb;
      display:flex; justify-content:space-between; gap:10px;
      background:#f8fafc;
    }
    .modal-title{ font-weight:900; font-size:14px; }
    .modal-sub{ font-size:12px; color:var(--muted); margin-top:2px; }
    .modal-body{ padding:12px 14px 14px; }
    .modal-footer{
      padding:12px 14px;
      border-top:1px solid #e5e7eb;
      display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap;
      background:#fafafa;
    }

    .grid-2{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; }
    .grid-3{ display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:12px; }
    @media (max-width:800px){
      .grid-2,.grid-3{ grid-template-columns:1fr; }
    }

    .stat-card{
      padding:12px 12px; border-radius:16px;
      background:#f9fafb; border:1px solid #e5e7eb;
      display:flex; flex-direction:column; gap:4px;
      min-width:0;
    }
    .stat-label{ font-size:12px; color:var(--muted); font-weight:700; }
    .stat-value{ font-size:22px; font-weight:900; letter-spacing:.2px; }
    .stat-extra{ font-size:11px; color:var(--muted); }
    .stat-accent{ color:#16a34a; }
    .stat-danger{ color:#b91c1c; }

    .skeleton{
      background:linear-gradient(90deg,#f3f4f6 25%,#e5e7eb 37%,#f3f4f6 63%);
      background-size:400% 100%;
      animation:sk 1.2s ease infinite;
      border-radius:12px;
      height:14px;
      width:100%;
    }
    @keyframes sk{ 0%{background-position:100% 0} 100%{background-position:0 0} }

    .error-text{ font-size:12px; color:var(--danger); margin-top:8px; font-weight:700; }
    .success-text{ font-size:12px; color:var(--success); margin-top:8px; font-weight:700; }

    /* Leave status chips */
    .chips{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.35);
      background:#fff;
      color:#334155;
      font-size:12px;
      font-weight:900;
      cursor:pointer;
      user-select:none;
      transition:transform .08s ease, box-shadow .12s ease, background .12s ease;
    }
    .chip:active{ transform:translateY(1px); }
    .chip.active{
      background:rgba(37,99,235,.10);
      border-color:rgba(37,99,235,.35);
      color:#1d4ed8;
      box-shadow:0 10px 18px rgba(37,99,235,.12);
    }

    /* Small text in topbar */
    .tiny{
      font-size:11px;
      color:#94a3b8;
      font-weight:800;
    }
  </style>
</head>

<body>
<div class="page">
  <!-- SIDEBAR (Desktop) -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>
      <div class="sidebar-sub">HR Attendance Panel</div>
    </div>

    <nav class="nav">
      <div class="nav-item active" data-section="dashboard"><span class="icon">üìä</span><span>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</span></div>
      <div class="nav-item" data-section="employees"><span class="icon">üë•</span><span>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</span></div>
      <div class="nav-item" data-section="logs"><span class="icon">‚è±</span><span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏ß‡∏•‡∏≤</span></div>
      <div class="nav-item" data-section="summary"><span class="icon">üìà</span><span>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span></div>
      <div class="nav-item" data-section="leave"><span class="icon">üìù</span><span>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏≤</span></div>
      <div class="nav-item" data-section="settings"><span class="icon">‚öôÔ∏è</span><span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡πÅ‡∏ú‡∏ô‡∏Å/‡∏£‡∏∞‡∏î‡∏±‡∏ö)</span></div>
    </nav>

    <div class="sidebar-footer">
      <div>TIP: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Admin</div>
      <button class="btn btn-ghost" id="btnBackToFront">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      <button class="btn btn-danger" id="btnLogout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </aside>

  <div class="content">
    <header class="topbar">
      <div class="topbar-left">
        <div class="topbar-title">‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤</div>
        <div class="topbar-sub">
          <span>Admin Panel</span>
          <span> | </span>
          <span id="apiUrlDisplay" title="‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL"></span>
          <span class="tiny" id="lastUpdatedText">‚Ä¢ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: -</span>
        </div>
      </div>
      <div class="topbar-right">
        <div id="connectionBadge" class="badge-connection offline">
          <span class="dot"></span>
          <span id="connectionText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
        </div>
        <button class="btn btn-secondary" id="btnRefreshNow">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        <button class="btn btn-secondary" id="btnSetUrl">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL</button>
      </div>
    </header>

    <main class="main">
      <div class="main-inner">

        <!-- DASHBOARD -->
        <section class="section active" id="section-dashboard">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title"><span class="icon">üìä</span>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div class="card-subtitle">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ó‡πá‡∏ö / ‡∏Å‡∏î‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</div>
              </div>
            </div>

            <div class="grid-3">
              <div class="stat-card">
                <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div class="stat-value" id="statTotalEmployees"><div class="skeleton"></div></div>
                <div class="stat-extra">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ï Employees</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div class="stat-value stat-accent" id="statTodayCount"><div class="skeleton"></div></div>
                <div class="stat-extra"><span class="stat-danger" id="statTodayLate">‡∏™‡∏≤‡∏¢ 0 ‡∏Ñ‡∏ô</span></div>
              </div>
              <div class="stat-card">
                <div class="stat-label">‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (‡∏õ‡∏Å‡∏ï‡∏¥ / ‡∏™‡∏≤‡∏¢ / ‡∏Ç‡∏≤‡∏î)</div>
                <div class="stat-value" id="statMonthOverview"><div class="skeleton"></div></div>
                <div class="stat-extra">‡∏à‡∏≤‡∏Å Summary Range</div>
              </div>
            </div>

            <div class="mt-12">
              <div class="card-subtitle">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
              <div class="scroll-x mt-8">
                <table class="table-wide">
                  <thead>
                    <tr>
                      <th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠</th>
                      <th>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ä‡πâ‡∏≤</th><th>‡∏≠‡∏≠‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</th><th>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</th><th>‡∏≠‡∏≠‡∏Å‡πÄ‡∏¢‡πá‡∏ô</th>
                      <th>‡∏£‡∏ß‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    </tr>
                  </thead>
                  <tbody id="dashboardTodayBody">
                    <tr><td colspan="8" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="mt-10">
                <div class="card-subtitle">‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏à‡∏∏‡∏î‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</div>
                <div id="dashboardLocationSummary" class="mt-8" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- EMPLOYEES -->
        <section class="section" id="section-employees">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title"><span class="icon">üë•</span>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
                <div class="card-subtitle">
                  ‚úÖ ‡∏•‡∏ö‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‚Äù ‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‚Äú‡∏°‡∏µ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤/‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‚Äù ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                </div>
              </div>

              <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; min-width:260px; max-width:460px; width:100%;">
                <input id="empSearch" class="input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏´‡∏±‡∏™ / ‡∏ä‡∏∑‡πà‡∏≠" />
                <button class="btn btn-primary" id="btnOpenAddEmp">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
              </div>
            </div>

            <!-- Desktop table -->
            <div class="desktop-only">
              <div class="scroll-x" style="max-height:520px; overflow:auto;">
                <table class="table-wide">
                  <thead>
                    <tr>
                      <th>‡∏£‡∏´‡∏±‡∏™</th>
                      <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                      <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                      <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                      <th>‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</th>
                      <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                  </thead>
                  <tbody id="empTableBody">
                    <tr><td colspan="6" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Mobile cards -->
            <div class="mobile-only">
              <div id="empMobileList" class="list-mobile">
                <div class="helper">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
              </div>
            </div>

            <div class="helper mt-10">
              * ‡∏´‡∏ô‡πâ‡∏≤ Admin ‡πÇ‡∏ü‡∏Å‡∏±‡∏™ ‚Äú‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‚Äù ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Ä¢ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
            </div>
          </div>
        </section>

        <!-- LOGS -->
        <section class="section" id="section-logs">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title"><span class="icon">‚è±</span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏ß‡∏•‡∏≤</div>
                <div class="card-subtitle">‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö = ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‚Ä¢ ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Å‡πá‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</div>
              </div>
            </div>

            <div class="mt-8" style="display:flex; flex-wrap:wrap; gap:8px; align-items:end;">
              <div style="flex:1; min-width:200px;">
                <div class="helper">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ / ‡∏£‡∏´‡∏±‡∏™</div>
                <input id="logSearch" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1011, ‡∏™‡∏°‡∏ä‡∏≤‡∏¢" />
              </div>
              <div style="min-width:160px;">
                <div class="helper">‡∏™‡∏≤‡∏Ç‡∏≤</div>
                <select id="logBranchFilter" class="input"></select>
              </div>
              <div style="min-width:160px;">
                <div class="helper">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                <select id="logMonthFilter" class="input"></select>
              </div>
              <div style="min-width:160px;">
                <div class="helper">‡∏õ‡∏µ (‡∏û.‡∏®.)</div>
                <select id="logYearFilter" class="input"></select>
              </div>
              <button class="btn btn-primary" id="btnReloadLogs">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏ó‡πá‡∏ö‡∏ô‡∏µ‡πâ</button>
            </div>

            <div class="desktop-only mt-10">
              <div class="scroll-x" style="max-height:520px; overflow:auto;">
                <table class="table-wide">
                  <thead>
                    <tr>
                      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠</th>
                      <th>‡πÄ‡∏Ç‡πâ‡∏≤</th><th>‡∏≠‡∏≠‡∏Å</th><th>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏°</th>
                      <th>‡∏£‡∏ß‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                      <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</th>
                    </tr>
                  </thead>
                  <tbody id="logsTableBody">
                    <tr><td colspan="10" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="mobile-only mt-10">
              <div id="logsMobileList" class="list-mobile">
                <div class="helper">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
              </div>
            </div>
          </div>
        </section>

        <!-- SUMMARY -->
        <section class="section" id="section-summary">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title"><span class="icon">üìà</span>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</div>
                <div class="card-subtitle">‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏õ‡∏Å‡∏ï‡∏¥/‡∏™‡∏≤‡∏¢/‡∏Ç‡∏≤‡∏î) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ HR ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
              </div>
            </div>

            <div class="mt-8" style="display:flex; flex-wrap:wrap; gap:8px; align-items:end;">
              <div style="min-width:160px;">
                <div class="helper">‡∏™‡∏≤‡∏Ç‡∏≤</div>
                <select id="sumBranchFilter" class="input"></select>
              </div>
              <div style="min-width:160px;">
                <div class="helper">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                <select id="sumMonthFilter" class="input"></select>
              </div>
              <div style="min-width:160px;">
                <div class="helper">‡∏õ‡∏µ (‡∏û.‡∏®.)</div>
                <select id="sumYearFilter" class="input"></select>
              </div>
              <button class="btn btn-primary" id="btnReloadSummary">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏ó‡πá‡∏ö‡∏ô‡∏µ‡πâ</button>
            </div>

            <div class="desktop-only mt-10">
              <div class="scroll-x" style="max-height:520px; overflow:auto;">
                <table class="table-wide">
                  <thead>
                    <tr>
                      <th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡πÅ‡∏ú‡∏ô‡∏Å</th><th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                      <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</th><th>‡∏õ‡∏Å‡∏ï‡∏¥</th><th>‡∏™‡∏≤‡∏¢</th><th>‡∏Ç‡∏≤‡∏î</th>
                    </tr>
                  </thead>
                  <tbody id="summaryTableBody">
                    <tr><td colspan="8" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="mobile-only mt-10">
              <div id="summaryMobileList" class="list-mobile">
                <div class="helper">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
              </div>
            </div>
          </div>
        </section>

        <!-- LEAVE TAB -->
        <section class="section" id="section-leave">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title"><span class="icon">üìù</span>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏≤</div>
                <div class="card-subtitle">
                  ‡πÇ‡∏Ñ‡∏£‡∏á‡πÅ‡∏ó‡πá‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß ‚úÖ (‡∏£‡∏≠‡∏ú‡∏π‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å GS/DB) ‚Ä¢ ‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ / ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ / ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                </div>
              </div>
            </div>

            <div class="chips mt-8">
              <div class="chip active" data-leave-status="PENDING">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
              <div class="chip" data-leave-status="APPROVED">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
              <div class="chip" data-leave-status="REJECTED">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
              <div class="chip" data-leave-status="ALL">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            </div>

            <div class="mt-10" style="display:flex; flex-wrap:wrap; gap:8px; align-items:end;">
              <div style="flex:1; min-width:220px;">
                <div class="helper">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏£‡∏´‡∏±‡∏™/‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•)</div>
                <input id="leaveSearch" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1011, ‡∏™‡∏°‡∏ä‡∏≤‡∏¢, ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢" />
              </div>
              <div style="min-width:160px;">
                <div class="helper">‡∏™‡∏≤‡∏Ç‡∏≤</div>
                <select id="leaveBranchFilter" class="input"></select>
              </div>
              <div style="min-width:160px;">
                <div class="helper">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                <select id="leaveMonthFilter" class="input"></select>
              </div>
              <div style="min-width:160px;">
                <div class="helper">‡∏õ‡∏µ (‡∏û.‡∏®.)</div>
                <select id="leaveYearFilter" class="input"></select>
              </div>
              <button class="btn btn-primary" id="btnReloadLeave">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏ó‡πá‡∏ö‡∏ô‡∏µ‡πâ</button>
            </div>

            <div id="leaveHint" class="helper mt-10"></div>

            <div class="desktop-only mt-10">
              <div class="scroll-x" style="max-height:520px; overflow:auto;">
                <table class="table-wide">
                  <thead>
                    <tr>
                      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô</th>
                      <th>‡∏£‡∏´‡∏±‡∏™</th>
                      <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                      <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏≤</th>
                      <th>‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤</th>
                      <th>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</th>
                      <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                      <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                  </thead>
                  <tbody id="leaveTableBody">
                    <tr><td colspan="8" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="mobile-only mt-10">
              <div id="leaveMobileList" class="list-mobile">
                <div class="helper">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
              </div>
            </div>

            <div class="helper mt-10">
              * ‡∏õ‡∏∏‡πà‡∏° ‚Äú‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‚Äù ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ú‡∏π‡∏Å API) ‚Ä¢ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÑ‡∏õ‡∏ó‡∏≥ leave.html ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
            </div>
          </div>
        </section>

        <!-- SETTINGS -->
        <section class="section" id="section-settings">
          <div class="grid-2">
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title"><span class="icon">üè∑Ô∏è</span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å</div>
                  <div class="card-subtitle">‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡πà‡∏≤‡∏á ‡πÜ</div>
                </div>
              </div>

              <div class="mt-8">
                <div class="helper">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏Å‡πÉ‡∏´‡∏°‡πà</div>
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                  <input id="branchName" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢ / ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•" />
                  <button class="btn btn-primary" id="btnAddBranch">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
              </div>

              <div class="scroll-x mt-10" style="max-height:360px; overflow:auto;">
                <table>
                  <thead><tr><th>‡πÅ‡∏ú‡∏ô‡∏Å</th><th class="text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                  <tbody id="branchTableBody"><tr><td colspan="2" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr></tbody>
                </table>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title"><span class="icon">üìå</span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö / ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div>
                  <div class="card-subtitle">‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô / ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô / ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏Ø‡∏•‡∏Ø</div>
                </div>
              </div>

              <div class="mt-8">
                <div class="helper">‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà</div>
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                  <input id="levelName" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô" />
                  <button class="btn btn-primary" id="btnAddLevel">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
              </div>

              <div class="scroll-x mt-10" style="max-height:360px; overflow:auto;">
                <table>
                  <thead><tr><th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th><th class="text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                  <tbody id="levelTableBody"><tr><td colspan="2" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr></tbody>
                </table>
              </div>

              <div id="settingsError" class="error-text" style="display:none;"></div>
              <div id="settingsSuccess" class="success-text" style="display:none;"></div>
            </div>
          </div>
        </section>

        <!-- URL CARD -->
        <div class="card" id="urlCard">
          <div class="card-header">
            <div class="card-title"><span class="icon">üîó</span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL API</div>
          </div>
          <div class="helper">URL ‡∏à‡∏≤‡∏Å Apps Script Web App (‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ <code>/exec</code>)</div>
          <input id="inputApiUrl" class="input mt-8" placeholder="‡πÄ‡∏ä‡πà‡∏ô https://script.google.com/macros/s/XXXXX/exec" />
          <div class="mt-10" style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn btn-primary" id="btnSaveUrl">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button class="btn btn-secondary" id="btnCancelUrl">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          </div>
          <div id="urlError" class="error-text" style="display:none;"></div>
        </div>

      </div>
    </main>
  </div>
</div>

<!-- Bottom Nav (Mobile) -->
<div class="bottom-nav">
  <div class="bottom-nav-inner">
    <button class="bottom-item active" data-section="dashboard"><div class="bicon">üìä</div><div>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</div></button>
    <button class="bottom-item" data-section="employees"><div class="bicon">üë•</div><div>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div></button>
    <button class="bottom-item" data-section="logs"><div class="bicon">‚è±</div><div>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div></button>
    <button class="bottom-item" data-section="summary"><div class="bicon">üìà</div><div>‡∏™‡∏£‡∏∏‡∏õ</div></button>
    <button class="bottom-item" data-section="leave"><div class="bicon">üìù</div><div>‡∏•‡∏≤</div></button>
    <button class="bottom-item" data-section="settings"><div class="bicon">‚öôÔ∏è</div><div>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div></button>
  </div>
</div>

<!-- MODAL: EMPLOYEE FORM -->
<div class="modal-backdrop" id="empModalBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="empModalTitle">
    <div class="modal-header">
      <div style="min-width:0;">
        <div class="modal-title" id="empModalTitle">üë§ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
        <div class="modal-sub" id="empModalSub">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤)</div>
      </div>
      <button class="btn btn-secondary btn-small" id="btnCloseEmpModal" type="button">‡∏õ‡∏¥‡∏î</button>
    </div>
    <div class="modal-body">
      <div class="grid-2">
        <div>
          <div class="helper">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
          <input id="empCode" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1011" />
        </div>
        <div>
          <div class="helper">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</div>
          <input id="empEmail" class="input" placeholder="optional" />
        </div>
      </div>

      <div class="mt-10">
        <div class="helper">‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</div>
        <input id="empFullName" class="input" placeholder="‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" />
      </div>

      <div class="grid-2 mt-10">
        <div>
          <div class="helper">‡πÅ‡∏ú‡∏ô‡∏Å</div>
          <select id="empBranch" class="input"></select>
        </div>
        <div>
          <div class="helper">‡∏£‡∏∞‡∏î‡∏±‡∏ö / ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div>
          <select id="empLevel" class="input"></select>
        </div>
      </div>

      <div id="empFormError" class="error-text" style="display:none;"></div>
      <div id="empFormSuccess" class="success-text" style="display:none;"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" id="btnResetEmpForm" type="button">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
      <button class="btn btn-primary" id="btnSaveEmployee" type="button">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </div>
</div>

<script>
  const STORAGE_KEY = 'attendance_api_url_v2';

  function $(id){ return document.getElementById(id); }

  function getApiUrl(){ return localStorage.getItem(STORAGE_KEY) || ''; }
  function setApiUrl(url){
    if(!url) localStorage.removeItem(STORAGE_KEY);
    else localStorage.setItem(STORAGE_KEY, url);
  }

  const api = {
    async call(action, params = {}){
      const apiUrl = getApiUrl();
      if(!apiUrl) throw new Error('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL API');

      const body = new URLSearchParams({ action, ...params }).toString();
      const res = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8' },
        body
      });

      const text = await res.text();
      let data;
      try { data = JSON.parse(text); }
      catch(e){
        console.error('API response is not JSON:', text);
        throw new Error('API ‡∏™‡πà‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON (‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ URL ‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ /exec ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á)');
      }
      if(!data.ok) throw new Error(data.error || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå');
      return data.result;
    }
  };

  // ===== Data =====
  let employees = [];
  let branches = [];
  let levels = [];
  let editingEmpId = null;

  // logs / leave
  let lastLogsRows = [];
  let leaveStatus = 'PENDING'; // PENDING | APPROVED | REJECTED | ALL

  // Auto refresh control
  let autoTimer = null;
  const AUTO_REFRESH_MS = 30000; // 30s

  function escHtml(s){
    return String(s ?? '')
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'","&#39;");
  }

  function setLastUpdated(){
    const d = new Date();
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    const ss = String(d.getSeconds()).padStart(2,'0');
    $('lastUpdatedText').textContent = `‚Ä¢ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${hh}:${mm}:${ss}`;
  }

  function setConnectionStatus(online, msg){
    const bdg = $('connectionBadge');
    const txt = $('connectionText');
    if(!bdg || !txt) return;
    if(online){
      bdg.classList.remove('offline');
      txt.textContent = msg || '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
    }else{
      bdg.classList.add('offline');
      txt.textContent = msg || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
    }
  }

  function ellipsizeUrl(url){
    if(!url) return '';
    if(url.length <= 52) return url;
    return url.slice(0, 30) + '...' + url.slice(-12);
  }
  function setApiText(url){
    const el = $('apiUrlDisplay');
    if(!el) return;
    el.textContent = url ? ('API: ' + ellipsizeUrl(url)) : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL';
    el.title = url ? ('‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å: ' + url) : '';
    el.dataset.full = url || '';
  }

  // ===== URL Card =====
  function openUrlCard(){
    $('inputApiUrl').value = getApiUrl();
    $('urlCard').style.display = 'block';
    $('urlError').style.display = 'none';
  }
  function closeUrlCard(){ $('urlCard').style.display = 'none'; }
  function saveUrl(){
    const url = $('inputApiUrl').value.trim();
    const errEl = $('urlError');
    errEl.style.display = 'none';
    if(!url){
      errEl.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å URL';
      errEl.style.display = 'block';
      return;
    }
    setApiUrl(url);
    setApiText(url);
    closeUrlCard();
    initAdmin(true);
  }

  // ===== Section nav =====
  function switchSection(section){
    document.querySelectorAll('.nav-item').forEach(el => el.classList.toggle('active', el.dataset.section === section));
    document.querySelectorAll('.bottom-item').forEach(el => el.classList.toggle('active', el.dataset.section === section));
    document.querySelectorAll('.section').forEach(el => el.classList.toggle('active', el.id === 'section-' + section));

    // ‚úÖ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ó‡πá‡∏ö = ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ó‡πá‡∏ö‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    refreshCurrentSection(section);

    // ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î auto refresh ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà
    startAutoRefresh(section);
  }

  function getActiveSection(){
    const active = document.querySelector('.nav-item.active');
    return active ? active.dataset.section : 'dashboard';
  }

  function startAutoRefresh(section){
    if(autoTimer) clearInterval(autoTimer);
    autoTimer = setInterval(() => {
      const cur = getActiveSection();
      refreshCurrentSection(cur, true);
    }, AUTO_REFRESH_MS);
  }

  async function refreshCurrentSection(section, silent=false){
    try{
      if(section === 'dashboard'){
        await loadDashboard();
      }else if(section === 'employees'){
        await loadEmployees();
      }else if(section === 'logs'){
        await reloadLogs();
      }else if(section === 'summary'){
        await reloadSummary();
      }else if(section === 'settings'){
        await loadBranchesLevels();
      }else if(section === 'leave'){
        await reloadLeave();
      }
      setLastUpdated();
      if(!silent) {} // no toast
    }catch(err){
      console.error(err);
      if(!silent) alert('‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message);
    }
  }

  // ===== Status helpers =====
  function statusBadgeHtml(status){
    const s = String(status || '').trim();
    if(!s) return '<span class="badge-status badge-absent">‡∏Ç‡∏≤‡∏î</span>';
    const up = s.toUpperCase();
    if(up.includes('UNKNOWN') || up.includes('UNKNOW')) return '<span class="badge-status badge-unknown">UNKNOWN</span>';

    let cls = 'badge-other';
    if(s === '‡∏õ‡∏Å‡∏ï‡∏¥') cls = 'badge-normal';
    else if(s.includes('‡∏™‡∏≤‡∏¢') || s.includes('‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏ß') || s.includes('‡∏≠‡∏≠‡∏Å‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏ß')) cls = 'badge-late';
    else if(s === '‡∏Ç‡∏≤‡∏î') cls = 'badge-absent';
    return '<span class="badge-status '+cls+'">'+escHtml(s)+'</span>';
  }

  function timeToMinutes(t){
    if(!t) return null;
    const parts = String(t).split(':');
    if(parts.length < 2) return null;
    const h = Number(parts[0]), m = Number(parts[1]);
    if(isNaN(h) || isNaN(m)) return null;
    return h * 60 + m;
  }
  function minutesToThai(min){
    if(min == null) return '-';
    if(min <= 0) return '0 ‡∏ô‡∏≤‡∏ó‡∏µ';
    const h = Math.floor(min / 60);
    const m = min % 60;
    if(h <= 0) return `${m} ‡∏ô‡∏≤‡∏ó‡∏µ`;
    return `${h} ‡∏ä‡∏° ${m.toString().padStart(2,'0')} ‡∏ô‡∏≤‡∏ó‡∏µ`;
  }
  function calcTotalHours(t1, t4){
    const m1 = timeToMinutes(t1);
    const m4 = timeToMinutes(t4);
    if(m1 == null || m4 == null || m4 <= m1) return '-';
    return minutesToThai(m4 - m1);
  }

  function formatDateThai(dateStr){
    let d;
    if(dateStr instanceof Date) d = dateStr;
    else{
      const parts = String(dateStr).split('-');
      if(parts.length === 3) d = new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));
      else return String(dateStr || '');
    }
    const dd = d.getDate().toString().padStart(2,'0');
    const mm = (d.getMonth()+1).toString().padStart(2,'0');
    const yy = d.getFullYear() + 543;
    return `${dd}/${mm}/${yy}`;
  }

  function isRealTime(v){
    if(v == null) return false;
    const s = String(v).trim();
    if(!s) return false;
    if(s === '-' || s === '‚Äì') return false;
    return true;
  }
  function hasAnyLogRow(r){
    return isRealTime(r.t1) || isRealTime(r.t2) || isRealTime(r.t3) || isRealTime(r.t4);
  }

  function calcPenaltyFromStatus(status){
    const s = String(status || '').trim();
    if(!s) return { kind:'none', minutes:0 };
    const up = s.toUpperCase();
    if(up.includes('UNKNOWN') || up.includes('UNKNOW')) return { kind:'unknown' };

    let total = 0;
    const re = /(\d+)\s*(?:‡∏ä‡∏°\.?|‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)\s*(\d+)\s*‡∏ô‡∏≤‡∏ó‡∏µ|(\d+)\s*‡∏ô‡∏≤‡∏ó‡∏µ/g;
    let m;
    while((m = re.exec(s)) !== null){
      if(m[1] && m[2]) total += (Number(m[1]) * 60) + Number(m[2]);
      else if(m[3]) total += Number(m[3]);
    }
    return { kind:'ok', minutes:total };
  }
  function penaltyHtmlFromRow(r){
    const res = calcPenaltyFromStatus(r.status || '');
    if(res.kind === 'unknown') return '<span class="badge-status badge-unknown">UNKNOWN</span>';
    if(res.kind === 'none') return '-';
    return `<span class="pill">${escHtml(minutesToThai(res.minutes))}</span>`;
  }

  // ===== Selects =====
  function renderBranchLevelSelects(){
    const branchSel = $('empBranch');
    const levelSel  = $('empLevel');

    branchSel.innerHTML = branches.length
      ? branches.map(b => `<option value="${escHtml(b.name)}">${escHtml(b.name)}</option>`).join('')
      : '<option value="">- ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å -</option>';

    levelSel.innerHTML = levels.length
      ? levels.map(l => `<option value="${escHtml(l.name)}">${escHtml(l.name)}</option>`).join('')
      : '<option value="">- ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö -</option>';

    const opts = ['<option value="ALL">‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>'].concat(
      branches.map(b => `<option value="${escHtml(b.name)}">${escHtml(b.name)}</option>`)
    ).join('');

    $('logBranchFilter').innerHTML = opts;
    $('sumBranchFilter').innerHTML = opts;
    $('leaveBranchFilter').innerHTML = opts;
  }

  function fillYearMonthSelect(yearSel, monthSel){
    const now = new Date();
    const curYear = now.getFullYear();
    const years = [curYear-1, curYear, curYear+1];

    yearSel.innerHTML = years.map(y => {
      const be = y + 543;
      const sel = (y === curYear) ? 'selected' : '';
      return `<option value="${y}" ${sel}>${be}</option>`;
    }).join('');

    const monthNames = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
    monthSel.innerHTML = monthNames.map((m,i) => {
      const sel = (i === now.getMonth()) ? 'selected' : '';
      return `<option value="${i+1}" ${sel}>${m}</option>`;
    }).join('');
  }

  // ===== Employees =====
  function hasFace(e){
    const fd = e && e.faceData;
    if(!fd) return false;
    const s = String(fd).trim();
    if(!s) return false;
    if(s === '-' || s === '‚Äì') return false;
    return true;
  }

  function renderEmployeesTable(){
    const tb = $('empTableBody');
    const mobileList = $('empMobileList');
    const q = ($('empSearch').value || '').trim().toLowerCase();

    let list = employees;
    if(q){
      list = list.filter(e => (String(e.code)+' '+String(e.fullName)).toLowerCase().includes(q));
    }

    if(!list.length){
      tb.innerHTML = '<tr><td colspan="6" class="text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
      mobileList.innerHTML = '<div class="helper">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
      return;
    }

    tb.innerHTML = list.map(e => {
      const faceOk = hasFace(e);
      const faceBadge = faceOk
        ? `<span class="emp-face-badge">‡∏°‡∏µ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>`
        : `<span class="emp-face-badge off">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>`;

      return `
        <tr>
          <td>${escHtml(e.code || '')}</td>
          <td>${escHtml(e.fullName || '')}</td>
          <td>${escHtml(e.branch || '')}</td>
          <td>${escHtml(e.level || '')}</td>
          <td>${faceBadge}</td>
          <td>
            <div style="display:flex; gap:6px; flex-wrap:wrap;">
              <button class="btn btn-secondary btn-small" onclick="editEmployee('${escHtml(e.id || '')}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button class="btn btn-danger btn-small" onclick="deleteEmployeeConfirm('${escHtml(e.id || '')}')">üóëÔ∏è ‡∏•‡∏ö</button>
            </div>
          </td>
        </tr>
      `;
    }).join('');

    mobileList.innerHTML = list.map(e => {
      const faceOk = hasFace(e);
      const faceBadge = faceOk
        ? `<span class="emp-face-badge">‡∏°‡∏µ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>`
        : `<span class="emp-face-badge off">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>`;

      return `
        <div class="item">
          <div class="item-top">
            <div style="min-width:0;">
              <div class="item-title">${escHtml(e.fullName || '-')}</div>
              <div class="item-meta">
                <span class="tag">‡πÅ‡∏ú‡∏ô‡∏Å: ${escHtml(e.branch || '-')}</span>
                <span class="tag">‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${escHtml(e.level || '-')}</span>
                ${faceBadge}
              </div>
            </div>
            <div class="code-badge">‡∏£‡∏´‡∏±‡∏™ ${escHtml(e.code || '-')}</div>
          </div>

          <div class="item-actions">
            <button class="btn btn-secondary" onclick="editEmployee('${escHtml(e.id || '')}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button class="btn btn-danger" onclick="deleteEmployeeConfirm('${escHtml(e.id || '')}')">üóëÔ∏è ‡∏•‡∏ö</button>
          </div>
        </div>
      `;
    }).join('');
  }

  async function loadEmployees(){
    $('empTableBody').innerHTML = '<tr><td colspan="6" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
    $('empMobileList').innerHTML = '<div class="helper">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';

    employees = await api.call('getEmployees');
    renderEmployeesTable();
    $('statTotalEmployees').textContent = String(employees.length);
  }

  // ===== Dashboard =====
  async function loadDashboard(){
    $('dashboardTodayBody').innerHTML = '<tr><td colspan="8" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
    $('dashboardLocationSummary').innerHTML = '';

    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth() + 1;

    const [empRes, todaySummary, monthSummary] = await Promise.all([
      api.call('getEmployees'),
      api.call('getTodaySummary'),
      api.call('getSummaryRange', { year, month, branch:'ALL' }),
    ]);

    employees = empRes || employees;
    $('statTotalEmployees').textContent = String(employees.length);

    renderDashboard(todaySummary || [], monthSummary || { rows:[] });
  }

  function renderDashboard(todaySummary, monthSummary){
    const todayRows = todaySummary || [];
    const loggedRows = todayRows.filter(hasAnyLogRow);
    $('statTodayCount').textContent = String(loggedRows.length);

    let lateCount = 0;
    loggedRows.forEach(r => {
      const st = String(r.status || '');
      if(st.includes('‡∏™‡∏≤‡∏¢') || st.includes('‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏ß') || st.includes('‡∏≠‡∏≠‡∏Å‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏ß')) lateCount++;
    });
    $('statTodayLate').textContent = `‡∏™‡∏≤‡∏¢ ${lateCount} ‡∏Ñ‡∏ô`;

    const rows = (monthSummary && monthSummary.rows) || [];
    let normal=0, late=0, absent=0;
    rows.forEach(r => {
      normal += Number(r.normalCount || 0);
      late   += Number(r.lateCount || 0);
      absent += Number(r.absentCount || 0);
    });
    $('statMonthOverview').textContent = `${normal} ‡∏õ‡∏Å‡∏ï‡∏¥ / ${late} ‡∏™‡∏≤‡∏¢ / ${absent} ‡∏Ç‡∏≤‡∏î`;

    const tbody = $('dashboardTodayBody');
    if(!todayRows.length){
      tbody.innerHTML = '<tr><td colspan="8" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</td></tr>';
    }else{
      tbody.innerHTML = todayRows.map(r => {
        return `
          <tr>
            <td>${escHtml(r.code || '')}</td>
            <td>${escHtml(r.fullName || '')}</td>
            <td>${escHtml((isRealTime(r.t1) ? r.t1 : '-') || '-')}</td>
            <td>${escHtml((isRealTime(r.t2) ? r.t2 : '-') || '-')}</td>
            <td>${escHtml((isRealTime(r.t3) ? r.t3 : '-') || '-')}</td>
            <td>${escHtml((isRealTime(r.t4) ? r.t4 : '-') || '-')}</td>
            <td>${penaltyHtmlFromRow(r)}</td>
            <td>${statusBadgeHtml(r.status || '')}</td>
          </tr>
        `;
      }).join('');
    }

    const locBox = $('dashboardLocationSummary');
    const locMap = {};
    loggedRows.forEach(r => {
      const loc = r.locationText || r.location || '';
      if(!loc) return;
      locMap[loc] = (locMap[loc] || 0) + 1;
    });
    const entries = Object.entries(locMap);
    locBox.innerHTML = entries.length
      ? entries.map(([name,count]) => `<span class="tag">${escHtml(name)} ‚Äì ${escHtml(count)} ‡∏Ñ‡∏ô</span>`).join(' ')
      : '<span class="helper">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤</span>';
  }

  // ===== Logs =====
  function renderLogsTable(res){
    const rows = (res && res.rows) || [];
    lastLogsRows = rows;

    const tb = $('logsTableBody');
    const mobileList = $('logsMobileList');

    if(!rows.length){
      tb.innerHTML = '<tr><td colspan="10" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
      mobileList.innerHTML = '<div class="helper">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
      return;
    }

    tb.innerHTML = rows.map((r) => {
      const total = calcTotalHours(r.t1, r.t4);
      const locText = r.locationText || r.location || '';
      const locCell = locText ? `<span class="tag">${escHtml(locText)}</span>` : '-';
      const evidence = r.evidenceUrl ? `<a href="${escHtml(r.evidenceUrl)}" target="_blank" rel="noopener">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ</a>` : '-';

      return `
        <tr>
          <td>${escHtml(formatDateThai(r.date))}</td>
          <td>${escHtml(r.code || '')}</td>
          <td>${escHtml(r.fullName || '')}</td>
          <td>${escHtml(r.t1 || '-')}</td>
          <td>${escHtml(r.t4 || '-')}</td>
          <td>${escHtml(total)}</td>
          <td>${penaltyHtmlFromRow(r)}</td>
          <td>${statusBadgeHtml(r.status || '')}</td>
          <td>${locCell}</td>
          <td>${evidence}</td>
        </tr>
      `;
    }).join('');

    mobileList.innerHTML = rows.map((r) => {
      const d = formatDateThai(r.date);
      const total = calcTotalHours(r.t1, r.t4);
      const loc = r.locationText || r.location || '-';
      const evidence = r.evidenceUrl ? `<a href="${escHtml(r.evidenceUrl)}" target="_blank" rel="noopener">‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</a>` : '-';
      const p = calcPenaltyFromStatus(r.status || '');
      const pText = (p.kind === 'unknown') ? 'UNKNOWN' : minutesToThai(p.minutes || 0);

      return `
        <div class="item">
          <div class="item-top">
            <div style="min-width:0;">
              <div class="item-title">${escHtml(r.fullName || '-')}</div>
              <div class="item-meta">
                <span class="tag">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${escHtml(d)}</span>
                <span class="tag">${escHtml(loc)}</span>
              </div>
            </div>
            <div class="code-badge">‡∏£‡∏´‡∏±‡∏™ ${escHtml(r.code || '-')}</div>
          </div>

          <div class="kv">
            <div class="k">‡πÄ‡∏Ç‡πâ‡∏≤</div><div class="v">${escHtml(r.t1 || '-')}</div>
            <div class="k">‡∏≠‡∏≠‡∏Å</div><div class="v">${escHtml(r.t4 || '-')}</div>
            <div class="k">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏°</div><div class="v">${escHtml(total)}</div>
            <div class="k">‡∏£‡∏ß‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</div><div class="v">${escHtml(pText)}</div>
            <div class="k">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div><div class="v">${escHtml(r.status || '-')}</div>
            <div class="k">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</div><div class="v">${evidence}</div>
          </div>
        </div>
      `;
    }).join('');
  }

  async function reloadLogs(){
    $('logsTableBody').innerHTML = '<tr><td colspan="10" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
    $('logsMobileList').innerHTML = '<div class="helper">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';

    const year  = $('logYearFilter').value;
    const month = $('logMonthFilter').value;
    const branch = $('logBranchFilter').value || 'ALL';
    const search = ($('logSearch').value || '').trim();

    const res = await api.call('getLogsRange', { year, month, branch, search });
    renderLogsTable(res);
  }

  // ===== Summary =====
  function renderSummaryTable(res){
    const rows = (res && res.rows) || [];
    const tb = $('summaryTableBody');
    const mobileList = $('summaryMobileList');

    if(!rows.length){
      tb.innerHTML = '<tr><td colspan="8" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
      mobileList.innerHTML = '<div class="helper">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
      return;
    }

    tb.innerHTML = rows.map(r => `
      <tr>
        <td>${escHtml(r.code || '')}</td>
        <td>${escHtml(r.fullName || '')}</td>
        <td>${escHtml(r.branch || '')}</td>
        <td>${escHtml(r.level || '')}</td>
        <td>${escHtml(r.days || 0)}</td>
        <td>${escHtml(r.normalCount || 0)}</td>
        <td>${escHtml(r.lateCount || 0)}</td>
        <td>${escHtml(r.absentCount || 0)}</td>
      </tr>
    `).join('');

    mobileList.innerHTML = rows.map(r => `
      <div class="item">
        <div class="item-top">
          <div style="min-width:0;">
            <div class="item-title">${escHtml(r.fullName || '-')}</div>
            <div class="item-meta">
              <span class="tag">‡πÅ‡∏ú‡∏ô‡∏Å: ${escHtml(r.branch || '-')}</span>
              <span class="tag">‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${escHtml(r.level || '-')}</span>
            </div>
          </div>
          <div class="code-badge">‡∏£‡∏´‡∏±‡∏™ ${escHtml(r.code || '-')}</div>
        </div>

        <div class="kv">
          <div class="k">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô</div><div class="v">${escHtml(r.days || 0)}</div>
          <div class="k">‡∏õ‡∏Å‡∏ï‡∏¥</div><div class="v">${escHtml(r.normalCount || 0)}</div>
          <div class="k">‡∏™‡∏≤‡∏¢</div><div class="v">${escHtml(r.lateCount || 0)}</div>
          <div class="k">‡∏Ç‡∏≤‡∏î</div><div class="v">${escHtml(r.absentCount || 0)}</div>
        </div>
      </div>
    `).join('');
  }

  async function reloadSummary(){
    $('summaryTableBody').innerHTML = '<tr><td colspan="8" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
    $('summaryMobileList').innerHTML = '<div class="helper">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';

    const year  = $('sumYearFilter').value;
    const month = $('sumMonthFilter').value;
    const branch = $('sumBranchFilter').value || 'ALL';

    const res = await api.call('getSummaryRange', { year, month, branch });
    renderSummaryTable(res);
  }

  // ===== Leave (‡πÇ‡∏Ñ‡∏£‡∏á + hook) =====
  function leaveStatusBadge(status){
    const s = String(status || '').toUpperCase();
    if(s === 'PENDING') return '<span class="badge-status badge-other">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>';
    if(s === 'APPROVED') return '<span class="badge-status badge-normal">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
    if(s === 'REJECTED') return '<span class="badge-status badge-absent">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
    return '<span class="badge-status badge-unknown">UNKNOWN</span>';
  }

  function renderLeave(res){
    const rows = (res && res.rows) || [];
    const tb = $('leaveTableBody');
    const mobileList = $('leaveMobileList');

    if(!rows.length){
      tb.innerHTML = '<tr><td colspan="8" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr>';
      mobileList.innerHTML = '<div class="helper">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>';
      return;
    }

    tb.innerHTML = rows.map(r => {
      const status = leaveStatusBadge(r.status);
      return `
        <tr>
          <td>${escHtml(formatDateThai(r.createdAt || r.requestDate || r.date || '-'))}</td>
          <td>${escHtml(r.code || '-')}</td>
          <td>${escHtml(r.fullName || '-')}</td>
          <td>${escHtml(r.leaveType || r.type || '-')}</td>
          <td>${escHtml(r.range || r.dateRange || '-')}</td>
          <td style="max-width:340px; white-space:normal;">${escHtml(r.reason || '-')}</td>
          <td>${status}</td>
          <td>
            <div style="display:flex; gap:6px; flex-wrap:wrap;">
              <button class="btn btn-primary btn-small" onclick="approveLeave('${escHtml(r.id || '')}')">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
              <button class="btn btn-danger btn-small" onclick="rejectLeave('${escHtml(r.id || '')}')">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
            </div>
          </td>
        </tr>
      `;
    }).join('');

    mobileList.innerHTML = rows.map(r => {
      const status = leaveStatusBadge(r.status);
      return `
        <div class="item">
          <div class="item-top">
            <div style="min-width:0;">
              <div class="item-title">${escHtml(r.fullName || '-')}</div>
              <div class="item-meta">
                <span class="tag">‡∏£‡∏´‡∏±‡∏™ ${escHtml(r.code || '-')}</span>
                <span class="tag">${escHtml(r.leaveType || r.type || '-')}</span>
                ${status}
              </div>
            </div>
            <div class="code-badge">${escHtml(formatDateThai(r.createdAt || r.requestDate || r.date || '-'))}</div>
          </div>

          <div class="kv">
            <div class="k">‡∏ä‡πà‡∏ß‡∏á‡∏•‡∏≤</div><div class="v">${escHtml(r.range || r.dateRange || '-')}</div>
            <div class="k">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</div><div class="v">${escHtml(r.reason || '-')}</div>
          </div>

          <div class="item-actions">
            <button class="btn btn-primary" onclick="approveLeave('${escHtml(r.id || '')}')">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
            <button class="btn btn-danger" onclick="rejectLeave('${escHtml(r.id || '')}')">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
          </div>
        </div>
      `;
    }).join('');
  }

  async function reloadLeave(){
    $('leaveTableBody').innerHTML = '<tr><td colspan="8" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
    $('leaveMobileList').innerHTML = '<div class="helper">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
    $('leaveHint').textContent = '';

    const year  = $('leaveYearFilter').value;
    const month = $('leaveMonthFilter').value;
    const branch = $('leaveBranchFilter').value || 'ALL';
    const search = ($('leaveSearch').value || '').trim();
    const status = leaveStatus;

    // ‚úÖ ‡πÇ‡∏Ñ‡∏£‡∏á: ‡∏ñ‡πâ‡∏≤ API ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á ‡πÅ‡∏ï‡πà‡∏ö‡∏≠‡∏Å‡∏ä‡∏±‡∏î‡∏ß‡πà‡∏≤ ‚Äú‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‚Äù
    try{
      // ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏õ‡∏ó‡∏≥ GS ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á: ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ action ‡∏ä‡∏∑‡πà‡∏≠ getLeaveRequests
      // params: year, month, branch, status, search
      const res = await api.call('getLeaveRequests', { year, month, branch, status, search });
      renderLeave(res);
    }catch(err){
      $('leaveHint').textContent =
        '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏π‡∏Å API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏≤ (action: getLeaveRequests) ‚Äî ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‚úÖ';
      $('leaveTableBody').innerHTML = '<tr><td colspan="8" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° (‡∏£‡∏≠‡∏ó‡∏≥ GS/DB)</td></tr>';
      $('leaveMobileList').innerHTML = '<div class="helper">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° (‡∏£‡∏≠‡∏ó‡∏≥ GS/DB)</div>';
    }
  }

  // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (‡∏ú‡∏π‡∏Å API ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á)
  window.approveLeave = async function(id){
    alert('‡πÇ‡∏Ñ‡∏£‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‚úÖ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÑ‡∏õ‡∏ó‡∏≥ GS/DB ‡∏ï‡∏≠‡∏ô‡∏ó‡∏≥ leave.html');
  };
  window.rejectLeave = async function(id){
    alert('‡πÇ‡∏Ñ‡∏£‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‚úÖ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÑ‡∏õ‡∏ó‡∏≥ GS/DB ‡∏ï‡∏≠‡∏ô‡∏ó‡∏≥ leave.html');
  };

  // ===== Settings =====
  function renderBranchesLevelsTables(){
    const bt = $('branchTableBody');
    const lt = $('levelTableBody');

    bt.innerHTML = branches.length
      ? branches.map(b => `
          <tr>
            <td>${escHtml(b.name)}</td>
            <td class="text-right"><button class="btn btn-danger btn-small" onclick="deleteBranch('${escHtml(b.name)}')">‡∏•‡∏ö</button></td>
          </tr>
        `).join('')
      : '<tr><td colspan="2" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å</td></tr>';

    lt.innerHTML = levels.length
      ? levels.map(l => `
          <tr>
            <td>${escHtml(l.name)}</td>
            <td class="text-right"><button class="btn btn-danger btn-small" onclick="deleteLevel('${escHtml(l.name)}')">‡∏•‡∏ö</button></td>
          </tr>
        `).join('')
      : '<tr><td colspan="2" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö</td></tr>';
  }

  async function loadBranchesLevels(){
    const bl = await api.call('getBranchesLevels');
    branches = bl.branches || [];
    levels   = bl.levels || [];
    renderBranchLevelSelects();
    renderBranchesLevelsTables();
  }

  window.deleteBranch = async function(name){
    if(!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å "${name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;
    try{
      await api.call('deleteBranch', { name });
      await loadBranchesLevels();
      $('settingsSuccess').textContent = '‡∏•‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
      $('settingsSuccess').style.display = 'block';
      $('settingsError').style.display = 'none';
    }catch(err){
      $('settingsError').textContent = '‡∏•‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message;
      $('settingsError').style.display = 'block';
      $('settingsSuccess').style.display = 'none';
    }
  };

  window.deleteLevel = async function(name){
    if(!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö "${name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;
    try{
      await api.call('deleteLevel', { name });
      await loadBranchesLevels();
      $('settingsSuccess').textContent = '‡∏•‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
      $('settingsSuccess').style.display = 'block';
      $('settingsError').style.display = 'none';
    }catch(err){
      $('settingsError').textContent = '‡∏•‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message;
      $('settingsError').style.display = 'block';
      $('settingsSuccess').style.display = 'none';
    }
  };

  async function addBranch(){
    const name = ($('branchName').value || '').trim();
    const errEl = $('settingsError');
    const sucEl = $('settingsSuccess');
    errEl.style.display = 'none';
    sucEl.style.display = 'none';
    if(!name){
      errEl.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏Å';
      errEl.style.display = 'block';
      return;
    }
    try{
      await api.call('saveBranch', { name });
      $('branchName').value = '';
      await loadBranchesLevels();
      sucEl.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
      sucEl.style.display = 'block';
    }catch(err){
      errEl.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message;
      errEl.style.display = 'block';
    }
  }

  async function addLevel(){
    const name = ($('levelName').value || '').trim();
    const errEl = $('settingsError');
    const sucEl = $('settingsSuccess');
    errEl.style.display = 'none';
    sucEl.style.display = 'none';
    if(!name){
      errEl.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö';
      errEl.style.display = 'block';
      return;
    }
    try{
      await api.call('saveLevel', { name });
      $('levelName').value = '';
      await loadBranchesLevels();
      sucEl.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
      sucEl.style.display = 'block';
    }catch(err){
      errEl.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message;
      errEl.style.display = 'block';
    }
  }

  // ===== Employee modal =====
  function openModal(id){
    const el = $(id);
    if(!el) return;
    el.style.display = 'flex';
    el.setAttribute('aria-hidden','false');
  }
  function closeModal(id){
    const el = $(id);
    if(!el) return;
    el.style.display = 'none';
    el.setAttribute('aria-hidden','true');
  }

  function resetEmpForm(keepMsg){
    editingEmpId = null;
    $('empModalTitle').textContent = 'üë§ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
    $('empModalSub').textContent = '‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤)';
    $('empCode').value = '';
    $('empFullName').value = '';
    $('empEmail').value = '';
    if($('empBranch').options.length) $('empBranch').selectedIndex = 0;
    if($('empLevel').options.length) $('empLevel').selectedIndex = 0;

    $('empFormError').style.display = 'none';
    if(!keepMsg) $('empFormSuccess').style.display = 'none';
  }

  function openEmpAdd(){
    resetEmpForm(false);
    openModal('empModalBackdrop');
  }

  window.editEmployee = function(id){
    const emp = employees.find(e => String(e.id) === String(id));
    if(!emp) return;

    editingEmpId = emp.id;
    $('empModalTitle').textContent = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
    $('empModalSub').textContent = `‡∏£‡∏´‡∏±‡∏™ ${emp.code || '-'} ‚Ä¢ ${emp.fullName || '-'}`;

    $('empCode').value = emp.code || '';
    $('empFullName').value = emp.fullName || '';
    $('empEmail').value = emp.email || '';
    $('empBranch').value = emp.branch || '';
    $('empLevel').value = emp.level || '';

    $('empFormError').style.display = 'none';
    $('empFormSuccess').style.display = 'none';
    openModal('empModalBackdrop');
  };

  async function saveEmployee(){
    const code = ($('empCode').value || '').trim();
    const fullName = ($('empFullName').value || '').trim();
    const branch = ($('empBranch').value || '').trim();
    const level  = ($('empLevel').value || '').trim();
    const email  = ($('empEmail').value || '').trim();

    const errEl = $('empFormError');
    const sucEl = $('empFormSuccess');
    errEl.style.display = 'none';
    sucEl.style.display = 'none';

    if(!code || !fullName){
      errEl.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•';
      errEl.style.display = 'block';
      return;
    }

    try{
      // ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ photoBase64 ‡πÅ‡∏•‡πâ‡∏ß (‡πÉ‡∏´‡πâ UI ‡πÇ‡∏•‡πà‡∏á)
      await api.call('saveEmployee', {
        id: editingEmpId || '',
        code, fullName, branch, level, email,
        photoBase64: '' // ‡∏Å‡∏±‡∏ô GS ‡πÄ‡∏î‡∏¥‡∏°‡∏¢‡∏±‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ß‡πâ
      });

      await loadEmployees();

      sucEl.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
      sucEl.style.display = 'block';

      setTimeout(() => {
        closeModal('empModalBackdrop');
        resetEmpForm(false);
      }, 250);
    }catch(err){
      errEl.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message;
      errEl.style.display = 'block';
    }
  }

  window.deleteEmployeeConfirm = async function(id){
    const emp = employees.find(e => String(e.id) === String(id));
    if(!emp) return;
    if(!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™ ${emp.code || ''} (${emp.fullName || ''}) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;

    try{
      await api.call('deleteEmployee', { id });
      await loadEmployees();
      alert('‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    }catch(err){
      alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message);
    }
  };

  // ===== init =====
  async function initAdmin(force=false){
    const apiUrl = getApiUrl();
    setApiText(apiUrl);

    if(!apiUrl){
      setConnectionStatus(false, '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL');
      return;
    }

    try{
      setConnectionStatus(true, '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

      // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° selects
      fillYearMonthSelect($('logYearFilter'), $('logMonthFilter'));
      fillYearMonthSelect($('sumYearFilter'), $('sumMonthFilter'));
      fillYearMonthSelect($('leaveYearFilter'), $('leaveMonthFilter'));

      // ‡πÇ‡∏´‡∏•‡∏î branch/level (‡πÄ‡∏û‡∏∑‡πà‡∏≠ filters)
      await loadBranchesLevels();

      // ‡πÇ‡∏´‡∏•‡∏î dashboard + employees (‡∏Ç‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å)
      await loadDashboard();
      await loadEmployees();

      // ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à)
      await refreshCurrentSection(getActiveSection(), true);

      setLastUpdated();
      startAutoRefresh(getActiveSection());
    }catch(err){
      console.error(err);
      setConnectionStatus(false, err.message);
      alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    // sidebar click
    document.querySelectorAll('.nav-item').forEach(el => el.addEventListener('click', () => switchSection(el.dataset.section)));
    // bottom nav click
    document.querySelectorAll('.bottom-item').forEach(el => el.addEventListener('click', () => switchSection(el.dataset.section)));

    $('btnBackToFront').addEventListener('click', () => window.location.href = 'index.html');
    $('btnLogout').addEventListener('click', () => {
      if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (‡∏•‡∏ö URL API ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){
        setApiUrl('');
        window.location.href = 'index.html';
      }
    });

    $('btnSetUrl').addEventListener('click', openUrlCard);
    $('btnSaveUrl').addEventListener('click', saveUrl);
    $('btnCancelUrl').addEventListener('click', closeUrlCard);

    $('btnRefreshNow').addEventListener('click', async () => {
      await refreshCurrentSection(getActiveSection());
    });

    $('apiUrlDisplay').addEventListener('click', async () => {
      const full = $('apiUrlDisplay').dataset.full || '';
      if(!full) return;
      try{
        await navigator.clipboard.writeText(full);
        alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÅ‡∏•‡πâ‡∏ß');
      }catch(e){
        prompt('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏ô‡∏µ‡πâ:', full);
      }
    });

    // employees
    $('empSearch').addEventListener('input', renderEmployeesTable);
    $('btnOpenAddEmp').addEventListener('click', openEmpAdd);

    $('btnCloseEmpModal').addEventListener('click', () => closeModal('empModalBackdrop'));
    $('empModalBackdrop').addEventListener('click', (e) => { if(e.target === $('empModalBackdrop')) closeModal('empModalBackdrop'); });
    $('btnResetEmpForm').addEventListener('click', () => resetEmpForm(false));
    $('btnSaveEmployee').addEventListener('click', saveEmployee);

    // logs
    $('btnReloadLogs').addEventListener('click', reloadLogs);
    $('logSearch').addEventListener('keydown', e => { if(e.key === 'Enter') reloadLogs(); });
    $('logBranchFilter').addEventListener('change', reloadLogs);
    $('logMonthFilter').addEventListener('change', reloadLogs);
    $('logYearFilter').addEventListener('change', reloadLogs);

    // summary
    $('btnReloadSummary').addEventListener('click', reloadSummary);
    $('sumBranchFilter').addEventListener('change', reloadSummary);
    $('sumMonthFilter').addEventListener('change', reloadSummary);
    $('sumYearFilter').addEventListener('change', reloadSummary);

    // leave
    $('btnReloadLeave').addEventListener('click', reloadLeave);
    $('leaveSearch').addEventListener('keydown', e => { if(e.key === 'Enter') reloadLeave(); });
    $('leaveBranchFilter').addEventListener('change', reloadLeave);
    $('leaveMonthFilter').addEventListener('change', reloadLeave);
    $('leaveYearFilter').addEventListener('change', reloadLeave);

    document.querySelectorAll('.chip').forEach(ch => {
      ch.addEventListener('click', () => {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        ch.classList.add('active');
        leaveStatus = ch.dataset.leaveStatus || 'PENDING';
        reloadLeave();
      });
    });

    // settings
    $('btnAddBranch').addEventListener('click', addBranch);
    $('btnAddLevel').addEventListener('click', addLevel);

    initAdmin();
  });
</script>
</body>
</html>
